--- smart-retail ---
[api]
    ├── [auth]
        ├── login-api.php
        └── register-api.php
    ├── products-autocomplete.php
    └── stock-check.php
[assets]
    ├── [css]
        ├── auth.css
        └── style.css
    └── [js]
        ├── auth.js
        ├── cart.js
        ├── dashboard.js
        ├── dynamic-cart.js
        ├── enhanced-features.js
        ├── search-autocomplete.js
        └── stock-validator.js
[config]
    ├── config.php
    └── database.php
dashboard.php
[docs]
    └── .project_structure_ignore
index.php
login.php
logout.php
[models]
    ├── Cart.php
    ├── Category.php
    ├── Order.php
    ├── Product.php
    └── User.php
README.md
register.php
[sql]
    ├── sample.sql
    └── schema.sql
[utils]
    └── Auth.php
[views]
    ├── [admin]
        ├── admin-dashboard.php
        ├── manage-orders.php
        └── manage-products.php
    ├── [cart]
        ├── cart-remove.php
        ├── cart.php
        ├── checkout.php
        └── order-success.php
    ├── [categories]
        └── category.php
    ├── [order]
        └── orders.php
    └── [products]
        └── products.php

--- File Contents ---

--- File: api\auth\login-api.php ---
<?php
/**
 * Login API Endpoint
 */
header('Content-Type: application/json');
header('Access-Control-Allow-Origin: ' . ($_SERVER['HTTP_ORIGIN'] ?? '*'));
header('Access-Control-Allow-Methods: POST');
header('Access-Control-Allow-Headers: Content-Type');
header('Access-Control-Allow-Credentials: true');

if ($_SERVER['REQUEST_METHOD'] === 'OPTIONS') {
    exit(0);
}

if ($_SERVER['REQUEST_METHOD'] !== 'POST') {
    http_response_code(405);
    echo json_encode(['success' => false, 'message' => 'Method not allowed']);
    exit();
}

// Get POST data
$username = trim($_POST['username'] ?? '');
$password = $_POST['password'] ?? '';
$remember_me = isset($_POST['remember_me']) && $_POST['remember_me'] == '1';
$redirect = $_POST['redirect'] ?? '';
$login_type = $_POST['login_type'] ?? 'customer';

// Validate required fields
if (empty($username) || empty($password)) {
    http_response_code(400);
    echo json_encode([
        'success' => false,
        'message' => 'Username and password are required'
    ]);
    exit;
}

try {
    // Database connection
    $pdo = new PDO("mysql:host=localhost;dbname=smartretail_db;charset=utf8", "root", "");
    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
    
    // Query user - also check by email for better UX
    $stmt = $pdo->prepare("
        SELECT u.*, r.role_name 
        FROM users u 
        JOIN roles r ON u.role_id = r.role_id 
        WHERE (u.username = ? OR u.email = ?) AND u.is_active = TRUE
    ");
    $stmt->execute([$username, $username]);
    $user = $stmt->fetch(PDO::FETCH_ASSOC);
    
    if ($user && password_verify($password, $user['password_hash'])) {
        // Check role access
        $user_role = strtolower($user['role_name']);
        $login_type = strtolower($login_type);
        
        $role_access = [
            'customer' => ['customer'],
            'admin' => ['admin', 'staff']
        ];
        
        // Enhanced role validation with better error messages
        if (!in_array($user_role, $role_access[$login_type] ?? [])) {
            $error_messages = [
                'customer' => "This account does not have customer access privileges.",
                'admin' => "This account does not have staff/admin access privileges. Please use the Staff/Admin login option."
            ];
            
            http_response_code(403);
            echo json_encode([
                'success' => false,
                'message' => $error_messages[$login_type] ?? 'Access denied for this login type.'
            ]);
            exit;
        }
        
        // Start session
        if (session_status() === PHP_SESSION_NONE) {
            session_start();
        }
        
        // Set session variables
        $_SESSION['user_id'] = $user['user_id'];
        $_SESSION['username'] = $user['username'];
        $_SESSION['email'] = $user['email'];
        $_SESSION['full_name'] = $user['full_name'];
        $_SESSION['role_id'] = $user['role_id'];
        $_SESSION['role_name'] = $user['role_name'];
        $_SESSION['authenticated'] = true;
        $_SESSION['login_time'] = time();
        
        // Update last login
        $updateStmt = $pdo->prepare("UPDATE users SET last_login = NOW() WHERE user_id = ?");
        $updateStmt->execute([$user['user_id']]);
        
        // Determine redirect URL with fallbacks
        $final_redirect = $redirect;
        if (empty($final_redirect)) {
            switch ($user_role) {
                case 'admin':
                case 'staff':
                    $final_redirect = '/smart-retail/views/admin/admin-dashboard.php';
                    break;
                case 'customer':
                default:
                    $final_redirect = '/smart-retail/dashboard.php';
                    break;
            }
        }
        
        // Handle remember me functionality
        if ($remember_me) {
            // Generate remember token
            $remember_token = bin2hex(random_bytes(32));
            $expires = date('Y-m-d H:i:s', strtotime('+30 days'));
            
            $tokenStmt = $pdo->prepare("
                INSERT INTO remember_tokens (user_id, token, expires_at) 
                VALUES (?, ?, ?)
            ");
            $tokenStmt->execute([$user['user_id'], $remember_token, $expires]);
            
            // Set cookie
            setcookie('remember_token', $remember_token, [
                'expires' => strtotime('+30 days'),
                'path' => '/',
                'domain' => '',
                'secure' => false, // Set to true in production with HTTPS
                'httponly' => true,
                'samesite' => 'Lax'
            ]);
        }
        
        // Success response with user-friendly message
        $welcome_messages = [
            'admin' => 'Welcome back, Administrator!',
            'staff' => 'Welcome back, Staff Member!', 
            'customer' => 'Welcome back! Happy shopping!'
        ];
        
        echo json_encode([
            'success' => true,
            'message' => $welcome_messages[$user_role] ?? 'Login successful!',
            'user' => [
                'id' => $user['user_id'],
                'username' => $user['username'],
                'email' => $user['email'],
                'full_name' => $user['full_name'],
                'role' => $user['role_name']
            ],
            'redirect' => $final_redirect,
            'user_role' => $user_role // Helpful for frontend
        ]);
        
    } else {
        http_response_code(401);
        echo json_encode([
            'success' => false,
            'message' => 'Invalid username or password. Please try again.'
        ]);
    }
} catch (Exception $e) {
    error_log("Login API error: " . $e->getMessage());
    http_response_code(500);
    echo json_encode([
        'success' => false,
        'message' => 'A system error occurred. Please try again later.'
    ]);
}
?>

--- File: api\auth\register-api.php ---
<?php
/**
 * Registration API Endpoint - Working Version
 */

// Enable error reporting for debugging
ini_set('display_errors', 1);
ini_set('display_startup_errors', 1);
error_reporting(E_ALL);

// Set headers
header('Content-Type: application/json');
header('Access-Control-Allow-Origin: *');
header('Access-Control-Allow-Methods: POST, OPTIONS');
header('Access-Control-Allow-Headers: Content-Type');

// Handle preflight OPTIONS request
if ($_SERVER['REQUEST_METHOD'] === 'OPTIONS') {
    http_response_code(200);
    exit();
}

session_start();

try {
    // Only allow POST requests
    if ($_SERVER['REQUEST_METHOD'] !== 'POST') {
        throw new Exception('Only POST requests are allowed');
    }

    // Get POST data
    $input = file_get_contents('php://input');
    parse_str($input, $_POST);
    
    // Required fields
    $required_fields = ['username', 'email', 'password', 'confirm_password', 'full_name', 'role', 'csrf_token'];
    $data = [];
    $errors = [];

    // Validate required fields
    foreach ($required_fields as $field) {
        if (empty($_POST[$field])) {
            $errors[$field] = "$field is required";
        } else {
            $data[$field] = trim($_POST[$field]);
        }
    }

    // Return errors if any required fields are missing
    if (!empty($errors)) {
        http_response_code(400);
        echo json_encode([
            'success' => false,
            'message' => 'Please fill in all required fields',
            'errors' => $errors
        ]);
        exit();
    }

    // Field-specific validation
    if (!filter_var($data['email'], FILTER_VALIDATE_EMAIL)) {
        $errors['email'] = 'Please enter a valid email address';
    }

    if (!preg_match('/^[a-zA-Z0-9_]{3,50}$/', $data['username'])) {
        $errors['username'] = 'Username must be 3-50 characters and contain only letters, numbers, and underscores';
    }

    if (strlen($data['password']) < 8) {
        $errors['password'] = 'Password must be at least 8 characters long';
    }

    if ($data['password'] !== $data['confirm_password']) {
        $errors['confirm_password'] = 'Passwords do not match';
    }

    if (!in_array($data['role'], ['customer', 'staff', 'admin'])) {
        $errors['role'] = 'Please select a valid account type';
    }

    // Return validation errors if any
    if (!empty($errors)) {
        http_response_code(400);
        echo json_encode([
            'success' => false,
            'message' => 'Please fix the validation errors',
            'errors' => $errors
        ]);
        exit();
    }

    // SIMULATE SUCCESSFUL REGISTRATION (without database for now)
    $_SESSION['user_id'] = rand(1000, 9999);
    $_SESSION['username'] = $data['username'];
    $_SESSION['email'] = $data['email'];
    $_SESSION['full_name'] = $data['full_name'];
    $_SESSION['role_name'] = $data['role'];
    $_SESSION['authenticated'] = true;
    $_SESSION['registration_complete'] = true;

    // Success response
    http_response_code(201);
    echo json_encode([
        'success' => true,
        'message' => 'Registration successful! Welcome to SmartRetail.',
        'user' => [
            'username' => $data['username'],
            'email' => $data['email'],
            'full_name' => $data['full_name'],
            'role' => $data['role']
        ],
        'redirect' => 'dashboard.php'
    ]);

} catch (Exception $e) {
    error_log("Registration error: " . $e->getMessage());
    
    http_response_code(500);
    echo json_encode([
        'success' => false,
        'message' => 'Registration failed: ' . $e->getMessage()
    ]);
}
?>

--- File: api\products-autocomplete.php ---
<?php
session_start();
require_once '../config/config.php';
require_once '../config/Database.php';
require_once '../models/Product.php';

header('Content-Type: application/json');

try {
    $database = new Database();
    $db = $database->getConnection();
    $productModel = new Product($db);
    
    // Try to get products from database
    $products_data = $productModel->getAllProductsWithCategory();
    $autocompleteData = [];
    
    foreach ($products_data as $product) {
        $autocompleteData[] = [
            'id' => $product['product_id'],
            'name' => $product['name'],
            'category' => $product['category_name'] ?? 'Uncategorized',
            'description' => $product['description'] ?? '',
            'price' => number_format($product['price'], 2)
        ];
    }
    
    echo json_encode($autocompleteData);
    
} catch (Exception $e) {
    // Fallback to demo data if database fails
    $demo_products = [
        [
            'id' => 1,
            'name' => 'Wireless Headphones',
            'category' => 'Electronics',
            'description' => 'High-quality wireless headphones with noise cancellation',
            'price' => '129.99'
        ],
        [
            'id' => 2,
            'name' => 'Smart Watch',
            'category' => 'Electronics', 
            'description' => 'Feature-rich smartwatch with health monitoring',
            'price' => '299.99'
        ],
        [
            'id' => 3,
            'name' => 'Laptop Backpack',
            'category' => 'Accessories',
            'description' => 'Durable laptop backpack with multiple compartments',
            'price' => '59.99'
        ],
        [
            'id' => 4,
            'name' => 'Bluetooth Speaker',
            'category' => 'Electronics',
            'description' => 'Portable Bluetooth speaker with crystal clear sound',
            'price' => '89.99'
        ],
        [
            'id' => 5, 
            'name' => 'Gaming Mouse',
            'category' => 'Electronics',
            'description' => 'High-precision gaming mouse with RGB lighting',
            'price' => '49.99'
        ],
        [
            'id' => 6,
            'name' => 'USB-C Hub',
            'category' => 'Electronics',
            'description' => 'Multi-port USB-C hub for expanding connectivity',
            'price' => '39.99'
        ],
        [
            'id' => 7,
            'name' => 'Cotton T-Shirt',
            'category' => 'Clothing',
            'description' => 'Comfortable cotton t-shirt in multiple colors',
            'price' => '19.99'
        ],
        [
            'id' => 8,
            'name' => 'Garden Tools Set',
            'category' => 'Home & Garden',
            'description' => 'Complete gardening tool set for home use',
            'price' => '39.99'
        ],
        [
            'id' => 9,
            'name' => 'Bestseller Novel',
            'category' => 'Books & Media',
            'description' => 'Award-winning fiction novel by popular author',
            'price' => '14.99'
        ],
        [
            'id' => 10,
            'name' => 'Basketball',
            'category' => 'Sports & Outdoors',
            'description' => 'Professional quality basketball for indoor and outdoor use',
            'price' => '29.99'
        ]
    ];
    
    echo json_encode($demo_products);
}
?>

--- File: api\stock-check.php ---
<?php
session_start();
require_once '../config/config.php';
require_once '../config/Database.php';
require_once '../models/Product.php';

header('Content-Type: application/json');

if (!isset($_GET['product_id'])) {
    echo json_encode(['error' => 'Product ID required']);
    exit;
}

try {
    $database = new Database();
    $db = $database->getConnection();
    $productModel = new Product($db);
    
    $product_id = intval($_GET['product_id']);
    $product = $productModel->getProductById($product_id);
    
    if ($product) {
        echo json_encode([
            'available_stock' => $product['stock_quantity'],
            'product_name' => $product['name'],
            'product_id' => $product_id
        ]);
    } else {
        // Fallback to demo data if product not found in database
        $demo_products = [
            1 => ['stock_quantity' => 120, 'name' => 'Wireless Headphones'],
            2 => ['stock_quantity' => 85, 'name' => 'Smart Watch'],
            3 => ['stock_quantity' => 200, 'name' => 'Laptop Backpack'],
            4 => ['stock_quantity' => 150, 'name' => 'Bluetooth Speaker'],
            5 => ['stock_quantity' => 75, 'name' => 'Gaming Mouse'],
            6 => ['stock_quantity' => 120, 'name' => 'USB-C Hub'],
            7 => ['stock_quantity' => 200, 'name' => 'Cotton T-Shirt'],
            8 => ['stock_quantity' => 35, 'name' => 'Garden Tools Set'],
            9 => ['stock_quantity' => 80, 'name' => 'Bestseller Novel'],
            10 => ['stock_quantity' => 60, 'name' => 'Basketball']
        ];
        
        if (isset($demo_products[$product_id])) {
            echo json_encode([
                'available_stock' => $demo_products[$product_id]['stock_quantity'],
                'product_name' => $demo_products[$product_id]['name'],
                'product_id' => $product_id
            ]);
        } else {
            echo json_encode(['error' => 'Product not found']);
        }
    }
} catch (Exception $e) {
    error_log("Stock check error: " . $e->getMessage());
    echo json_encode(['error' => 'Database error']);
}
?>

--- File: assets\css\auth.css ---
/**
 * Login & Registration Page Styles 
 */

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

body {
    background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 20px;
}

.container {
    display: flex;
    max-width: 1000px;
    width: 100%;
    background: white;
    border-radius: 16px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    overflow: hidden;
}

.left-panel {
    flex: 1;
    background: linear-gradient(135deg, #28ACD8 0%, #1d4ed8 100%);
    color: white;
    padding: 60px 40px;
    display: flex;
    flex-direction: column;
    justify-content: center;
}

.logo {
    font-size: 28px;
    font-weight: 700;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
}

.logo i {
    margin-right: 10px;
    font-size: 32px;
}

.left-panel h1 {
    font-size: 32px;
    margin-bottom: 20px;
    line-height: 1.2;
}

.left-panel p {
    font-size: 16px;
    opacity: 0.9;
    line-height: 1.6;
    margin-bottom: 30px;
}

.features {
    list-style: none;
}

.features li {
    margin-bottom: 15px;
    display: flex;
    align-items: center;
}

.features i {
    margin-right: 10px;
    background: rgba(255, 255, 255, 0.2);
    width: 28px;
    height: 28px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
}

.right-panel {
    flex: 1;
    padding: 50px 40px;
    display: flex;
    flex-direction: column;
}

.alert {
    padding: 0.75rem 1rem;
    margin-bottom: 1rem;
    border-radius: 0.5rem;
    border: 1px solid transparent;
}

.alert-error {
    color: #721c24;
    background-color: #f8d7da;
    border-color: #f5c6cb;
}

.alert-success {
    color: #155724;
    background-color: #d4edda;
    border-color: #c3e6cb;
}

/* Login Type Selector */
.login-type-selector {
    display: flex;
    background: #f8fafc;
    border-radius: 12px;
    padding: 4px;
    margin-bottom: 2rem;
    border: 1px solid #e2e8f0;
}

.login-type-btn {
    flex: 1;
    padding: 12px 16px;
    text-align: center;
    border: none;
    background: transparent;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 500;
    transition: all 0.3s;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
}

.login-type-btn.active {
    background: white;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    border: 1px solid #e2e8f0;
}

.login-type-btn.customer.active {
    color: #28ACD8;
}

.login-type-btn.staff.active {
    color: #f59e0b;
}

.login-type-btn.admin.active {
    color: #ef4444;
}

.login-type-icon {
    font-size: 16px;
}

.role-hint {
    font-size: 0.875rem;
    color: #6b7280;
    text-align: center;
    margin-bottom: 1.5rem;
    font-style: italic;
    min-height: 20px;
}

.form-group {
    margin-bottom: 24px;
}

.form-label {
    display: block;
    margin-bottom: 8px;
    font-weight: 500;
    color: #374151;
}

.form-input {
    width: 100%;
    padding: 14px 16px;
    border: 1px solid #d1d5db;
    border-radius: 8px;
    font-size: 16px;
    transition: all 0.3s;
}

.form-input:focus {
    outline: none;
    border-color: #28ACD8;
    box-shadow: 0 0 0 3px rgba(40, 172, 216, 0.1);
}

.form-input.error {
    border-color: #ef4444;
}

.error-message {
    color: #ef4444;
    font-size: 0.875rem;
    margin-top: 0.25rem;
    display: none;
}

.btn-submit {
    width: 100%;
    padding: 14px;
    background: #28ACD8;
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
    margin-top: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
}

.btn-submit:hover {
    background: #1d4ed8;
}

.btn-submit:disabled {
    background: #9ca3af;
    cursor: not-allowed;
}

.auth-links {
    text-align: center;
    margin-top: 1.5rem;
    color: #6b7280;
}

.auth-links a {
    color: #28ACD8;
    text-decoration: none;
    font-size: 0.875rem;
}

.auth-links a:hover {
    text-decoration: underline;
}

.login-link {
    text-align: center;
    margin-top: 1.5rem;
    color: #6b7280;
}

.login-link a {
    color: #28ACD8;
    text-decoration: none;
}

.login-link a:hover {
    text-decoration: underline;
}

.password-toggle {
    position: relative;
}

.password-toggle input {
    padding-right: 50px;
}

.toggle-btn {
    position: absolute;
    right: 16px;
    top: 50%;
    transform: translateY(-50%);
    background: none;
    border: none;
    color: #6b7280;
    cursor: pointer;
    padding: 4px;
}

.form-options {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
}

.remember-me {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    cursor: pointer;
}

.remember-me input[type="checkbox"] {
    width: 1rem;
    height: 1rem;
    border: 1px solid #d1d5db;
    border-radius: 0.25rem;
    cursor: pointer;
}

.remember-me span {
    font-size: 0.875rem;
    color: #374151;
}

.forgot-password {
    font-size: 0.875rem;
    color: #28ACD8;
    text-decoration: none;
}

.forgot-password:hover {
    text-decoration: underline;
}

.loading-spinner {
    display: inline-block;
    width: 1rem;
    height: 1rem;
    border: 2px solid #ffffff;
    border-radius: 50%;
    border-top-color: transparent;
    animation: spin 1s ease-in-out infinite;
}

@keyframes spin {
    to { 
        transform: rotate(360deg); 
    }
}

.demo-accounts {
    margin-top: 2rem;
    padding: 1rem;
    background: #f8fafc;
    border-radius: 0.5rem;
    border: 1px solid #e2e8f0;
}

.demo-accounts h4 {
    margin-bottom: 0.5rem;
    color: #374151;
    font-size: 0.875rem;
    font-weight: 600;
}

.demo-account {
    font-size: 0.75rem;
    color: #6b7280;
    margin-bottom: 0.25rem;
    cursor: pointer;
    padding: 0.25rem;
    border-radius: 0.25rem;
    transition: background-color 0.2s;
}

.demo-account:hover {
    background-color: #e2e8f0;
}

/* Back to Home Styles */
.back-to-home {
    text-align: center;
    margin-top: 1.5rem;
    padding-top: 1.5rem;
    border-top: 1px solid #e5e7eb;
}

.back-to-home a {
    color: #6b7280;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    transition: color 0.3s ease;
    font-size: 0.875rem;
    padding: 0.5rem 1rem;
    border-radius: 0.375rem;
}

.back-to-home a:hover {
    color: #374151;
    background-color: #f8fafc;
}

/* Left panel specific back to home */
.left-panel .back-to-home {
    margin-top: auto;
    border-top: 1px solid rgba(255, 255, 255, 0.2);
    padding-top: 1.5rem;
}

.left-panel .back-to-home a {
    color: rgba(255, 255, 255, 0.8);
    justify-content: center;
}

.left-panel .back-to-home a:hover {
    color: white;
    background-color: rgba(255, 255, 255, 0.1);
}

/* Right panel specific back to home */
.right-panel .back-to-home {
    margin-top: 1rem;
}

@media (max-width: 768px) {
    .container {
        flex-direction: column;
    }
    
    .left-panel {
        padding: 40px 30px;
    }
    
    .right-panel {
        padding: 40px 30px;
    }
    
    .login-type-selector {
        flex-direction: column;
    }
    
    .back-to-home a {
        font-size: 0.8rem;
        padding: 0.4rem 0.8rem;
    }
}

--- File: assets\css\style.css ---
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

:root {
    --primary-color: #28ACD8;
    --primary-dark: #1d4ed8;
    --secondary-color: #64748b;
    --accent-color: #f59e0b;
    --success-color: #10b981;
    --danger-color: #ef4444;
    --warning-color: #f59e0b;
    --info-color: #3b82f6;
    --light-bg: #f8fafc;
    --dark-bg: #1e293b;
    --text-dark: #334155;
    --text-light: #64748b;
    --border-color: #e2e8f0;
    --sidebar-bg: #1e293b;
    --sidebar-text: #e2e8f0;
    --sidebar-hover: #334155;
    --card-bg: #ffffff;
    --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
    --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
}

body {
    font-family: 'Inter', sans-serif;
    line-height: 1.6;
    color: var(--text-dark);
    background-color: white;
}

.container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 20px;
}

/* Header Styles */
.header {
    background: white;
    box-shadow: var(--shadow);
    position: sticky;
    top: 0;
    z-index: 1000;
}

.header-content {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem 0;
}

.logo {
    font-size: 1.75rem;
    font-weight: 700;
    color: var(--primary-color);
    text-decoration: none;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.nav-links {
    display: flex;
    list-style: none;
    gap: 2rem;
}

.nav-links a {
    text-decoration: none;
    color: var(--text-dark);
    font-weight: 500;
    transition: color 0.3s;
    padding: 0.5rem 0;
}

.nav-links a:hover {
    color: var(--primary-color);
}

/* Mobile Navigation Styles */
.mobile-nav-toggle {
    display: none;
    background: none;
    border: none;
    font-size: 1.5rem;
    color: var(--text-dark);
    cursor: pointer;
    padding: 0.5rem;
    z-index: 1001;
}

.mobile-nav {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100vh;
    background: rgba(0, 0, 0, 0.5);
    z-index: 1000;
    backdrop-filter: blur(5px);
}

.mobile-nav.active {
    display: block;
}

.mobile-nav-sidebar {
    position: absolute;
    top: 0;
    left: 0;
    width: 300px;
    height: 100%;
    background: var(--card-bg);
    box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
    transform: translateX(-100%);
    transition: transform 0.3s ease-in-out;
    display: flex;
    flex-direction: column;
}

.mobile-nav.active .mobile-nav-sidebar {
    transform: translateX(0);
}

/* Mobile Navigation Header - Single Line Design */
.mobile-nav-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem 1.5rem;
    background: var(--primary-color);
    color: white;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.mobile-nav-brand {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    color: white;
    font-size: 1.1rem;
    font-weight: 600;
}

.mobile-nav-brand i {
    font-size: 1.3rem;
}

.mobile-nav-close {
    background: none;
    border: none;
    color: white;
    font-size: 1.25rem;
    cursor: pointer;
    padding: 0.5rem;
    border-radius: 0.375rem;
    transition: all 0.3s;
    display: flex;
    align-items: center;
    justify-content: center;
}

.mobile-nav-close:hover {
    background: rgba(255, 255, 255, 0.1);
    transform: rotate(90deg);
}

/* Compact User Info */
.mobile-nav-user {
    padding: 1.25rem 1.5rem;
    border-bottom: 1px solid var(--border-color);
    background: var(--light-bg);
    display: flex;
    align-items: center;
    gap: 1rem;
}

.mobile-nav-user-avatar {
    width: 45px;
    height: 45px;
    border-radius: 50%;
    background: var(--primary-color);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    font-size: 1.1rem;
    flex-shrink: 0;
}

.mobile-nav-user-info {
    flex: 1;
    min-width: 0;
}

.mobile-nav-user .username {
    font-weight: 600;
    color: var(--text-dark);
    font-size: 1rem;
    margin-bottom: 0.25rem;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.mobile-nav-user .email {
    color: var(--text-light);
    font-size: 0.85rem;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.mobile-nav-links {
    list-style: none;
    margin: 0;
    padding: 0;
}

.mobile-nav-links li {
    margin: 0;
}

.mobile-nav-links a {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem 1.5rem;
    color: var(--text-dark);
    text-decoration: none;
    transition: all 0.3s;
    border-left: 4px solid transparent;
    font-weight: 500;
}

.mobile-nav-links a:hover {
    background: var(--light-bg);
    border-left-color: var(--primary-color);
    color: var(--primary-color);
}

.mobile-nav-links a.active {
    background: var(--light-bg);
    border-left-color: var(--primary-color);
    color: var(--primary-color);
}

.mobile-nav-links a i {
    width: 1.25rem;
    text-align: center;
    font-size: 1.1rem;
}

.mobile-nav-divider {
    height: 1px;
    background: var(--border-color);
    margin: 0.5rem 1.5rem;
}

.mobile-nav-footer {
    padding: 1rem 1.5rem;
    border-top: 1px solid var(--border-color);
    background: var(--light-bg);
}

.mobile-nav-cart {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 0.75rem;
    background: white;
    border-radius: 0.5rem;
    text-decoration: none;
    color: var(--text-dark);
    transition: all 0.3s;
    border: 1px solid var(--border-color);
}

.mobile-nav-cart:hover {
    border-color: var(--primary-color);
    color: var(--primary-color);
}

.mobile-nav-cart-info {
    flex: 1;
}

.mobile-nav-cart-label {
    font-size: 0.875rem;
    color: var(--text-light);
    margin-bottom: 0.25rem;
}

.mobile-nav-cart-count {
    font-weight: 600;
    color: var(--text-dark);
}

.mobile-nav-cart-icon {
    position: relative;
    font-size: 1.25rem;
}

.mobile-nav-cart-badge {
    position: absolute;
    top: -5px;
    right: -5px;
    background: var(--danger-color);
    color: white;
    border-radius: 50%;
    width: 18px;
    height: 18px;
    font-size: 0.7rem;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
}

/* Mobile Nav Content - Ensure proper scrolling */
.mobile-nav-content {
    flex: 1;
    overflow-y: auto;
    padding: 1rem 0;
}

/* Role badge styling for user info */
.mobile-nav-user .role {
    display: inline-block;
    background: var(--primary-color);
    color: white;
    padding: 0.2rem 0.6rem;
    border-radius: 1rem;
    font-size: 0.7rem;
    font-weight: 500;
    margin-top: 0.25rem;
}

/* Logout Link */
.logout-link {
    color: var(--danger-color) !important;
}

.logout-link:hover {
    color: var(--danger-color) !important;
    background: #fef2f2 !important;
}

.header-actions {
    display: flex;
    align-items: center;
    gap: 1.5rem;
}

.search-box {
    position: relative;
    width: 300px;
}

.search-box input {
    width: 100%;
    padding: 0.75rem 1rem 0.75rem 2.5rem;
    border: 1px solid var(--border-color);
    border-radius: 0.5rem;
    font-size: 0.875rem;
    transition: all 0.3s;
}

.search-box input:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
}

.search-icon {
    position: absolute;
    left: 0.75rem;
    top: 50%;
    transform: translateY(-50%);
    color: var(--text-light);
}

.cart-icon {
    position: relative;
    text-decoration: none;
    color: var(--text-dark);
    font-size: 1.25rem;
    padding: 0.5rem;
}

.cart-count {
    position: absolute;
    top: -2px;
    right: -2px;
    background: var(--danger-color);
    color: white;
    border-radius: 50%;
    width: 18px;
    height: 18px;
    font-size: 0.75rem;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
}

.btn {
    padding: 0.75rem 1.5rem;
    border: none;
    border-radius: 0.5rem;
    font-weight: 500;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    cursor: pointer;
    transition: all 0.3s;
    font-size: 0.875rem;
}

.btn-primary {
    background: var(--primary-color);
    color: white;
}

.btn-primary:hover {
    background: var(--primary-dark);
    transform: translateY(-1px);
    box-shadow: var(--shadow-lg);
}

.btn-outline {
    border: 1px solid var(--border-color);
    background: white;
    color: var(--text-dark);
}

.btn-outline:hover {
    border-color: var(--primary-color);
    color: var(--primary-color);
}

/* User Dropdown Styles */
.user-menu {
    position: relative;
}

.user-dropdown {
    position: absolute;
    top: 100%;
    right: 0;
    margin-top: 0.5rem;
    background: white;
    border: 1px solid var(--border-color);
    border-radius: 0.5rem;
    box-shadow: var(--shadow-lg);
    min-width: 200px;
    z-index: 1000;
    display: none;
}

.user-dropdown.show {
    display: block;
}

.user-dropdown-header {
    padding: 1rem;
    border-bottom: 1px solid var(--border-color);
}

.user-dropdown-header .username {
    font-weight: 500;
    color: var(--text-dark);
    margin-bottom: 0.25rem;
}

.user-dropdown-header .email {
    font-size: 0.875rem;
    color: var(--text-light);
    margin-bottom: 0.5rem;
}

.user-dropdown-header .role {
    font-size: 0.75rem;
    color: var(--text-light);
    padding: 0.25rem 0.5rem;
    background: var(--light-bg);
    border-radius: 0.25rem;
    display: inline-block;
}

.user-dropdown-links {
    padding: 0.5rem;
}

.user-dropdown-link {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1rem;
    color: var(--text-dark);
    text-decoration: none;
    border-radius: 0.375rem;
    transition: all 0.3s;
}

.user-dropdown-link:hover {
    background: var(--light-bg);
    color: var(--primary-color);
}

.user-dropdown-link.logout {
    color: var(--danger-color);
}

.user-dropdown-link.logout:hover {
    background: #fef2f2;
    color: var(--danger-color);
}

.user-dropdown-divider {
    height: 1px;
    background: var(--border-color);
    margin: 0.5rem 0;
}

/* Cart Page Styles - NEW FROM cart.php */
.cart-page {
    padding: 3rem 0;
    background: var(--light-bg);
    min-height: calc(100vh - 200px);
}

.page-header {
    text-align: center;
    margin-bottom: 3rem;
}

.page-header h1 {
    font-size: 2.5rem;
    font-weight: 700;
    color: var(--text-dark);
    margin-bottom: 1rem;
}

.page-header p {
    color: var(--text-light);
    font-size: 1.125rem;
}

.cart-content {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 3rem;
    align-items: start;
}

/* Cart Items - NEW FROM cart.php */
.cart-items {
    background: white;
    border-radius: 0.75rem;
    box-shadow: var(--shadow);
    padding: 2rem;
}

.cart-item {
    display: flex;
    gap: 1.5rem;
    padding: 1.5rem 0;
    border-bottom: 1px solid var(--border-color);
}

.cart-item:last-child {
    border-bottom: none;
}

.item-icon {
    width: 120px;
    height: 120px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 0.5rem;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    color: white;
    font-size: 2.5rem;
}

.item-details {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.item-name {
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--text-dark);
    margin-bottom: 0.25rem;
}

.item-price {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--primary-color);
    margin-bottom: 0.5rem;
}

.item-stock {
    color: var(--success-color);
    font-size: 0.875rem;
    font-weight: 500;
    margin-bottom: 1rem;
}

.item-actions {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-top: auto;
}

.quantity-selector {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.quantity-btn {
    width: 32px;
    height: 32px;
    border: 1px solid var(--border-color);
    background: white;
    border-radius: 0.375rem;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s;
    font-size: 0.875rem;
}

.quantity-btn:hover {
    border-color: var(--primary-color);
    color: var(--primary-color);
}

.quantity-input {
    width: 60px;
    text-align: center;
    padding: 0.5rem;
    border: 1px solid var(--border-color);
    border-radius: 0.375rem;
    font-size: 0.875rem;
}

.remove-btn {
    background: none;
    border: none;
    color: var(--danger-color);
    cursor: pointer;
    padding: 0.5rem;
    border-radius: 0.375rem;
    transition: all 0.3s;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.875rem;
}

.remove-btn:hover {
    background: #fef2f2;
}

/* Order Summary - NEW FROM cart.php */
.order-summary {
    background: white;
    border-radius: 0.75rem;
    box-shadow: var(--shadow);
    padding: 2rem;
    position: sticky;
    top: 2rem;
}

.summary-header {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--text-dark);
    margin-bottom: 1.5rem;
    padding-bottom: 1rem;
    border-bottom: 2px solid var(--border-color);
}

.summary-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem 0;
    border-bottom: 1px solid var(--border-color);
}

.summary-row:last-child {
    border-bottom: none;
}

.summary-label {
    color: var(--text-light);
    font-weight: 500;
}

.summary-value {
    color: var(--text-dark);
    font-weight: 600;
}

.summary-total {
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--primary-color);
}

.checkout-btn {
    width: 100%;
    justify-content: center;
    padding: 1rem 2rem;
    font-size: 1.125rem;
    margin-top: 1.5rem;
}

.shipping-note {
    text-align: center;
    color: var(--success-color);
    font-size: 0.875rem;
    margin-top: 0.5rem;
}

/* Empty Cart - NEW FROM cart.php */
.empty-cart {
    text-align: center;
    padding: 4rem 2rem;
    grid-column: 1 / -1;
}

.empty-cart-icon {
    font-size: 4rem;
    color: var(--text-light);
    margin-bottom: 1.5rem;
    opacity: 0.5;
}

.empty-cart h2 {
    font-size: 1.75rem;
    color: var(--text-dark);
    margin-bottom: 1rem;
}

.empty-cart p {
    color: var(--text-light);
    margin-bottom: 2rem;
    font-size: 1.125rem;
}

/* Continue Shopping - NEW FROM cart.php */
.continue-shopping {
    text-align: center;
    margin-top: 2rem;
}

/* Categories Page Styles */
.categories-page {
    padding: 3rem 0;
    background: var(--light-bg);
    min-height: calc(100vh - 200px);
}

/* Categories Grid */
.categories-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 2rem;
    margin-bottom: 3rem;
}

.category-card {
    background: white;
    border-radius: 1rem;
    box-shadow: var(--shadow);
    overflow: hidden;
    transition: all 0.3s;
    text-decoration: none;
    color: inherit;
    display: block;
}

.category-card:hover {
    transform: translateY(-8px);
    box-shadow: var(--shadow-xl);
    color: inherit;
    text-decoration: none;
}

.category-icon {
    width: 100%;
    height: 160px;
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 3.5rem;
    position: relative;
    overflow: hidden;
}

.category-icon::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(45deg, transparent 0%, rgba(255,255,255,0.1) 100%);
}

.category-info {
    padding: 1.5rem;
}

.category-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 0.75rem;
}

.category-name {
    font-size: 1.375rem;
    font-weight: 700;
    color: var(--text-dark);
    margin-bottom: 0.5rem;
    line-height: 1.3;
}

.product-count {
    background: var(--primary-color);
    color: white;
    padding: 0.25rem 0.75rem;
    border-radius: 1rem;
    font-size: 0.75rem;
    font-weight: 600;
    white-space: nowrap;
    flex-shrink: 0;
    margin-left: 0.5rem;
}

.category-description {
    color: var(--text-light);
    font-size: 0.875rem;
    line-height: 1.5;
    margin-bottom: 1rem;
    display: -webkit-box;
    -webkit-box-orient: vertical;
    overflow: hidden;
    min-height: 2.625rem;
}

.view-products-btn {
    width: 100%;
    justify-content: center;
    padding: 0.75rem;
    font-size: 0.875rem;
    margin-top: 0.5rem;
}

/* Popular Categories Section */
.popular-categories {
    margin-top: 4rem;
}

.section-header {
    text-align: center;
    margin-bottom: 2rem;
}

.section-header h2 {
    font-size: 2rem;
    font-weight: 700;
    color: var(--text-dark);
    margin-bottom: 0.5rem;
}

.section-header p {
    color: var(--text-light);
    font-size: 1.125rem;
}

/* Stats Section */
.stats-section {
    background: white;
    border-radius: 1rem;
    box-shadow: var(--shadow);
    padding: 2rem;
    margin-bottom: 3rem;
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1.5rem;
}

.stat-card {
    text-align: center;
    padding: 1.5rem;
    background: var(--light-bg);
    border-radius: 0.75rem;
    transition: all 0.3s;
}

.stat-card:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow);
}

.stat-icon {
    font-size: 2rem;
    color: var(--primary-color);
    margin-bottom: 1rem;
}

.stat-number {
    font-size: 2rem;
    font-weight: 700;
    color: var(--text-dark);
    margin-bottom: 0.5rem;
}

.stat-label {
    color: var(--text-light);
    font-size: 0.875rem;
    font-weight: 500;
}

/* No Categories Message */
.no-categories {
    text-align: center;
    padding: 4rem 2rem;
    grid-column: 1 / -1;
}

.no-categories-icon {
    font-size: 4rem;
    color: var(--text-light);
    margin-bottom: 1.5rem;
    opacity: 0.5;
}

.no-categories h2 {
    font-size: 1.75rem;
    color: var(--text-dark);
    margin-bottom: 1rem;
}

.no-categories p {
    color: var(--text-light);
    margin-bottom: 2rem;
    font-size: 1.125rem;
}

/* Products Page Styles */
.products-page {
    padding: 3rem 0;
    background: var(--light-bg);
    min-height: calc(100vh - 200px);
}

/* Filters and Search */
.filters-section {
    background: white;
    border-radius: 0.75rem;
    box-shadow: var(--shadow);
    padding: 2rem;
    margin-bottom: 2rem;
}

.filters-grid {
    display: grid;
    grid-template-columns: 2fr 1fr 1fr auto;
    gap: 1.5rem;
    align-items: end;
}

.filter-group {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.filter-label {
    font-size: 0.875rem;
    font-weight: 500;
    color: var(--text-dark);
}

.filter-select, .filter-input {
    padding: 0.75rem;
    border: 1px solid var(--border-color);
    border-radius: 0.5rem;
    font-size: 0.875rem;
    transition: all 0.3s;
}

.filter-select:focus, .filter-input:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
}

/* Products Grid */
.products-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 2rem;
}

.product-card {
    background: white;
    border-radius: 0.75rem;
    box-shadow: var(--shadow);
    overflow: hidden;
    transition: all 0.3s;
}

.product-card:hover {
    transform: translateY(-5px);
    box-shadow: var(--shadow-lg);
}

.product-icon {
    width: 100%;
    height: 200px;
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 3rem;
}

.category-badge {
    position: absolute;
    top: 0.75rem;
    left: 0.75rem;
    background: rgba(255, 255, 255, 0.9);
    color: var(--primary-color);
    padding: 0.25rem 0.75rem;
    border-radius: 1rem;
    font-size: 0.75rem;
    font-weight: 600;
    backdrop-filter: blur(10px);
}

.product-info {
    padding: 1.5rem;
}

.product-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 1rem;
}

.product-name {
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--text-dark);
    margin-bottom: 0.5rem;
}

.product-price {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--primary-color);
}

.product-description {
    color: var(--text-light);
    font-size: 0.875rem;
    line-height: 1.5;
    margin-bottom: 1rem;
    display: -webkit-box;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.product-rating {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 1rem;
}

.rating-stars {
    color: var(--accent-color);
}

.rating-value {
    color: var(--text-light);
    font-size: 0.875rem;
}

.product-stock {
    color: var(--success-color);
    font-size: 0.875rem;
    font-weight: 500;
    margin-bottom: 1.5rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.stock-low {
    color: var(--accent-color);
}

.stock-out {
    color: var(--danger-color);
}

.add-to-cart-form {
    display: flex;
    gap: 1rem;
    align-items: center;
}

.quantity-input {
    width: 80px;
    padding: 0.5rem;
    border: 1px solid var(--border-color);
    border-radius: 0.375rem;
    text-align: center;
    font-size: 0.875rem;
}

.add-to-cart-btn {
    flex: 1;
    justify-content: center;
    padding: 0.75rem;
}

.btn:disabled {
    opacity: 0.6;
    cursor: not-allowed;
}

/* No Products Message */
.no-products {
    text-align: center;
    padding: 4rem 2rem;
    grid-column: 1 / -1;
}

.no-products-icon {
    font-size: 4rem;
    color: var(--text-light);
    margin-bottom: 1.5rem;
    opacity: 0.5;
}

.no-products h2 {
    font-size: 1.75rem;
    color: var(--text-dark);
    margin-bottom: 1rem;
}

.no-products p {
    color: var(--text-light);
    margin-bottom: 2rem;
    font-size: 1.125rem;
}

/* Hero Section */
.hero-section {
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
    color: white;
    padding: 4rem 0;
    text-align: center;
}

.hero-content h1 {
    font-size: 3rem;
    font-weight: 700;
    margin-bottom: 1rem;
}

.hero-content p {
    font-size: 1.25rem;
    opacity: 0.9;
    margin-bottom: 2rem;
    max-width: 600px;
    margin-left: auto;
    margin-right: auto;
}

.search-container {
    max-width: 500px;
    margin: 0 auto;
}

.search-form {
    display: flex;
}

.search-input {
    flex: 1;
    padding: 1rem 1.5rem;
    border: none;
    border-radius: 0.5rem 0 0 0.5rem;
    font-size: 1rem;
}

.search-input:focus {
    outline: none;
}

.search-button {
    background: var(--primary-color);
    color: white;
    border: none;
    padding: 0 1.5rem;
    border-radius: 0 0.5rem 0.5rem 0;
    cursor: pointer;
    font-size: 1rem;
    transition: background 0.3s;
}

.search-button:hover {
    background: var(--primary-dark);
}

/* Products Section */
.products-section {
    padding: 4rem 0;
    background: var(--light-bg);
}

/* Footer */
.footer {
    background: var(--dark-bg);
    color: white;
    padding: 3rem 0 1rem;
}

.footer-content {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 2rem;
    margin-bottom: 2rem;
}

.footer-section h3 {
    color: var(--primary-color);
    margin-bottom: 1rem;
    font-size: 1.2rem;
}

.footer-section p {
    color: #cbd5e1;
    line-height: 1.6;
    margin-bottom: 1.5rem;
}

.footer-bottom {
    text-align: center;
    padding-top: 2rem;
    border-top: 1px solid #374151;
    color: #9ca3af;
}


/* Autocomplete Styles */
.autocomplete-list {
    position: absolute;
    background: white;
    border: 1px solid #e2e8f0;
    border-radius: 0.5rem;
    max-height: 300px;
    overflow-y: auto;
    width: 100%;
    z-index: 1000;
    box-shadow: 0 10px 25px rgba(0,0,0,0.1);
    display: none;
    margin-top: 0.25rem;
}

.autocomplete-item {
    padding: 12px 16px;
    cursor: pointer;
    border-bottom: 1px solid #f8fafc;
    display: flex;
    justify-content: space-between;
    align-items: center;
    transition: background-color 0.2s;
}

.autocomplete-item:hover,
.autocomplete-item.active {
    background-color: #f8fafc;
}

.autocomplete-item:last-child {
    border-bottom: none;
}

.autocomplete-item mark {
    background-color: #fef3c7;
    padding: 2px 0;
    border-radius: 2px;
}

/* Stock Validation Styles */
.stock-error-message {
    color: #e74c3c;
    font-size: 0.8rem;
    margin-top: 0.25rem;
    font-weight: 500;
}

.quantity-input:invalid,
.quantity-input.error {
    border-color: #e74c3c !important;
    background-color: #fef2f2 !important;
}

/* Notification Styles */
.notification {
    position: fixed;
    top: 20px;
    right: 20px;
    padding: 15px 20px;
    border-radius: 5px;
    color: white;
    z-index: 10000;
    font-weight: 500;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    display: flex;
    align-items: center;
    gap: 8px;
}

.notification-success {
    background: #10b981;
}

.notification-error {
    background: #e74c3c;
}

/* Animations */
@keyframes slideInRight {
    from {
        transform: translateX(100%);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}

@keyframes slideOutRight {
    from {
        transform: translateX(0);
        opacity: 1;
    }
    to {
        transform: translateX(100%);
        opacity: 0;
    }
}

/* Loading States */
.loading {
    opacity: 0.7;
    pointer-events: none;
}

/* ===== DASHBOARD STYLES ===== */

/* Layout */
.dashboard-container {
    display: flex;
    min-height: 100vh;
}

/* Sidebar */
.sidebar {
    width: 250px;
    background: var(--sidebar-bg);
    color: var(--sidebar-text);
    transition: all 0.3s ease;
    position: fixed;
    height: 100vh;
    z-index: 1000;
    overflow-y: auto;
}

.sidebar.collapsed {
    width: 70px;
}

.sidebar-header {
    padding: 1.5rem 1rem;
    border-bottom: 1px solid var(--sidebar-hover);
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.sidebar-logo {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--primary-color);
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.sidebar-toggle {
    background: none;
    border: none;
    color: var(--sidebar-text);
    cursor: pointer;
    padding: 0.5rem;
    border-radius: 0.375rem;
    transition: background 0.3s;
}

.sidebar-toggle:hover {
    background: var(--sidebar-hover);
}

.sidebar-menu {
    padding: 1rem 0;
}

.menu-item {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.75rem 1rem;
    color: var(--sidebar-text);
    text-decoration: none;
    transition: all 0.3s;
    border-left: 3px solid transparent;
}

.menu-item:hover {
    background: var(--sidebar-hover);
    border-left-color: var(--primary-color);
}

.menu-item.active {
    background: var(--sidebar-hover);
    border-left-color: var(--primary-color);
    color: var(--primary-color);
}

.menu-item i {
    width: 20px;
    text-align: center;
}

.menu-text {
    white-space: nowrap;
    overflow: hidden;
}

.sidebar.collapsed .menu-text {
    display: none;
}

.menu-badge {
    margin-left: auto;
    background: var(--primary-color);
    color: white;
    padding: 0.25rem 0.5rem;
    border-radius: 0.375rem;
    font-size: 0.75rem;
    font-weight: 600;
}

/* Main Content */
.main-content {
    flex: 1;
    margin-left: 250px;
    transition: margin-left 0.3s ease;
    background: var(--light-bg);
    min-height: 100vh;
}

.main-content.expanded {
    margin-left: 70px;
}

/* Top Header */
.top-header {
    background: white;
    box-shadow: var(--shadow);
    position: sticky;
    top: 0;
    z-index: 999;
    padding: 1rem 2rem;
}

.page-title h1 {
    font-size: 1.5rem;
    font-weight: 600;
    color: var(--text-dark);
}

/* Dashboard Content */
.dashboard-content {
    padding: 2rem;
}

/* Stats Grid - Dashboard Version */
.dashboard-stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
}

.dashboard-stat-card {
    background: var(--card-bg);
    padding: 1.5rem;
    border-radius: 0.75rem;
    box-shadow: var(--shadow);
    border-left: 4px solid var(--primary-color);
}

.dashboard-stat-card.success {
    border-left-color: var(--success-color);
}

.dashboard-stat-card.warning {
    border-left-color: var(--warning-color);
}

.dashboard-stat-card.danger {
    border-left-color: var(--danger-color);
}

.stat-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 1rem;
}

.stat-title {
    font-size: 0.875rem;
    color: var(--text-light);
    font-weight: 500;
}

.dashboard-stat-icon {
    width: 40px;
    height: 40px;
    border-radius: 0.5rem;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
}

.dashboard-stat-icon.primary {
    background: var(--primary-color);
}

.dashboard-stat-icon.success {
    background: var(--success-color);
}

.dashboard-stat-icon.warning {
    background: var(--warning-color);
}

.dashboard-stat-icon.danger {
    background: var(--danger-color);
}

.stat-value {
    font-size: 1.875rem;
    font-weight: 700;
    color: var(--text-dark);
    margin-bottom: 0.5rem;
}

.stat-change {
    font-size: 0.875rem;
    display: flex;
    align-items: center;
    gap: 0.25rem;
}

.stat-change.positive {
    color: var(--success-color);
}

.stat-change.negative {
    color: var(--danger-color);
}

/* Charts Grid */
.charts-grid {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 1.5rem;
    margin-bottom: 2rem;
}

.chart-card {
    background: var(--card-bg);
    padding: 1.5rem;
    border-radius: 0.75rem;
    box-shadow: var(--shadow);
}

.chart-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
}

.chart-title {
    font-size: 1.125rem;
    font-weight: 600;
    color: var(--text-dark);
}

.chart-actions {
    display: flex;
    gap: 0.5rem;
}

.chart-container {
    height: 300px;
    position: relative;
}

/* Tables */
.table-card {
    background: var(--card-bg);
    border-radius: 0.75rem;
    box-shadow: var(--shadow);
    overflow: hidden;
}

.table-header {
    padding: 1.5rem;
    border-bottom: 1px solid var(--border-color);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.table-title {
    font-size: 1.125rem;
    font-weight: 600;
    color: var(--text-dark);
}

.table-actions {
    display: flex;
    gap: 0.5rem;
}

.table-container {
    overflow-x: auto;
}

.data-table {
    width: 100%;
    border-collapse: collapse;
}

.data-table th,
.data-table td {
    padding: 1rem 1.5rem;
    text-align: left;
    border-bottom: 1px solid var(--border-color);
}

.data-table th {
    background: var(--light-bg);
    font-weight: 600;
    color: var(--text-dark);
    font-size: 0.875rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.data-table tbody tr:hover {
    background: var(--light-bg);
}

/* Status Badges */
.status-badge {
    padding: 0.25rem 0.75rem;
    border-radius: 1rem;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.status-active {
    background: #d1fae5;
    color: var(--success-color);
}

.status-pending {
    background: #fef3c7;
    color: var(--warning-color);
}

.status-inactive {
    background: #e5e7eb;
    color: var(--text-light);
}

/* Notification */
.notification {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 1001;
    max-width: 400px;
}

.notification-content {
    background: white;
    padding: 1rem;
    border-radius: 0.5rem;
    box-shadow: var(--shadow-lg);
    border-left: 4px solid var(--primary-color);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.notification-success {
    border-left-color: var(--success-color);
}

.notification-error {
    border-left-color: var(--danger-color);
}

.notification-warning {
    border-left-color: var(--warning-color);
}

/* Loading Spinner */
.loading-spinner {
    display: inline-block;
    width: 20px;
    height: 20px;
    border: 2px solid #f3f3f3;
    border-top: 2px solid var(--primary-color);
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* Button Sizes */
.btn-sm {
    padding: 0.5rem 1rem;
    font-size: 0.75rem;
}

.btn-icon {
    padding: 0.5rem;
    border-radius: 0.375rem;
    background: none;
    border: none;
    cursor: pointer;
    color: var(--text-light);
    transition: all 0.3s;
}

.btn-icon:hover {
    color: var(--text-dark);
    background: var(--light-bg);
}

/* Form Styles */
.form-group {
    margin-bottom: 1.5rem;
}

.form-label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: 500;
    color: var(--text-dark);
}

.form-control {
    width: 100%;
    padding: 0.75rem;
    border: 1px solid var(--border-color);
    border-radius: 0.5rem;
    font-size: 1rem;
    transition: all 0.3s;
}

.form-control:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
}

/* Card Styles */
.card {
    background: var(--card-bg);
    border-radius: 0.75rem;
    box-shadow: var(--shadow);
    overflow: hidden;
}

.card-header {
    padding: 1.5rem;
    border-bottom: 1px solid var(--border-color);
}

.card-title {
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--text-dark);
    margin: 0;
}

.card-body {
    padding: 1.5rem;
}

/* Modal Styles */
.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    z-index: 1050;
    align-items: center;
    justify-content: center;
}

.modal.show {
    display: flex;
}

.modal-dialog {
    max-width: 500px;
    width: 90%;
    margin: 1rem;
}

.modal-content {
    background: white;
    border-radius: 0.75rem;
    box-shadow: var(--shadow-xl);
}

.modal-header {
    padding: 1.5rem;
    border-bottom: 1px solid var(--border-color);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.modal-title {
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--text-dark);
    margin: 0;
}

.modal-close {
    background: none;
    border: none;
    font-size: 1.5rem;
    color: var(--text-light);
    cursor: pointer;
    padding: 0.25rem;
}

.modal-body {
    padding: 1.5rem;
}

.modal-footer {
    padding: 1.5rem;
    border-top: 1px solid var(--border-color);
    display: flex;
    gap: 0.75rem;
    justify-content: flex-end;
}

/* Responsive Design */
@media (max-width: 1024px) {
    .charts-grid {
        grid-template-columns: 1fr;
    }
    
    .sidebar {
        width: 70px;
    }
    
    .main-content {
        margin-left: 70px;
    }
    
    .sidebar .menu-text {
        display: none;
    }
}

/* Phone View - Minimal Header */
@media (max-width: 768px) {
    .header-content {
        padding: 0.75rem 0;
    }

    .logo {
        font-size: 1.25rem;
    }

    .logo span {
        display: inline !important;
    }

    .nav-links {
        display: none;
    }

    .mobile-nav-toggle {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        background: none;
        border: none;
        font-size: 1.25rem;
        color: var(--text-dark);
        cursor: pointer;
        padding: 0.5rem;
    }

    .mobile-nav-toggle i {
        font-size: 1.25rem;
    }

    .header-actions {
        gap: 1rem;
    }

    .header-actions .search-box {
        display: none;
    }

    .user-menu .btn span {
        display: none;
    }

    .user-menu .btn {
        padding: 0.5rem;
        min-width: auto;
    }

    .cart-icon {
        padding: 0.5rem;
        font-size: 1.1rem;
    }

    /* Compact header layout */
    .header-content {
        display: grid;
        grid-template-columns: auto 1fr auto;
        gap: 1rem;
        align-items: center;
    }

    .mobile-nav-toggle {
        justify-self: start;
    }

    .logo {
        justify-self: center;
        font-size: 1.1rem;
    }

    .header-actions {
        justify-self: end;
    }

    /* Products page responsive */
    .filters-grid {
        grid-template-columns: 1fr;
        gap: 1rem;
    }

    .products-grid {
        grid-template-columns: 1fr;
    }

    .add-to-cart-form {
        flex-direction: column;
    }

    .quantity-input {
        width: 100%;
    }

    /* Categories page responsive */
    .categories-grid {
        grid-template-columns: 1fr;
    }

    .stats-grid {
        grid-template-columns: 1fr;
    }

    /* Cart page responsive - NEW FROM cart.php */
    .cart-content {
        grid-template-columns: 1fr;
        gap: 2rem;
    }

    .cart-item {
        flex-direction: column;
        text-align: center;
    }

    .item-icon {
        align-self: center;
    }

    .item-actions {
        justify-content: center;
    }

    .user-dropdown {
        position: fixed;
        top: auto;
        left: 50%;
        transform: translateX(-50%);
        width: 90%;
        max-width: 300px;
    }

    .page-header h1 {
        font-size: 2rem;
    }

    .section-header h2 {
        font-size: 1.75rem;
    }

    .autocomplete-list {
        position: fixed;
        top: auto;
        left: 10px;
        right: 10px;
        width: calc(100% - 20px);
        max-height: 50vh;
    }
    
    .autocomplete-item {
        padding: 10px 12px;
    }
}

@media (max-width: 480px) {
    .header-content {
        grid-template-columns: auto auto auto;
        gap: 0.5rem;
    }

    .logo {
        font-size: 1rem;
    }

    .logo i {
        font-size: 1.1rem;
    }

    .mobile-nav-toggle {
        font-size: 1.1rem;
    }

    .header-actions {
        gap: 0.75rem;
    }

    .categories-page {
        padding: 2rem 0;
    }

    .stats-section {
        padding: 1.5rem;
    }

    .category-icon {
        height: 140px;
        font-size: 3rem;
    }

    .category-info {
        padding: 1.25rem;
    }

    /* Cart page mobile styles - NEW FROM cart.php */
    .cart-page {
        padding: 2rem 0;
    }

    .cart-items {
        padding: 1.5rem;
    }

    .cart-item {
        padding: 1rem 0;
    }

    .item-icon {
        width: 100px;
        height: 100px;
        font-size: 2rem;
    }

    .order-summary {
        padding: 1.5rem;
    }
}

/* Enhanced Mobile Sidebar Animations */
.mobile-nav-sidebar {
    transform: translateX(-100%);
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.mobile-nav.active .mobile-nav-sidebar {
    transform: translateX(0);
}

/* Backdrop animation */
.mobile-nav {
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s ease;
}

.mobile-nav.active {
    opacity: 1;
    visibility: visible;
}

/* Smooth close button animation */
.mobile-nav-close {
    transition: all 0.3s ease;
}

.mobile-nav-close:hover {
    transform: rotate(90deg) scale(1.1);
}

/* Prevent body scroll when mobile nav is open */
body.mobile-nav-open {
    overflow: hidden;
}

/* Hide desktop logo on mobile, show in mobile toggle */
@media (max-width: 768px) {
    .desktop-logo {
        display: none;
    }
    
    .mobile-nav-toggle .logo {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        color: var(--primary-color);
        font-weight: 600;
        font-size: 1.1rem;
    }
    
    .mobile-nav-toggle .logo i {
        font-size: 1.2rem;
    }

    .user-menu {
        display: none;
    }
    
    .header-actions {
        gap: 0.75rem;
    }
    
    .cart-icon {
        margin-right: 0;
    }
}

@media (min-width: 769px) {
    .user-menu {
        display: block;
    }

    .mobile-nav-toggle .logo {
        display: none;
    }
}

/* Dark Mode Support */
@media (prefers-color-scheme: dark) {
    :root {
        --light-bg: #0f172a;
        --card-bg: #1e293b;
        --text-dark: #f1f5f9;
        --text-light: #94a3b8;
        --border-color: #334155;
    }
    
    body {
        background: var(--light-bg);
        color: var(--text-dark);
    }
}

/* Utility Classes */
.text-center { text-align: center; }
.text-left { text-align: left; }
.text-right { text-align: right; }

.mt-1 { margin-top: 0.25rem; }
.mt-2 { margin-top: 0.5rem; }
.mt-3 { margin-top: 1rem; }
.mt-4 { margin-top: 1.5rem; }
.mt-5 { margin-top: 3rem; }

.mb-1 { margin-bottom: 0.25rem; }
.mb-2 { margin-bottom: 0.5rem; }
.mb-3 { margin-bottom: 1rem; }
.mb-4 { margin-bottom: 1.5rem; }
.mb-5 { margin-bottom: 3rem; }

.p-1 { padding: 0.25rem; }
.p-2 { padding: 0.5rem; }
.p-3 { padding: 1rem; }
.p-4 { padding: 1.5rem; }
.p-5 { padding: 3rem; }

.d-flex { display: flex; }
.d-none { display: none; }
.justify-content-between { justify-content: space-between; }
.align-items-center { align-items: center; }
.flex-column { flex-direction: column; }
.flex-wrap { flex-wrap: wrap; }

.w-100 { width: 100%; }
.h-100 { height: 100%; }

/* Animation for adding to cart */
.adding-to-cart {
    animation: pulse 0.6s ease-in-out;
}

@keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(0.95); }
    100% { transform: scale(1); }
}

/* Animation for mobile nav overlay */
@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

.mobile-nav {
    animation: fadeIn 0.3s ease-in-out;
}

/* Close button animation */
.mobile-nav-close {
    transition: transform 0.3s ease;
}

.mobile-nav-close:hover {
    transform: rotate(90deg);
}

--- File: assets\js\auth.js ---
/**
 * Combined Login and Registration Script
*/

// Helper function to show alerts
function showAlert(message, type = 'error') {
    // Remove existing dynamic alerts
    const existingAlerts = document.querySelectorAll('.dynamic-alert');
    existingAlerts.forEach(alert => alert.remove());
    
    // Create new alert
    const alert = document.createElement('div');
    alert.className = `alert alert-${type} dynamic-alert`;
    alert.textContent = message;
    
    // Insert after the role hint or appropriate element
    const roleHint = document.getElementById('roleHint');
    if (roleHint) {
        roleHint.after(alert);
    } else {
        // Fallback: insert at the beginning of the form
        const form = document.querySelector('form');
        if (form) {
            form.insertBefore(alert, form.firstChild);
        }
    }
    
    // Auto-remove after 5 seconds
    setTimeout(() => {
        alert.remove();
    }, 5000);
}

function showError(inputElement, errorElementId, message) {
    inputElement.classList.add('error');
    const errorElement = document.getElementById(errorElementId);
    if (errorElement) {
        errorElement.textContent = message;
        errorElement.style.display = 'block';
    }
}

// Toggle password visibility
function togglePassword(fieldId) {
    const passwordInput = document.getElementById(fieldId);
    if (!passwordInput) return;
    
    const toggleBtn = passwordInput.parentNode.querySelector('.toggle-btn i');
    if (!toggleBtn) return;
    
    if (passwordInput.type === 'password') {
        passwordInput.type = 'text';
        toggleBtn.className = 'fas fa-eye-slash';
    } else {
        passwordInput.type = 'password';
        toggleBtn.className = 'fas fa-eye';
    }
}

/*
* LOGIN SPECIFIC FUNCTIONS
*/

// Login type selection
function selectLoginType(type) {
    document.getElementById('loginType').value = type;
    
    // Update active button
    document.querySelectorAll('.login-type-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    document.querySelector(`.login-type-btn.${type}`).classList.add('active');
    
    // Update button text and hint
    const btnText = document.getElementById('btnText');
    const roleHint = document.getElementById('roleHint');
    
    if (type === 'customer') {
        btnText.textContent = 'Sign In as Customer';
        roleHint.textContent = 'Sign in to shop and manage your orders';
    } else {
        btnText.textContent = 'Sign In as Admin';
        roleHint.textContent = 'Access the admin dashboard to manage products and orders';
    }
}

function validateLoginForm() {
    let isValid = true;

    // Reset errors
    document.querySelectorAll('.error-message').forEach(el => el.style.display = 'none');
    document.querySelectorAll('.form-input').forEach(el => el.classList.remove('error'));

    // Username validation
    const username = document.getElementById('username');
    if (!username.value.trim()) {
        showError(username, 'username_error', 'Please enter your username or email');
        isValid = false;
    }

    // Password validation
    const password = document.getElementById('password');
    if (!password.value) {
        showError(password, 'password_error', 'Please enter your password');
        isValid = false;
    }

    return isValid;
}

// Login form submission with loading state
async function submitLoginForm() {
    const submitBtn = document.getElementById('submitBtn');
    const btnText = document.getElementById('btnText');
    const btnSpinner = document.getElementById('btnSpinner');
    
    // Show loading state
    submitBtn.disabled = true;
    btnText.textContent = 'Signing In...';
    btnSpinner.style.display = 'inline-block';

    try {
        const formData = new FormData(document.getElementById('loginForm'));
        
        console.log('Form data being sent:');
        for (let [key, value] of formData.entries()) {
            console.log(key + ': ' + value);
        }
        
        const response = await fetch('api/auth/login-api.php', {
            method: 'POST',
            body: formData,
            credentials: 'include'
        });

        console.log('Response status:', response.status);

        const responseText = await response.text();
        console.log('Raw response:', responseText);

        let result;
        try {
            result = JSON.parse(responseText);
            console.log('Parsed JSON:', result);

            if (result.success) {
                // Redirect on success
                console.log('Login successful, redirecting to:', result.redirect);
                window.location.href = result.redirect || 'dashboard.php';
            } else {
                // Show server-side validation errors
                if (result.errors) {
                    Object.keys(result.errors).forEach(field => {
                        const input = document.getElementById(field);
                        const errorElement = document.getElementById(field + '_error');
                        if (input && errorElement) {
                            showError(input, field + '_error', result.errors[field]);
                        }
                    });
                }
                
                // Show error message
                showAlert(result.message || 'Login failed. Please try again.', 'error');
            }
        } catch (e) {
            console.log('❌ Response is not JSON:', responseText);
            showAlert('Server error: The response was not valid JSON. Check the console for details.', 'error');
        }
    } catch (error) {
        console.error('Login error:', error);
        showAlert('Network error: ' + error.message, 'error');
    } finally {
        // Reset loading state
        submitBtn.disabled = false;
        const loginType = document.getElementById('loginType').value;
        btnText.textContent = loginType === 'customer' ? 'Sign In as Customer' : 'Sign In as Admin';
        btnSpinner.style.display = 'none';
    }
}

/*
*REGISTER SPECIFIC FUNCTIONS
*/

// Role selection for registration
function selectRole(role) {
    document.getElementById('roleInput').value = role;
    
    // Update active button
    document.querySelectorAll('.login-type-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    document.querySelector(`.login-type-btn.${role}`).classList.add('active');
    
    // Update hint text and button text
    const roleHint = document.getElementById('roleHint');
    const btnText = document.getElementById('btnText');
    
    const roleHints = {
        'customer': 'Create a customer account to shop and manage orders',
        'staff': 'Create a staff account to manage store operations', 
        'admin': 'Create an admin account for full system access'
    };
    
    const buttonTexts = {
        'customer': 'Create Customer Account',
        'staff': 'Create Staff Account',
        'admin': 'Create Admin Account'
    };
    
    roleHint.textContent = roleHints[role];
    btnText.textContent = buttonTexts[role];
}

// Validate registration form inputs
function validateRegisterForm() {
    let isValid = true;

    // Reset errors
    document.querySelectorAll('.error-message').forEach(el => el.style.display = 'none');
    document.querySelectorAll('.form-input').forEach(el => el.classList.remove('error'));

    // Role validation
    const roleSelected = document.getElementById('roleInput').value;
    if (!roleSelected) {
        document.getElementById('roleHint').style.color = '#ef4444';
        document.getElementById('roleHint').textContent = 'Please select an account type';
        isValid = false;
    } else {
        document.getElementById('roleHint').style.color = '#6b7280';
    }

    // Full Name validation
    const fullName = document.getElementById('full_name');
    if (fullName && !fullName.value.trim()) {
        showError(fullName, 'full_name_error', 'Please enter your full name');
        isValid = false;
    }

    // Email validation
    const email = document.getElementById('email');
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (email && !emailRegex.test(email.value)) {
        showError(email, 'email_error', 'Please enter a valid email address');
        isValid = false;
    }

    // Username validation
    const username = document.getElementById('username');
    const usernameRegex = /^[a-zA-Z0-9_]{3,50}$/;
    if (username && !usernameRegex.test(username.value)) {
        showError(username, 'username_error', 'Username must be 3-50 characters and contain only letters, numbers, and underscores');
        isValid = false;
    }

    // Password validation
    const password = document.getElementById('password');
    if (password && password.value.length < 8) {
        showError(password, 'password_error', 'Password must be at least 8 characters long');
        isValid = false;
    } else if (password && !/(?=.*[A-Za-z])(?=.*\d)/.test(password.value)) {
        showError(password, 'password_error', 'Password must contain at least one letter and one number');
        isValid = false;
    }

    // Confirm password validation
    const confirmPassword = document.getElementById('confirm_password');
    if (confirmPassword && password && confirmPassword.value !== password.value) {
        showError(confirmPassword, 'confirm_password_error', 'Passwords do not match');
        isValid = false;
    }

    return isValid;
}

// Register form submission with loading state
async function submitRegisterForm() {
    const submitBtn = document.getElementById('submitBtn');
    const btnText = document.getElementById('btnText');
    const btnSpinner = document.getElementById('btnSpinner');
    
    // Show loading state
    submitBtn.disabled = true;
    btnText.textContent = 'Creating Account...';
    btnSpinner.style.display = 'inline-block';

    try {
        // Get form values
        const formData = new URLSearchParams();
        formData.append('csrf_token', document.querySelector('input[name="csrf_token"]').value);
        formData.append('role', document.getElementById('roleInput').value);
        formData.append('full_name', document.getElementById('full_name').value);
        formData.append('email', document.getElementById('email').value);
        formData.append('username', document.getElementById('username').value);
        formData.append('password', document.getElementById('password').value);
        formData.append('confirm_password', document.getElementById('confirm_password').value);
        
        console.log('Sending registration data:', Object.fromEntries(formData.entries()));
        
        const response = await fetch('api/auth/register-api.php', {
            method: 'POST',
            body: formData,
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            }
        });

        console.log('Response status:', response.status);
        
        const responseText = await response.text();
        console.log('Raw response:', responseText);
        
        let result;
        try {
            result = JSON.parse(responseText);
        } catch (e) {
            console.error('JSON parse error:', e);
            throw new Error('Server returned invalid JSON. Check the console for details.');
        }
        
        console.log('Parsed response:', result);

        if (result.success) {
            showAlert('✅ ' + result.message, 'success');
            setTimeout(() => {
                window.location.href = result.redirect || 'dashboard.php';
            }, 2000);
        } else {
            // Show validation errors
            if (result.errors) {
                Object.keys(result.errors).forEach(field => {
                    const input = document.getElementById(field);
                    const errorElement = document.getElementById(field + '_error');
                    if (input && errorElement) {
                        showError(input, field + '_error', result.errors[field]);
                    }
                });
            }
            showAlert('❌ ' + (result.message || 'Registration failed'), 'error');
        }
    } catch (error) {
        console.error('Registration error:', error);
        showAlert('❌ ' + error.message, 'error');
    } finally {
        // Reset loading state
        submitBtn.disabled = false;
        const role = document.getElementById('roleInput').value;
        const buttonTexts = {
            'customer': 'Create Customer Account',
            'staff': 'Create Staff Account',
            'admin': 'Create Admin Account'
        };
        btnText.textContent = buttonTexts[role] || 'Create Account';
        btnSpinner.style.display = 'none';
    }
}

// ===== VALIDATION FUNCTIONS =====
function validateField(field) {
    const value = field.value.trim();
    
    switch(field.id) {
        case 'username':
            if (!value) {
                showError(field, 'username_error', 'Please enter your username or email');
            } else {
                const usernameRegex = /^[a-zA-Z0-9_]{3,50}$/;
                if (!usernameRegex.test(value)) {
                    showError(field, 'username_error', 'Username must be 3-50 characters and contain only letters, numbers, and underscores');
                }
            }
            break;
        case 'password':
            if (!value) {
                showError(field, 'password_error', 'Please enter your password');
            } else {
                if (value.length < 8) {
                    showError(field, 'password_error', 'Password must be at least 8 characters long');
                } else if (!/(?=.*[A-Za-z])(?=.*\d)/.test(value)) {
                    showError(field, 'password_error', 'Password must contain at least one letter and one number');
                }
            }
            break;
        case 'full_name':
            if (!value) showError(field, 'full_name_error', 'Please enter your full name');
            break;
        case 'email':
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(value)) showError(field, 'email_error', 'Please enter a valid email address');
            break;
        case 'confirm_password':
            const password = document.getElementById('password');
            if (password && value !== password.value) showError(field, 'confirm_password_error', 'Passwords do not match');
            break;
    }
}

// Initialize real-time validation
function initializeFormValidation() {
    document.querySelectorAll('.form-input').forEach(input => {
        input.addEventListener('blur', function() {
            validateField(this);
        });
        
        input.addEventListener('input', function() {
            // Clear error when user starts typing
            this.classList.remove('error');
            const errorId = this.id + '_error';
            const errorElement = document.getElementById(errorId);
            if (errorElement) {
                errorElement.style.display = 'none';
            }
            
            // Hide alert messages when user starts typing
            const alert = document.querySelector('.alert');
            if (alert) {
                alert.style.display = 'none';
            }
        });
    });
}

// ===== PAGE INITIALIZATION =====

// Initialize login page
function initializeLoginPage() {
    // Auto-focus on username field
    const usernameField = document.getElementById('username');
    if (usernameField) {
        usernameField.focus();
    }
    
    // Initialize form validation
    initializeFormValidation();
    
    // Initialize form submission
    const loginForm = document.getElementById('loginForm');
    if (loginForm) {
        loginForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            if (validateLoginForm()) {
                await submitLoginForm();
            }
        });
    }
    
    // Set default login type if not already set
    const loginTypeInput = document.getElementById('loginType');
    if (loginTypeInput && !loginTypeInput.value) {
        selectLoginType('customer');
    }
}

// Initialize register page
function initializeRegisterPage() {
    // Auto-focus on first field
    const fullNameField = document.getElementById('full_name');
    if (fullNameField) {
        fullNameField.focus();
    }
    
    // Initialize form validation
    initializeFormValidation();
    
    // Initialize form submission
    const registerForm = document.getElementById('registrationForm');
    if (registerForm) {
        registerForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            if (validateRegisterForm()) {
                await submitRegisterForm();
            }
        });
    }
    
    // Set default role if not already set
    const roleInput = document.getElementById('roleInput');
    if (roleInput && !roleInput.value) {
        selectRole('customer');
    }
}

// Auto-detect page type and initialize
function initializeAuthPage() {
    const loginForm = document.getElementById('loginForm');
    const registerForm = document.getElementById('registrationForm');
    
    if (loginForm) {
        initializeLoginPage();
    } else if (registerForm) {
        initializeRegisterPage();
    }
}

// Initialize when DOM is loaded
document.addEventListener('DOMContentLoaded', function() {
    initializeAuthPage();
});

// Export functions for potential module usage
if (typeof module !== 'undefined' && module.exports) {
    module.exports = {
        // Common functions
        showAlert,
        showError,
        togglePassword,
        
        // Login functions
        selectLoginType,
        validateLoginForm,
        submitLoginForm,
        initializeLoginPage,
        
        // Register functions
        selectRole,
        validateRegisterForm,
        submitRegisterForm,
        initializeRegisterPage,
        
        // Main initialization
        initializeAuthPage
    };
}

--- File: assets\js\cart.js ---
// Global flag to prevent double initialization
let cartInitialized = false;

document.addEventListener('DOMContentLoaded', function() {
    if (cartInitialized) return;
    cartInitialized = true;
    
    console.log('=== CART INITIALIZATION START ===');
    initCart();
    console.log('=== CART INITIALIZATION COMPLETE ===');
});

// Show notification
function showNotification(message, type = 'info') {
    // Remove existing notifications
    document.querySelectorAll('.notification').forEach(n => n.remove());
    
    const notification = document.createElement('div');
    notification.className = 'notification';
    notification.innerHTML = `
        <div class="notification-content notification-${type}">
            <span class="notification-message">${message}</span>
            <button class="btn-icon" onclick="this.parentElement.parentElement.remove()">
                <i class="fas fa-times"></i>
            </button>
        </div>
    `;
    
    document.body.appendChild(notification);
    
    // Auto remove after 5 seconds
    setTimeout(() => {
        if (notification.parentElement) {
            notification.remove();
        }
    }, 5000);
}

// Remove function
async function removeFromCart(event, itemId) {
    event.preventDefault();

    if (!confirm('Remove this item from your cart?')) return;

    const form = event.target;
    const button = form.querySelector('.remove-btn');
    const originalHTML = button ? button.innerHTML : '';

    try {
        // Show loading state
        if (button) {
            button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Removing...';
            button.disabled = true;
        }

        console.log('Sending remove request for item:', itemId);
        
        const response = await fetch('cart-remove.php', {
            method: 'POST',
            headers: { 
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: new URLSearchParams({ 
                item_id: itemId 
            })
        });

        console.log('Response status:', response.status);
        
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }

        const data = await response.json();
        console.log('Response data:', data);

        if (data.success) {
            // Fade out and remove the item
            const itemElement = form.closest('.cart-item');
            if (itemElement) {
                itemElement.style.transition = 'all 0.3s ease';
                itemElement.style.opacity = '0';
                itemElement.style.transform = 'translateX(-100px)';
                
                setTimeout(() => {
                    itemElement.remove();
                    console.log('Item element removed from DOM');
                    
                    // Update UI with the data from server
                    updateCartCount(data.cart_count);
                    updateOrderSummary(data.cart_total);
                    
                    showNotification('Item removed from cart', 'success');
                    
                    // Show empty cart if needed
                    if (data.cart_count === 0) {
                        console.log('Cart is empty, showing empty state');
                        setTimeout(() => {
                            showEmptyCart();
                        }, 500);
                    }
                }, 300);
            } else {
                console.warn('Item element not found, forcing UI update');
                // If we can't find the element, still update the UI
                updateCartCount(data.cart_count);
                updateOrderSummary(data.cart_total);
                
                if (data.cart_count === 0) {
                    showEmptyCart();
                }
            }
        } else {
            throw new Error(data.error || 'Failed to remove item');
        }

    } catch (error) {
        console.error('Remove error:', error);
        
        // Reset button
        if (button) {
            button.innerHTML = originalHTML;
            button.disabled = false;
        }
        
        showNotification('Failed to remove item: ' + error.message, 'error');
    }
}

// Update cart count in header
function updateCartCount(count) {
    console.log('Updating cart count to:', count);
    
    // Force create badges if they don't exist
    const desktopCartIcon = document.querySelector('.cart-icon');
    if (desktopCartIcon) {
        let countBadge = desktopCartIcon.querySelector('.cart-count');
        
        if (count > 0) {
            if (!countBadge) {
                console.log('Creating new desktop cart badge');
                countBadge = document.createElement('span');
                countBadge.className = 'cart-count';
                countBadge.style.cssText = 'position: absolute; top: -2px; right: -2px; background: #ef4444; color: white; border-radius: 50%; width: 18px; height: 18px; font-size: 0.75rem; display: flex; align-items: center; justify-content: center; font-weight: 600;';
                desktopCartIcon.style.position = 'relative';
                desktopCartIcon.appendChild(countBadge);
            }
            countBadge.textContent = count;
            countBadge.style.display = 'flex';
        } else if (countBadge) {
            countBadge.style.display = 'none';
        }
    }

    // Update mobile cart
    const mobileCart = document.querySelector('.mobile-nav-cart');
    if (mobileCart) {
        const mobileCountText = mobileCart.querySelector('.mobile-nav-cart-count');
        let mobileBadge = mobileCart.querySelector('.mobile-nav-cart-badge');
        
        if (mobileCountText) {
            mobileCountText.textContent = `${count} item${count !== 1 ? 's' : ''}`;
        }
        
        if (count > 0) {
            if (!mobileBadge) {
                console.log('Creating new mobile cart badge');
                const mobileCartIcon = mobileCart.querySelector('.mobile-nav-cart-icon');
                mobileBadge = document.createElement('span');
                mobileBadge.className = 'mobile-nav-cart-badge';
                mobileBadge.style.cssText = 'position: absolute; top: -5px; right: -5px; background: #ef4444; color: white; border-radius: 50%; width: 18px; height: 18px; font-size: 0.75rem; display: flex; align-items: center; justify-content: center; font-weight: 600;';
                mobileCartIcon.style.position = 'relative';
                mobileCartIcon.appendChild(mobileBadge);
            }
            mobileBadge.textContent = count;
            mobileBadge.style.display = 'flex';
        } else if (mobileBadge) {
            mobileBadge.style.display = 'none';
        }
    }
    
    console.log('Cart count update completed');
}

// Update order summary
function updateOrderSummary(total) {
    console.log('Updating order summary to: R' + total);
    
    // Add visual feedback
    const summarySection = document.querySelector('.order-summary');
    if (summarySection) {
        summarySection.style.transition = 'all 0.3s ease';
        summarySection.style.boxShadow = '0 0 0 2px #10b981';
        
        setTimeout(() => {
            summarySection.style.boxShadow = '';
        }, 1000);
    }
    
    // Update all summary values
    const summaryValues = document.querySelectorAll('.summary-value');
    summaryValues.forEach(el => {
        const originalText = el.textContent;
        if (originalText.includes('R')) {
            el.textContent = `R${total}`;
            // Add visual feedback
            el.style.transition = 'all 0.3s ease';
            el.style.color = '#ef4444';
            el.style.fontWeight = 'bold';
            
            setTimeout(() => {
                el.style.color = '';
                el.style.fontWeight = '';
            }, 1000);
        }
    });
    
    console.log('Order summary update completed');
}

// Show empty cart state
function showEmptyCart() {
    console.log('Showing empty cart state');
    
    const cartContent = document.querySelector('.cart-content');
    if (cartContent) {
        cartContent.innerHTML = `
            <div class="empty-cart">
                <div class="empty-cart-icon">
                    <i class="fas fa-shopping-cart"></i>
                </div>
                <h2>Your cart is empty</h2>
                <p>Looks like you haven't added any items to your cart yet.</p>
                <a href="../products/products.php" class="btn btn-primary">
                    <i class="fas fa-shopping-bag"></i>
                    Start Shopping
                </a>
            </div>`;
    }
}

// User dropdown functionality
function initUserDropdown() {
    const userMenuButton = document.getElementById('userMenuButton');
    const userDropdown = document.getElementById('userDropdown');
    
    if (userMenuButton && userDropdown) {
        userMenuButton.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            userDropdown.classList.toggle('show');
        });
        
        document.addEventListener('click', function(e) {
            if (userDropdown.classList.contains('show') && 
                !userMenuButton.contains(e.target) && 
                !userDropdown.contains(e.target)) {
                userDropdown.classList.remove('show');
            }
        });
    }
}

// Initialize all cart functionality
function initCart() {
    console.log('Initializing cart components...');
    initUserDropdown();
    console.log('All cart components initialized');
}

// Export functions
window.removeFromCart = removeFromCart;
window.showNotification = showNotification;
window.initCart = initCart;



--- File: assets\js\dashboard.js ---
// Global flag to prevent double initialization
let dashboardInitialized = false;

document.addEventListener('DOMContentLoaded', function() {
    // Prevent double initialization
    if (dashboardInitialized) return;
    dashboardInitialized = true;
    
    console.log('=== DASHBOARD INITIALIZATION START ===');
    
    // Initialize all functionality
    initDashboard();
    
    // Show success message if item was added
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.get('added') === '1') {
        showNotification('Item added to cart!', 'success');
        
        // Remove the parameter from URL without reloading
        const newUrl = window.location.pathname;
        window.history.replaceState({}, document.title, newUrl);
    }
    
    console.log('=== DASHBOARD INITIALIZATION COMPLETE ===');
});

// Show notification
function showNotification(message, type = 'info') {
    const notification = document.createElement('div');
    notification.className = 'notification';
    notification.innerHTML = `
        <div class="notification-content notification-${type}">
            <span class="notification-message">${message}</span>
            <button class="btn-icon" onclick="this.parentElement.parentElement.remove()">
                <i class="fas fa-times"></i>
            </button>
        </div>
    `;
    
    document.body.appendChild(notification);
    
    // Auto remove after 5 seconds
    setTimeout(() => {
        if (notification.parentElement) {
            notification.remove();
        }
    }, 5000);
}

// Newsletter subscription
async function subscribeNewsletter(event) {
    event.preventDefault();
    const form = event.target;
    const email = form.querySelector('.newsletter-input').value;
    const button = form.querySelector('button');
    
    const originalText = button.innerHTML;
    button.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
    button.disabled = true;
    
    try {
        // Simulate API call
        await new Promise(resolve => setTimeout(resolve, 1000));
        showNotification('Thank you for subscribing!', 'success');
        form.reset();
    } catch (error) {
        showNotification('Failed to subscribe. Please try again.', 'error');
    } finally {
        button.innerHTML = originalText;
        button.disabled = false;
    }
}

// User dropdown functionality - FIXED VERSION
function initUserDropdown() {
    const userMenuButton = document.getElementById('userMenuButton');
    const userDropdown = document.getElementById('userDropdown');
    
    console.log('Initializing user dropdown...', {
        button: userMenuButton,
        dropdown: userDropdown
    });
    
    if (userMenuButton && userDropdown) {
        // Remove any existing event listeners first
        const newButton = userMenuButton.cloneNode(true);
        userMenuButton.parentNode.replaceChild(newButton, userMenuButton);
        
        const newDropdown = userDropdown.cloneNode(true);
        userDropdown.parentNode.replaceChild(newDropdown, userDropdown);
        
        // Get fresh references
        const freshButton = document.getElementById('userMenuButton');
        const freshDropdown = document.getElementById('userDropdown');
        
        // Toggle dropdown
        freshButton.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            console.log('User dropdown clicked - toggling');
            freshDropdown.classList.toggle('show');
        });
        
        // Close dropdown when clicking outside
        document.addEventListener('click', function(e) {
            if (freshDropdown.classList.contains('show') && 
                !freshButton.contains(e.target) && 
                !freshDropdown.contains(e.target)) {
                console.log('Closing dropdown - clicked outside');
                freshDropdown.classList.remove('show');
            }
        });
        
        // Close dropdown when clicking on a link
        freshDropdown.addEventListener('click', function(e) {
            if (e.target.tagName === 'A' || e.target.closest('a')) {
                console.log('Closing dropdown - link clicked');
                freshDropdown.classList.remove('show');
            }
        });
        
        // Close on escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && freshDropdown.classList.contains('show')) {
                freshDropdown.classList.remove('show');
            }
        });
        
        console.log('User dropdown initialized successfully');
    } else {
        console.error('User dropdown elements not found');
    }
}

// Mobile Navigation Functionality
function initMobileNavigation() {
    const mobileNavToggle = document.getElementById('mobileNavToggle');
    const mobileNavClose = document.getElementById('mobileNavClose');
    const mobileNav = document.getElementById('mobileNav');
    
    if (!mobileNavToggle || !mobileNav) return;
    
    // Toggle mobile navigation
    mobileNavToggle.addEventListener('click', function() {
        mobileNav.classList.add('active');
        document.body.style.overflow = 'hidden';
    });
    
    // Close mobile navigation
    if (mobileNavClose) {
        mobileNavClose.addEventListener('click', function() {
            mobileNav.classList.remove('active');
            document.body.style.overflow = '';
        });
    }
    
    // Close mobile nav when clicking on overlay (outside sidebar)
    mobileNav.addEventListener('click', function(e) {
        if (e.target === mobileNav) {
            mobileNav.classList.remove('active');
            document.body.style.overflow = '';
        }
    });
    
    // Close mobile nav when clicking on a link
    const mobileNavLinks = mobileNav.querySelectorAll('a');
    mobileNavLinks.forEach(link => {
        link.addEventListener('click', function() {
            mobileNav.classList.remove('active');
            document.body.style.overflow = '';
        });
    });
    
    // Handle escape key
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && mobileNav.classList.contains('active')) {
            mobileNav.classList.remove('active');
            document.body.style.overflow = '';
        }
    });
}

// Product card interactions
function initProductInteractions() {
    const productCards = document.querySelectorAll('.product-card');
    
    productCards.forEach(card => {
        // Add hover effects
        card.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-5px)';
            this.style.boxShadow = '0 10px 25px rgba(0,0,0,0.1)';
        });
        
        card.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0)';
            this.style.boxShadow = '0 2px 10px rgba(0,0,0,0.1)';
        });
        
        // Add to cart animation
        const addToCartBtn = card.querySelector('button[type="submit"]');
        if (addToCartBtn) {
            addToCartBtn.addEventListener('click', function(e) {
                // Add temporary animation class
                this.classList.add('adding-to-cart');
                
                // Remove animation class after animation completes
                setTimeout(() => {
                    this.classList.remove('adding-to-cart');
                }, 600);
            });
        }
    });
}

// Search functionality
function initSearch() {
    const searchForms = document.querySelectorAll('.search-form, .search-box');
    
    searchForms.forEach(form => {
        form.addEventListener('submit', function(e) {
            const searchInput = this.querySelector('input[type="text"]');
            if (!searchInput.value.trim()) {
                e.preventDefault();
                showNotification('Please enter a search term', 'error');
            }
        });
    });
}

// Products page search functionality
function initProductsSearch() {
    const searchInput = document.querySelector('input[name="search"]');
    const categorySelect = document.querySelector('select[name="category"]');
    const sortSelect = document.querySelector('select[name="sort"]');
    const applyFiltersBtn = document.querySelector('button[type="submit"]');
    const filtersForm = document.querySelector('.filters-grid');
    
    if (!filtersForm) return; // Only run on products page
    
    console.log('Initializing products search...');
    
    // Show loading state when searching
    if (applyFiltersBtn) {
        const originalText = applyFiltersBtn.innerHTML;
        
        // Listen to form submission
        filtersForm.addEventListener('submit', function(e) {
            // Don't prevent default - let form submit normally
            applyFiltersBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Searching...';
            applyFiltersBtn.disabled = true;
            
            // Re-enable button after a timeout (in case submission fails)
            setTimeout(() => {
                applyFiltersBtn.innerHTML = originalText;
                applyFiltersBtn.disabled = false;
            }, 3000);
        });
    }
    
    // Real-time search with auto-submit
    if (searchInput) {
        let searchTimeout;
        searchInput.addEventListener('input', function(e) {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                // Only auto-submit if there are 3+ characters or empty
                if (e.target.value.length >= 3 || e.target.value.length === 0) {
                    console.log('Auto-submitting search:', e.target.value);
                    filtersForm.submit();
                }
            }, 800);
        });
    }
    
    // Auto-submit when category or sort changes
    if (categorySelect) {
        categorySelect.addEventListener('change', function() {
            console.log('Category changed, submitting form');
            filtersForm.submit();
        });
    }
    
    if (sortSelect) {
        sortSelect.addEventListener('change', function() {
            console.log('Sort changed, submitting form');
            filtersForm.submit();
        });
    }
    
    // Update page header with search results info
    updateSearchResultsInfo();
}

// Update search results information
function updateSearchResultsInfo() {
    const searchKeywords = document.querySelector('input[name="search"]')?.value || '';
    const categoryFilter = document.querySelector('select[name="category"]')?.value || '';
    const resultsCount = document.querySelectorAll('.product-card').length;
    const pageHeader = document.querySelector('.page-header p');
    
    if ((searchKeywords || categoryFilter) && pageHeader) {
        let message = '';
        
        if (resultsCount > 0) {
            message = `Found ${resultsCount} product${resultsCount !== 1 ? 's' : ''}`;
            
            if (searchKeywords) {
                message += ` for "${searchKeywords}"`;
            }
            
            if (categoryFilter) {
                const categoryName = document.querySelector(`select[name="category"] option[value="${categoryFilter}"]`)?.textContent || '';
                if (searchKeywords) {
                    message += ` in ${categoryName}`;
                } else {
                    message += ` in ${categoryName} category`;
                }
            }
        } else {
            message = 'No products found';
            if (searchKeywords) {
                message += ` for "${searchKeywords}"`;
            }
            if (categoryFilter) {
                const categoryName = document.querySelector(`select[name="category"] option[value="${categoryFilter}"]`)?.textContent || '';
                message += searchKeywords ? ` in ${categoryName}` : ` in ${categoryName} category`;
            }
            message += '. Try different keywords or categories.';
        }
        
        pageHeader.textContent = message;
    }
}

// ============================================================================
// ADMIN DASHBOARD SPECIFIC FUNCTIONS
// ============================================================================

// Admin dashboard specific initialization
function initAdminDashboard() {
    console.log('Initializing admin dashboard components...');
    
    // Tab functionality
    const tabHeaders = document.querySelectorAll('.tab-header');
    const tabPanes = document.querySelectorAll('.tab-pane');
    
    tabHeaders.forEach(header => {
        header.addEventListener('click', function() {
            const tabName = this.getAttribute('onclick')?.match(/showTab\('([^']+)'\)/)?.[1];
            if (tabName) {
                showTab(tabName);
            }
        });
    });
    
    // Initialize URL tab parameter
    const urlParams = new URLSearchParams(window.location.search);
    const tab = urlParams.get('tab');
    if (tab && ['dashboard', 'products', 'orders'].includes(tab)) {
        showTab(tab);
    }
    
    console.log('Admin dashboard components initialized');
}

// Tab functionality for admin dashboard
function showTab(tabName) {
    // Hide all tab panes
    document.querySelectorAll('.tab-pane').forEach(pane => {
        pane.classList.remove('active');
    });
    
    // Show selected tab pane
    const targetTab = document.getElementById(tabName + '-tab');
    if (targetTab) {
        targetTab.classList.add('active');
    }
    
    // Update tab header states
    document.querySelectorAll('.tab-header').forEach(header => {
        header.classList.remove('active');
    });
    
    // Set current tab header as active
    event.target.classList.add('active');
}

// Update stock modal
function updateStock(productId, productName, currentStock) {
    const newStock = prompt(`Update stock for "${productName}"\nCurrent stock: ${currentStock}\n\nEnter new stock quantity:`, currentStock);
    
    if (newStock !== null && newStock !== '' && !isNaN(newStock)) {
        // Create form and submit
        const form = document.createElement('form');
        form.method = 'POST';
        form.style.display = 'none';
        
        const productIdInput = document.createElement('input');
        productIdInput.name = 'product_id';
        productIdInput.value = productId;
        form.appendChild(productIdInput);
        
        const stockInput = document.createElement('input');
        stockInput.name = 'stock_quantity';
        stockInput.value = newStock;
        form.appendChild(stockInput);
        
        const submitInput = document.createElement('input');
        submitInput.name = 'update_stock';
        submitInput.value = '1';
        form.appendChild(submitInput);
        
        document.body.appendChild(form);
        form.submit();
    }
}

// Update order status modal
function updateOrderStatus(orderId, currentStatus) {
    const newStatus = prompt(`Update order #${orderId.toString().padStart(6, '0')}\nCurrent status: ${currentStatus}\n\nEnter new status (pending/completed/cancelled):`, currentStatus);
    
    if (newStatus && ['pending', 'completed', 'cancelled'].includes(newStatus.toLowerCase())) {
        // Create form and submit
        const form = document.createElement('form');
        form.method = 'POST';
        form.style.display = 'none';
        
        const orderIdInput = document.createElement('input');
        orderIdInput.name = 'order_id';
        orderIdInput.value = orderId;
        form.appendChild(orderIdInput);
        
        const statusInput = document.createElement('input');
        statusInput.name = 'status';
        statusInput.value = newStatus.toLowerCase();
        form.appendChild(statusInput);
        
        const submitInput = document.createElement('input');
        submitInput.name = 'update_order_status';
        submitInput.value = '1';
        form.appendChild(submitInput);
        
        document.body.appendChild(form);
        form.submit();
    }
}

// View order details
function viewOrder(orderId) {
    alert(`Viewing order #${orderId.toString().padStart(6, '0')}\n\nIn a real application, this would show detailed order information including:\n- Customer details\n- Shipping address\n- Order items\n- Payment information\n- Order history`);
}

// Edit product
function editProduct(productId) {
    alert(`Editing product #${productId}\n\nIn a real application, this would open a product edit form with pre-filled data.`);
}

// ============================================================================
// MAIN INITIALIZATION FUNCTION
// ============================================================================

// Initialize all functionality
function initDashboard() {
    console.log('Initializing dashboard components...');
    initUserDropdown();
    initMobileNavigation();
    initProductInteractions();
    initSearch();
    initProductsSearch();
    
    // Check if we're on admin dashboard
    const isAdminDashboard = document.querySelector('.admin-page') !== null || 
                            document.querySelector('.admin-welcome') !== null ||
                            document.querySelector('.admin-subtitle') !== null;
    
    if (isAdminDashboard) {
        console.log('Admin dashboard detected - initializing admin components');
        initAdminDashboard();
    }
    
    console.log('All dashboard components initialized');
}

// Export functions for global access
window.showNotification = showNotification;
window.subscribeNewsletter = subscribeNewsletter;
window.initDashboard = initDashboard;
window.initProductsSearch = initProductsSearch;
window.updateSearchResultsInfo = updateSearchResultsInfo;

// Export admin dashboard functions for global access
window.showTab = showTab;
window.updateStock = updateStock;
window.updateOrderStatus = updateOrderStatus;
window.viewOrder = viewOrder;
window.editProduct = editProduct;
window.initAdminDashboard = initAdminDashboard;

--- File: assets\js\dynamic-cart.js ---
class DynamicCartTotals {
    constructor() {
        this.initCartUpdates();
    }
    
    initCartUpdates() {
        // Update totals when quantity changes
        document.querySelectorAll('.quantity-input, .quantity-btn').forEach(element => {
            element.addEventListener('change', this.updateTotals.bind(this));
            element.addEventListener('click', this.updateTotals.bind(this));
        });
    }
    
    updateTotals() {
        let subtotal = 0;
        
        // Calculate new subtotal
        document.querySelectorAll('.cart-item').forEach(item => {
            const price = parseFloat(item.dataset.price);
            const quantity = parseInt(item.querySelector('.quantity-input').value) || 1;
            subtotal += price * quantity;
            
            // Update item subtotal
            const itemSubtotal = item.querySelector('.item-subtotal');
            if (itemSubtotal) {
                itemSubtotal.textContent = `R${(price * quantity).toFixed(2)}`;
            }
        });
        
        // Update display
        document.querySelectorAll('.summary-value:not(.summary-total)').forEach(element => {
            element.textContent = `R${subtotal.toFixed(2)}`;
        });
        
        document.querySelectorAll('.summary-total').forEach(element => {
            element.textContent = `R${subtotal.toFixed(2)}`;
        });
        
        // Update checkout button
        const checkoutBtn = document.querySelector('.checkout-btn');
        if (checkoutBtn) {
            checkoutBtn.innerHTML = `<i class="fas fa-lock"></i> Proceed to Checkout - R${subtotal.toFixed(2)}`;
        }
    }
}

// Initialize
document.addEventListener('DOMContentLoaded', function() {
    new DynamicCartTotals();
});

--- File: assets\js\enhanced-features.js ---
// Main initialization
document.addEventListener('DOMContentLoaded', function() {
    // Initialize based on current page
    const currentPage = window.location.pathname;
    
    if (currentPage.includes('products.php')) {
        // Product page features
        new StockValidator();
        new SearchAutocomplete();
    }
    
    if (currentPage.includes('cart.php')) {
        // Cart page features
        new DynamicCartManager();
    }
    
    // Global cart count updates
    if (typeof CartManager !== 'undefined') {
        new CartManager();
    }
});

// Global utility functions
class UtilityHelpers {
    static debounce(func, wait) {
        let timeout;
        return function executedFunction(...args) {
            const later = () => {
                clearTimeout(timeout);
                func(...args);
            };
            clearTimeout(timeout);
            timeout = setTimeout(later, wait);
        };
    }
    
    static formatCurrency(amount) {
        return 'R' + parseFloat(amount).toFixed(2);
    }
    
    static showLoading(element) {
        element.disabled = true;
        const originalText = element.innerHTML;
        element.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Loading...';
        return originalText;
    }
    
    static hideLoading(element, originalText) {
        element.disabled = false;
        element.innerHTML = originalText;
    }
}

--- File: assets\js\search-autocomplete.js ---
// Autocomplete search functionality
class SearchAutocomplete {
    constructor() {
        this.searchInput = document.querySelector('input[name="search"]');
        this.autocompleteList = null;
        this.products = [];
        this.isLoading = false;
        
        if (this.searchInput) {
            this.initAutocomplete();
        }
    }
    
    initAutocomplete() {
        // Create autocomplete dropdown
        this.autocompleteList = document.createElement('div');
        this.autocompleteList.className = 'autocomplete-list';
        this.autocompleteList.style.cssText = `
            position: absolute;
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 0.5rem;
            max-height: 300px;
            overflow-y: auto;
            width: 100%;
            z-index: 1000;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            display: none;
            margin-top: 0.25rem;
        `;
        
        this.searchInput.parentNode.style.position = 'relative';
        this.searchInput.parentNode.appendChild(this.autocompleteList);
        
        // Add event listeners
        this.searchInput.addEventListener('input', this.debounce(this.handleInput.bind(this), 300));
        this.searchInput.addEventListener('focus', this.handleFocus.bind(this));
        this.searchInput.addEventListener('keydown', this.handleKeydown.bind(this));
        
        // Close autocomplete when clicking outside
        document.addEventListener('click', (e) => {
            if (!this.searchInput.contains(e.target) && !this.autocompleteList.contains(e.target)) {
                this.hideAutocomplete();
            }
        });
        
        // Load product data
        this.loadProductData();
    }
    
    async loadProductData() {
        if (this.isLoading) return;
        
        this.isLoading = true;
        try {
            const response = await fetch('../../api/products-autocomplete.php');
            if (response.ok) {
                this.products = await response.json();
            }
        } catch (error) {
            console.error('Failed to load product data:', error);
        } finally {
            this.isLoading = false;
        }
    }
    
    handleInput(event) {
        const query = event.target.value.toLowerCase().trim();
        
        if (query.length < 2) {
            this.hideAutocomplete();
            return;
        }
        
        const matches = this.filterProducts(query);
        this.showAutocomplete(matches, query);
    }
    
    handleFocus() {
        const query = this.searchInput.value.toLowerCase().trim();
        if (query.length >= 2) {
            const matches = this.filterProducts(query);
            this.showAutocomplete(matches, query);
        }
    }
    
    handleKeydown(event) {
        const items = this.autocompleteList.querySelectorAll('.autocomplete-item');
        const activeItem = this.autocompleteList.querySelector('.autocomplete-item.active');
        let activeIndex = Array.from(items).indexOf(activeItem);
        
        switch(event.key) {
            case 'ArrowDown':
                event.preventDefault();
                activeIndex = (activeIndex + 1) % items.length;
                this.setActiveItem(items[activeIndex]);
                break;
                
            case 'ArrowUp':
                event.preventDefault();
                activeIndex = (activeIndex - 1 + items.length) % items.length;
                this.setActiveItem(items[activeIndex]);
                break;
                
            case 'Enter':
                if (activeItem) {
                    event.preventDefault();
                    this.selectItem(activeItem);
                }
                break;
                
            case 'Escape':
                this.hideAutocomplete();
                break;
        }
    }
    
    filterProducts(query) {
        return this.products.filter(product => 
            product.name.toLowerCase().includes(query) ||
            (product.category && product.category.toLowerCase().includes(query)) ||
            (product.description && product.description.toLowerCase().includes(query))
        ).slice(0, 8); // Limit to 8 results
    }
    
    showAutocomplete(matches, query) {
        if (matches.length === 0) {
            this.hideAutocomplete();
            return;
        }
        
        this.autocompleteList.innerHTML = '';
        
        matches.forEach((product, index) => {
            const item = this.createAutocompleteItem(product, query, index === 0);
            this.autocompleteList.appendChild(item);
        });
        
        this.autocompleteList.style.display = 'block';
    }
    
    createAutocompleteItem(product, query, isFirst = false) {
        const item = document.createElement('div');
        item.className = `autocomplete-item ${isFirst ? 'active' : ''}`;
        item.style.cssText = `
            padding: 12px 16px;
            cursor: pointer;
            border-bottom: 1px solid #f8fafc;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background-color 0.2s;
        `;
        
        item.innerHTML = `
            <div style="flex: 1;">
                <div style="font-weight: 600; margin-bottom: 4px;">
                    ${this.highlightText(product.name, query)}
                </div>
                <div style="font-size: 0.8rem; color: #64748b;">
                    ${product.category ? 'in ' + product.category : ''}
                    ${product.description ? ' • ' + this.truncateText(product.description, 40) : ''}
                </div>
            </div>
            <div style="font-weight: bold; color: #0284c7; white-space: nowrap; margin-left: 12px;">
                R${product.price}
            </div>
        `;
        
        item.addEventListener('click', () => {
            this.selectItem(item, product);
        });
        
        item.addEventListener('mouseenter', () => {
            this.setActiveItem(item);
        });
        
        return item;
    }
    
    selectItem(item, product = null) {
        if (!product) {
            // Extract product info from the item
            const nameElement = item.querySelector('div:first-child div:first-child');
            product = {
                name: nameElement.textContent.replace(/<[^>]*>/g, '') // Remove HTML tags
            };
        }
        
        this.searchInput.value = product.name;
        this.hideAutocomplete();
        
        // Auto-submit the form
        const form = this.searchInput.closest('form');
        if (form) {
            form.submit();
        }
    }
    
    setActiveItem(item) {
        // Remove active class from all items
        this.autocompleteList.querySelectorAll('.autocomplete-item').forEach(i => {
            i.classList.remove('active');
            i.style.backgroundColor = '';
        });
        
        // Add active class to selected item
        item.classList.add('active');
        item.style.backgroundColor = '#f8fafc';
    }
    
    highlightText(text, query) {
        if (!query) return text;
        
        const regex = new RegExp(`(${this.escapeRegex(query)})`, 'gi');
        return text.replace(regex, '<mark style="background-color: #fef3c7; padding: 2px 0;">$1</mark>');
    }
    
    escapeRegex(string) {
        return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
    }
    
    truncateText(text, length) {
        return text.length > length ? text.substring(0, length) + '...' : text;
    }
    
    hideAutocomplete() {
        this.autocompleteList.style.display = 'none';
        this.autocompleteList.querySelectorAll('.autocomplete-item').forEach(item => {
            item.classList.remove('active');
        });
    }
    
    debounce(func, wait) {
        let timeout;
        return function executedFunction(...args) {
            const later = () => {
                clearTimeout(timeout);
                func(...args);
            };
            clearTimeout(timeout);
            timeout = setTimeout(later, wait);
        };
    }
}

// Initialize when DOM is loaded
document.addEventListener('DOMContentLoaded', function() {
    new SearchAutocomplete();
});

--- File: assets\js\stock-validator.js ---
// Real-time stock validation for products
class StockValidator {
    constructor() {
        this.initStockValidation();
    }
    
    initStockValidation() {
        // Add event listeners to all quantity inputs
        document.querySelectorAll('.quantity-input').forEach(input => {
            input.addEventListener('change', this.validateStock.bind(this));
            input.addEventListener('input', this.debounce(this.validateStock.bind(this), 500));
        });
        
        // Add real-time validation to add to cart buttons
        document.querySelectorAll('.add-to-cart-btn').forEach(button => {
            button.addEventListener('click', this.validateBeforeAdd.bind(this));
        });
    }
    
    async validateStock(event) {
        const input = event.target;
        const form = input.closest('.add-to-cart-form');
        const productId = form.querySelector('input[name="product_id"]').value;
        const quantity = parseInt(input.value);
        const maxStock = parseInt(input.getAttribute('max')) || 999;
        const button = form.querySelector('.add-to-cart-btn');
        const stockDisplay = form.closest('.product-info').querySelector('.product-stock');
        
        // Immediate client-side validation
        if (quantity > maxStock) {
            this.showStockError(input, `Only ${maxStock} items available`);
            button.disabled = true;
            button.innerHTML = '<i class="fas fa-shopping-cart"></i> Out of Stock';
            return;
        }
        
        if (quantity < 1) {
            input.value = 1;
            return;
        }
        
        // Real-time server-side validation
        try {
            const response = await fetch(`../../api/stock-check.php?product_id=${productId}`);
            if (!response.ok) throw new Error('Network error');
            
            const data = await response.json();
            
            if (data.available_stock < quantity) {
                this.showStockError(input, `Only ${data.available_stock} items available`);
                button.disabled = true;
                button.innerHTML = '<i class="fas fa-shopping-cart"></i> Out of Stock';
                
                // Update stock display
                if (stockDisplay) {
                    stockDisplay.innerHTML = `<i class="fas fa-times-circle"></i> Only ${data.available_stock} left`;
                    stockDisplay.className = 'product-stock stock-low';
                }
            } else {
                this.clearStockError(input);
                button.disabled = false;
                button.innerHTML = '<i class="fas fa-shopping-cart"></i> Add to Cart';
                
                // Update stock display if it was changed
                if (stockDisplay && data.available_stock <= 10) {
                    stockDisplay.innerHTML = `<i class="fas fa-check-circle"></i> Only ${data.available_stock} left`;
                    stockDisplay.className = 'product-stock stock-low';
                }
            }
        } catch (error) {
            console.error('Stock check failed:', error);
            // If API fails, rely on client-side validation only
            this.clearStockError(input);
        }
    }
    
    async validateBeforeAdd(event) {
        const button = event.target;
        const form = button.closest('.add-to-cart-form');
        const productId = form.querySelector('input[name="product_id"]').value;
        const quantity = parseInt(form.querySelector('.quantity-input').value);
        
        // Quick validation before form submission
        try {
            const response = await fetch(`../../api/stock-check.php?product_id=${productId}`);
            const data = await response.json();
            
            if (data.available_stock < quantity) {
                event.preventDefault();
                this.showNotification(`Sorry, only ${data.available_stock} items available`, 'error');
                return false;
            }
        } catch (error) {
            console.error('Pre-add validation failed:', error);
            // Continue with form submission if validation fails
        }
        
        return true;
    }
    
    showStockError(input, message) {
        this.clearStockError(input);
        
        const errorDiv = document.createElement('div');
        errorDiv.className = 'stock-error-message';
        errorDiv.style.cssText = `
            color: #e74c3c;
            font-size: 0.8rem;
            margin-top: 0.25rem;
            font-weight: 500;
        `;
        errorDiv.textContent = message;
        
        input.parentNode.appendChild(errorDiv);
        input.style.borderColor = '#e74c3c';
        input.style.backgroundColor = '#fef2f2';
    }
    
    clearStockError(input) {
        const existingError = input.parentNode.querySelector('.stock-error-message');
        if (existingError) {
            existingError.remove();
        }
        input.style.borderColor = '';
        input.style.backgroundColor = '';
    }
    
    showNotification(message, type) {
        const notification = document.createElement('div');
        notification.className = `notification notification-${type}`;
        notification.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 5px;
            color: white;
            z-index: 10000;
            font-weight: 500;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            animation: slideInRight 0.3s ease-out;
        `;
        
        if (type === 'success') {
            notification.style.background = '#10b981';
        } else {
            notification.style.background = '#e74c3c';
        }
        
        notification.innerHTML = `
            <i class="fas fa-${type === 'success' ? 'check' : 'exclamation'}-circle"></i>
            ${message}
        `;
        
        document.body.appendChild(notification);
        
        setTimeout(() => {
            notification.style.animation = 'slideOutRight 0.3s ease-in';
            setTimeout(() => notification.remove(), 300);
        }, 3000);
    }
    
    debounce(func, wait) {
        let timeout;
        return function executedFunction(...args) {
            const later = () => {
                clearTimeout(timeout);
                func(...args);
            };
            clearTimeout(timeout);
            timeout = setTimeout(later, wait);
        };
    }
}

// Initialize when DOM is loaded
document.addEventListener('DOMContentLoaded', function() {
    new StockValidator();
});

--- File: config\config.php ---
<?php
/**
 * SmartRetail - Simple Config
 */

// Basic App Settings
define('SITE_NAME', 'SmartRetail');
define('SITE_URL', 'http://localhost/smart-retail');
define('BASE_PATH', '/smart-retail');

// Environment Detection
$host = $_SERVER['HTTP_HOST'] ?? '';
if (strpos($host, 'localhost') !== false || strpos($host, '127.0.0.1') !== false) {
    define('ENVIRONMENT', 'development');
} else {
    define('ENVIRONMENT', 'production');
}

// Database Config
define('DB_HOST', 'localhost');
define('DB_NAME', 'smartretail_db');
define('DB_USER', 'root');
define('DB_PASS', '');

// Security
define('SECRET_KEY', 'your-secret-key-here');

// File Uploads
define('UPLOAD_PATH', __DIR__ . '/../images/');
define('MAX_FILE_SIZE', 5 * 1024 * 1024); // 5MB

// App Settings
define('ITEMS_PER_PAGE', 12);
define('DEFAULT_CURRENCY', 'ZAR');

// Error Reporting (turn off in production)
error_reporting(E_ALL);
ini_set('display_errors', 1);

// Timezone
date_default_timezone_set('Africa/Johannesburg');

// Start session if not started
if (session_status() === PHP_SESSION_NONE) {
    session_start();
}

// Database connection
try {
    $pdo = new PDO(
        "mysql:host=" . DB_HOST . ";dbname=" . DB_NAME . ";charset=utf8mb4",
        DB_USER,
        DB_PASS,
        [
            PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION,
            PDO::ATTR_DEFAULT_FETCH_MODE => PDO::FETCH_ASSOC
        ]
    );
} catch (PDOException $e) {
    die("Database connection failed: " . $e->getMessage());
}

// Simple helper functions
function redirect($url) {
    header('Location: ' . $url);
    exit();
}

function sanitize($data) {
    return htmlspecialchars(trim($data), ENT_QUOTES, 'UTF-8');
}

function is_logged_in() {
    return isset($_SESSION['user_id']);
}
?>

--- File: config\database.php ---
<?php
class Database {
    private $host = "localhost";
    private $db_name = "smartretail_db";
    private $username = "root";
    private $password = "";
    public $conn;

    public function getConnection() {
        $this->conn = null;
        try {
            $this->conn = new PDO(
                "mysql:host=" . $this->host . ";dbname=" . $this->db_name . ";charset=utf8mb4",
                $this->username,
                $this->password,
                [
                    PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION,
                    PDO::ATTR_DEFAULT_FETCH_MODE => PDO::FETCH_ASSOC
                ]
            );
        } catch(PDOException $exception) {
            echo "Connection error: " . $exception->getMessage();
        }
        return $this->conn;
    }
}

--- File: dashboard.php ---
<?php
/**
 * SmartRetail - User Dashboard
 * Modern, responsive dashboard with real products from database
 */

require_once 'config/config.php';
require_once 'utils/Auth.php';
require_once 'config/Database.php';
require_once 'models/Product.php';
require_once 'models/Category.php';

// Require authentication
Auth::requireAuth();

// Get user information
$user_id = Auth::getUserId();
$user_role = Auth::getUserRole();
$username = $_SESSION['username'];
$full_name = $_SESSION['full_name'];
$email = $_SESSION['email'];

// Initialize database connection
try {
    $database = new Database();
    $db = $database->getConnection();
    $productModel = new Product($db);
    $categoryModel = new Category($db);
} catch (Exception $e) {
    error_log("Database connection failed: " . $e->getMessage());
    $productModel = null;
    $categoryModel = null;
}

// Initialize cart if not exists
if (!isset($_SESSION['cart'])) {
    $_SESSION['cart'] = [];
}

// Get cart items from session and calculate proper cart count
$cart_items = $_SESSION['cart'];
$cart_total = 0;
$cart_count = 0;

// Calculate total quantity of all items in cart
foreach ($cart_items as $item) {
    $cart_count += $item['quantity'] ?? 1;
}

// Get featured products from database
if ($productModel) {
    try {
        $products_data = $productModel->getAllProductsWithCategory();
        
        // Process products for display - limit to 6 featured products
        $featured_products = [];
        $count = 0;
        foreach ($products_data as $row) {
            if ($count >= 6) break; // Show only 6 products on dashboard
            
            $row['icon'] = Product::getProductIcon($row['name']);
            $row['rating'] = $row['rating'] ?? 4.5;
            $row['stock'] = $row['stock_quantity'] ?? 10;
            $featured_products[] = $row;
            $count++;
        }
        
        // If no products in database, use demo data
        if (empty($featured_products)) {
            $featured_products = getDemoProducts();
        }
        
    } catch (Exception $e) {
        error_log("Error fetching products: " . $e->getMessage());
        $featured_products = getDemoProducts();
    }
} else {
    $featured_products = getDemoProducts();
}

// Helper function for demo data (fallback)
function getDemoProducts() {
    return [
        [
            'id' => 1, 
            'name' => 'Wireless Headphones', 
            'price' => 129.99, 
            'rating' => 4.6, 
            'stock' => 120, 
            'icon' => 'fas fa-headphones',
            'description' => 'High-quality wireless headphones with noise cancellation and premium sound quality.',
            'category_name' => 'Electronics'
        ],
        [
            'id' => 2, 
            'name' => 'Smart Watch', 
            'price' => 299.99, 
            'rating' => 4.4, 
            'stock' => 85, 
            'icon' => 'fas fa-clock',
            'description' => 'Feature-rich smartwatch with health monitoring, GPS, and long battery life.',
            'category_name' => 'Electronics'
        ],
        [
            'id' => 3, 
            'name' => 'Laptop Backpack', 
            'price' => 59.99, 
            'rating' => 4.8, 
            'stock' => 200, 
            'icon' => 'fas fa-briefcase',
            'description' => 'Durable laptop backpack with multiple compartments and waterproof material.',
            'category_name' => 'Accessories'
        ],
        [
            'id' => 4, 
            'name' => 'Bluetooth Speaker', 
            'price' => 89.99, 
            'rating' => 4.5, 
            'stock' => 150, 
            'icon' => 'fas fa-volume-up',
            'description' => 'Portable Bluetooth speaker with crystal clear sound and long battery life.',
            'category_name' => 'Electronics'
        ],
        [
            'id' => 5, 
            'name' => 'Gaming Mouse', 
            'price' => 49.99, 
            'rating' => 4.7, 
            'stock' => 75, 
            'icon' => 'fas fa-mouse',
            'description' => 'High-precision gaming mouse with RGB lighting and programmable buttons.',
            'category_name' => 'Electronics'
        ],
        [
            'id' => 6, 
            'name' => 'USB-C Hub', 
            'price' => 39.99, 
            'rating' => 4.3, 
            'stock' => 120, 
            'icon' => 'fas fa-plug',
            'description' => 'Multi-port USB-C hub for expanding your connectivity options.',
            'category_name' => 'Electronics'
        ]
    ];
}

// Handle add to cart from dashboard
if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_POST['add_to_cart'])) {
    $product_id = $_POST['product_id'];
    $product_name = $_POST['product_name'];
    $product_price = (float)$_POST['product_price'];
    $product_icon = $_POST['product_icon'];
    
    // Initialize cart in session if not exists
    if (!isset($_SESSION['cart'])) {
        $_SESSION['cart'] = [];
    }
    
    // Check if item already exists in cart
    $item_exists = false;
    foreach ($_SESSION['cart'] as &$item) {
        if ($item['id'] == $product_id) {
            $item['quantity'] += 1;
            $item_exists = true;
            break;
        }
    }
    
    if (!$item_exists) {
        $new_item = [
            'id' => $product_id,
            'product_id' => $product_id,
            'name' => $product_name,
            'price' => $product_price,
            'quantity' => 1,
            'icon' => $product_icon,
            'stock_quantity' => 10
        ];
        $_SESSION['cart'][] = $new_item;
    }
    
    // Update cart count
    $cart_count = 0;
    foreach ($_SESSION['cart'] as $item) {
        $cart_count += $item['quantity'] ?? 1;
    }
    
    // Redirect to prevent form resubmission
    header('Location: dashboard.php?added=1');
    exit;
}

// Update cart count after potential cart modification
$cart_count = 0;
foreach ($_SESSION['cart'] as $item) {
    $cart_count += $item['quantity'] ?? 1;
}
?>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - SmartRetail</title>
    <link rel="stylesheet" href="assets/css/style.css">
    
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <!-- Mobile Navigation Toggle -->
                <button class="mobile-nav-toggle" id="mobileNavToggle">
                    <i class="fas fa-bars"></i>
                    <span class="logo">
                        <i class="fas fa-store"></i>
                        SmartRetail
                    </span>
                </button>
            
                <!-- Desktop Logo (hidden on mobile) -->
                <a href="/" class="logo desktop-logo">
                    <i class="fas fa-store"></i>
                    SmartRetail
                </a>
                
                <!-- Navigation -->
                <nav>
                    <ul class="nav-links">
                        <li><a href="views/products/products.php">Products</a></li>
                        <li><a href="views/categories/category.php">Categories</a></li>
                        <li><a href="dashboard.php">Dashboard</a></li>
                    </ul>
                </nav>
                
                <!-- Header Actions -->
                <div class="header-actions">    
                    <!-- Shopping Cart -->
                    <a href="views/cart/cart.php" class="cart-icon" title="Shopping Cart">
                        <i class="fas fa-shopping-cart"></i>
                        <?php if ($cart_count > 0): ?>
                            <span class="cart-count"><?php echo $cart_count; ?></span>
                        <?php endif; ?>
                    </a>
                    
                    <!-- User Dropdown Menu -->
                    <div class="user-menu">
                        <button class="btn btn-outline" id="userMenuButton" style="display: flex; align-items: center; gap: 0.5rem;">
                            <i class="fas fa-user"></i>
                            <?php echo htmlspecialchars($username); ?>
                            <i class="fas fa-chevron-down" style="font-size: 0.75rem;"></i>
                        </button>
                        
                        <div class="user-dropdown" id="userDropdown">
                            <div class="user-dropdown-header">
                                <div class="username"><?php echo htmlspecialchars($full_name); ?></div>
                                <div class="email"><?php echo htmlspecialchars($email); ?></div>
                                <div class="role"><?php echo ucfirst($_SESSION['role'] ?? 'User'); ?> Account</div>
                            </div>
                            
                            <div class="user-dropdown-links">
                                <a href="views/order/orders.php" class="user-dropdown-link">
                                    <i class="fas fa-shopping-bag"></i>
                                    My Orders
                                </a>

                                <?php if (Auth::hasRole('admin') || Auth::hasRole('staff')): ?>
                                    <div class="user-dropdown-divider"></div>
                                    <a href="views/admin/admin-dashboard.php" class="user-dropdown-link">
                                        <i class="fas fa-cog"></i>
                                        Admin Panel
                                    </a>
                                <?php endif; ?>
                                
                                <div class="user-dropdown-divider"></div>
                                <a href="logout.php" class="user-dropdown-link logout">
                                    <i class="fas fa-sign-out-alt"></i>
                                    Logout
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Mobile Navigation -->
    <div class="mobile-nav" id="mobileNav">
        <div class="mobile-nav-sidebar">
            <!-- Single Line Header -->
            <div class="mobile-nav-header">
                <div class="mobile-nav-brand">
                    <i class="fas fa-store"></i>
                    <span>SmartRetail</span>
                </div>
                <button class="mobile-nav-close" id="mobileNavClose">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <!-- User Info -->
            <div class="mobile-nav-user">
                <div class="mobile-nav-user-avatar">
                    <?php echo strtoupper(substr($full_name, 0, 1)); ?>
                </div>
                <div class="mobile-nav-user-info">
                    <div class="username"><?php echo htmlspecialchars($full_name); ?></div>
                    <div class="email"><?php echo htmlspecialchars($email); ?></div>
                    <div class="role"><?php echo ucfirst($_SESSION['role'] ?? 'User'); ?></div>
                </div>
            </div>

            <!-- Navigation Links -->
            <div class="mobile-nav-content">
                <ul class="mobile-nav-links">
                    <li><a href="dashboard.php" class="active">
                        <i class="fas fa-home"></i>
                        Dashboard
                    </a></li>
                    <li><a href="views/products/products.php">
                        <i class="fas fa-shopping-bag"></i>
                        All Products
                    </a></li>
                    <li><a href="views/categories/category.php">
                        <i class="fas fa-list"></i>
                        Categories
                    </a></li>
                    <li><a href="views/order/orders.php">
                        <i class="fas fa-receipt"></i>
                        My Orders
                    </a></li>
                
                    <?php if (Auth::hasRole('admin') || Auth::hasRole('staff')): ?>
                        <div class="mobile-nav-divider"></div>
                        <li><a href="views/admin/admin-dashboard.php">
                            <i class="fas fa-cog"></i>
                            Admin Panel
                        </a></li>
                    <?php endif; ?>
                
                    <div class="mobile-nav-divider"></div>
                    <li><a href="logout.php" class="logout-link">
                        <i class="fas fa-sign-out-alt"></i>
                        Logout
                    </a></li>
                </ul>
            </div>

            <!-- Cart Summary -->
            <div class="mobile-nav-footer">
                <a href="views/cart/cart.php" class="mobile-nav-cart">
                    <div class="mobile-nav-cart-info">
                        <div class="mobile-nav-cart-label">Shopping Cart</div>
                    <div class="mobile-nav-cart-count">
                            <?php echo $cart_count; ?> item<?php echo $cart_count !== 1 ? 's' : ''; ?>
                        </div>
                    </div>
                    <div class="mobile-nav-cart-icon">
                        <i class="fas fa-shopping-cart"></i>
                        <?php if ($cart_count > 0): ?>
                            <span class="mobile-nav-cart-badge"><?php echo $cart_count; ?></span>
                        <?php endif; ?>
                    </div>
                </a>
            </div>
        </div>
    </div>

    <!-- Hero Section -->
    <section class="hero-section">
        <div class="container">
            <div class="hero-content">
                <h1>Welcome to Smart Retail</h1>
                <p>Discover amazing products with intelligent recommendations and seamless checkout</p>
                <div class="search-container">
                    <form action="/products.php" method="GET" class="search-form">
                        <input type="text" name="search" placeholder="Search products..." class="search-input">
                        <button type="submit" class="search-button">
                            <i class="fas fa-search"></i>
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </section>

    <!-- Featured Products Section -->
    <section class="products-section">
        <div class="container">
            <div class="section-header">
                <h2>Featured Products</h2>
                <p>Browse our collection of quality products</p>
            </div>
        
            <div class="products-grid">
                <?php foreach ($featured_products as $product): 
                    // Use product_id from database, fallback to id for demo data
                    $product_id = $product['product_id'] ?? $product['id'];
                    $product_name = $product['name'];
                    $product_price = $product['price'];
                    $product_icon = $product['icon'];
                    $product_rating = $product['rating'] ?? 4.5;
                    $product_stock = $product['stock_quantity'] ?? $product['stock'] ?? 10;
                    $product_description = $product['description'] ?? 'Quality product from our collection.';
                ?>
                <div class="product-card">
                    <div class="product-icon">
                        <i class="<?php echo $product_icon; ?>"></i>
                    </div>
                    <div class="product-info">
                        <div class="product-header">
                            <h3 class="product-name"><?php echo htmlspecialchars($product_name); ?></h3>
                            <div class="product-price">R<?php echo number_format($product_price, 2); ?></div>
                        </div>
                    
                        <p class="product-description"><?php echo htmlspecialchars($product_description); ?></p>
                    
                        <div class="product-rating">
                            <div class="rating-stars">
                                <?php
                                $fullStars = floor($product_rating);
                                $hasHalfStar = ($product_rating - $fullStars) >= 0.5;
                            
                                for ($i = 1; $i <= 5; $i++) {
                                    if ($i <= $fullStars) {
                                        echo '<i class="fas fa-star"></i>';
                                    } elseif ($i == $fullStars + 1 && $hasHalfStar) {
                                        echo '<i class="fas fa-star-half-alt"></i>';
                                    } else {
                                        echo '<i class="far fa-star"></i>';
                                    }
                                }
                                ?>
                            </div>
                            <span class="rating-value"><?php echo number_format($product_rating, 1); ?></span>
                        </div>
                    
                        <div class="product-stock">
                            <i class="fas fa-check-circle"></i>
                            <?php echo $product_stock; ?> items in stock
                        </div>
                
                        <!-- Add to Cart Form -->
                        <form method="POST" style="width: 100%;">
                            <input type="hidden" name="product_id" value="<?php echo $product_id; ?>">
                            <input type="hidden" name="product_name" value="<?php echo htmlspecialchars($product_name); ?>">
                            <input type="hidden" name="product_price" value="<?php echo $product_price; ?>">
                            <input type="hidden" name="product_icon" value="<?php echo $product_icon; ?>">
                            <button type="submit" name="add_to_cart" class="btn btn-primary" style="width: 100%; justify-content: center; padding: 1rem; font-size: 1rem;">
                                <i class="fas fa-shopping-cart"></i>
                                Add to Cart
                            </button>
                        </form>
                    </div>
                </div>
                <?php endforeach; ?>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <!-- About Section -->
                <div class="footer-section">
                    <h3>About SmartRetail</h3>
                    <p>Your trusted destination for quality products and exceptional service.</p>
                </div>
            </div>

            <div class="footer-bottom">
                <p>&copy; <?php echo date('Y'); ?> SmartRetail System. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- JavaScript -->
    <script src="assets/js/dashboard.js"></script>
    <script src="../../assets/js/enhanced-features.js"></script>
</body>
</html>

--- File: docs\.project_structure_ignore ---


--- File: index.php ---
<?php
/**
 * SmartRetail - Homepage
 */

// Start session if not already started
if (session_status() === PHP_SESSION_NONE) {
    session_start();
}

// Include database configuration and models
require_once 'config/config.php';
require_once 'config/Database.php';
require_once 'models/Product.php';
require_once 'models/Category.php';

// Initialize database connection
try {
    $database = new Database();
    $db = $database->getConnection();
    $productModel = new Product($db);
    $categoryModel = new Category($db);
} catch (Exception $e) {
    error_log("Database connection failed: " . $e->getMessage());
    $productModel = null;
}

// Initialize cart if not exists and get cart count
if (!isset($_SESSION['cart'])) {
    $_SESSION['cart'] = [];
}
$cart_count = count($_SESSION['cart']);

// Get featured products from database
if ($productModel) {
    try {
        $products_data = $productModel->getAllProductsWithCategory();
        
        // Process products for display - limit to 6 featured products
        $featured_products = [];
        $count = 0;
        foreach ($products_data as $row) {
            if ($count >= 6) break; // Show only 6 products on homepage
            
            $row['icon'] = Product::getProductIcon($row['name']);
            $row['rating'] = $row['rating'] ?? 4.5;
            $row['stock'] = $row['stock_quantity'] ?? 10;
            $featured_products[] = $row;
            $count++;
        }
        
        // If no products in database, use demo data
        if (empty($featured_products)) {
            $featured_products = getDemoProducts();
        }
        
    } catch (Exception $e) {
        error_log("Error fetching products: " . $e->getMessage());
        $featured_products = getDemoProducts();
    }
} else {
    $featured_products = getDemoProducts();
}

// Helper function for demo data (fallback)
function getDemoProducts() {
    return [
        [
            'id' => 1, 
            'name' => 'Wireless Headphones', 
            'price' => 129.99, 
            'rating' => 4.6, 
            'stock' => 120, 
            'icon' => 'fas fa-headphones',
            'description' => 'High-quality wireless headphones with noise cancellation and premium sound quality.',
            'category_name' => 'Electronics'
        ],
        [
            'id' => 2, 
            'name' => 'Smart Watch', 
            'price' => 299.99, 
            'rating' => 4.4, 
            'stock' => 85, 
            'icon' => 'fas fa-clock',
            'description' => 'Feature-rich smartwatch with health monitoring, GPS, and long battery life.',
            'category_name' => 'Electronics'
        ],
        [
            'id' => 3, 
            'name' => 'Laptop Backpack', 
            'price' => 59.99, 
            'rating' => 4.8, 
            'stock' => 200, 
            'icon' => 'fas fa-briefcase',
            'description' => 'Durable laptop backpack with multiple compartments and waterproof material.',
            'category_name' => 'Accessories'
        ],
        [
            'id' => 4, 
            'name' => 'Bluetooth Speaker', 
            'price' => 89.99, 
            'rating' => 4.5, 
            'stock' => 150, 
            'icon' => 'fas fa-volume-up',
            'description' => 'Portable Bluetooth speaker with crystal clear sound and long battery life.',
            'category_name' => 'Electronics'
        ],
        [
            'id' => 5, 
            'name' => 'Gaming Mouse', 
            'price' => 49.99, 
            'rating' => 4.7, 
            'stock' => 75, 
            'icon' => 'fas fa-mouse',
            'description' => 'High-precision gaming mouse with RGB lighting and programmable buttons.',
            'category_name' => 'Electronics'
        ],
        [
            'id' => 6, 
            'name' => 'USB-C Hub', 
            'price' => 39.99, 
            'rating' => 4.3, 
            'stock' => 120, 
            'icon' => 'fas fa-plug',
            'description' => 'Multi-port USB-C hub for expanding your connectivity options.',
            'category_name' => 'Electronics'
        ]
    ];
}

// Handle add to cart from homepage
if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_POST['add_to_cart'])) {
    $product_id = $_POST['product_id'];
    $product_name = $_POST['product_name'];
    $product_price = (float)$_POST['product_price'];
    $product_icon = $_POST['product_icon'];
    
    // Initialize cart in session if not exists
    if (!isset($_SESSION['cart'])) {
        $_SESSION['cart'] = [];
    }
    
    // Check if item already exists in cart
    $item_exists = false;
    foreach ($_SESSION['cart'] as &$item) {
        if ($item['id'] == $product_id) {
            $item['quantity'] += 1;
            $item_exists = true;
            break;
        }
    }
    
    if (!$item_exists) {
        $new_item = [
            'id' => $product_id,
            'product_id' => $product_id,
            'name' => $product_name,
            'price' => $product_price,
            'quantity' => 1,
            'icon' => $product_icon,
            'stock_quantity' => 10
        ];
        $_SESSION['cart'][] = $new_item;
    }
    
    // Update cart count
    $cart_count = count($_SESSION['cart']);
    
    // Redirect to prevent form resubmission
    header('Location: index.php?added=1');
    exit;
}

// Update cart count after potential cart modification
$cart_count = count($_SESSION['cart']);
?>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmartRetail - Your Trusted Shopping Destination</title>
    <link rel="stylesheet" href="assets/css/style.css">
    
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
</head>
<body>
    <!-- Header -->
     <header class="header">
        <div class="container">
            <div class="header-content">
                <!-- Logo -->
                <a href="/" class="logo">
                    <i class="fas fa-store"></i>
                    SmartRetail
                </a>

                <!-- Navigation -->
                <nav>
                    <ul class="nav-links">
                        <li><a href="#">Products</a></li>
                        <li><a href="#">Categories</a></li>
                        <?php if (isset($_SESSION['user_id'])): ?>
                            <li><a href="dashboard.php">Dashboard</a></li>
                        <?php endif; ?>
                    </ul>
                </nav>

                <!-- Header Actions -->
                <div class="header-actions">
                    <?php if (isset($_SESSION['user_id'])): ?>
                        <!-- User is logged in -->
                        <a href="dashboard.php" class="cart-icon" title="Dashboard">
                            <i class="fas fa-user"></i>
                        </a>
                    <?php else: ?>
                        <!-- User is not logged in -->
                        <a href="login.php" class="cart-icon" title="Login">
                            <i class="fas fa-user"></i>
                        </a>
                    <?php endif; ?>

                    <!-- Shopping Cart -->
                    <a href="<?php echo isset($_SESSION['user_id']) ? 'views/cart/cart.php' : 'login.php'; ?>" class="cart-icon" title="Shopping Cart">
                        <i class="fas fa-shopping-cart"></i>
                        <?php if ($cart_count > 0): ?>
                            <span class="cart-count"><?php echo $cart_count; ?></span>
                        <?php endif; ?>
                    </a>
                </div>
            </div>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero-section">
        <div class="container">
            <div class="hero-content">
                <h1>Welcome to Smart Retail</h1>
                <p>Discover amazing products with intelligent recommendations and seamless checkout</p>
                <div class="search-container">
                    <form action="views/products/products.php" method="GET" class="search-form">
                        <input type="text" name="search" placeholder="Search products..." class="search-input">
                        <button type="submit" class="search-button">
                            <i class="fas fa-search"></i>
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </section>

    <!-- Featured Products Section -->
    <section class="products-section">
        <div class="container">
            <div class="section-header">
                <h2>Featured Products</h2>
                <p>Browse our collection of quality products</p>
            </div>
            
            <div class="products-grid">
                <?php foreach ($featured_products as $product): 
                    // Use product_id from database, fallback to id for demo data
                    $product_id = $product['product_id'] ?? $product['id'];
                    $product_name = $product['name'];
                    $product_price = $product['price'];
                    $product_icon = $product['icon'];
                    $product_rating = $product['rating'] ?? 4.5;
                    $product_stock = $product['stock_quantity'] ?? $product['stock'] ?? 10;
                    $product_description = $product['description'] ?? 'Quality product from our collection.';
                ?>
                <div class="product-card">
                    <div class="product-icon">
                        <i class="<?php echo $product_icon; ?>"></i>
                        <?php if (isset($product['category_name'])): ?>
                            <div class="category-badge">
                                <?php echo htmlspecialchars($product['category_name']); ?>
                            </div>
                        <?php endif; ?>
                    </div>
                    <div class="product-info">
                        <div class="product-header">
                            <h3 class="product-name"><?php echo htmlspecialchars($product_name); ?></h3>
                            <div class="product-price">R<?php echo number_format($product_price, 2); ?></div>
                        </div>
                        
                        <p class="product-description"><?php echo htmlspecialchars($product_description); ?></p>
                        
                        <div class="product-rating">
                            <div class="rating-stars">
                                <?php
                                $fullStars = floor($product_rating);
                                $hasHalfStar = ($product_rating - $fullStars) >= 0.5;
                                
                                for ($i = 1; $i <= 5; $i++) {
                                    if ($i <= $fullStars) {
                                        echo '<i class="fas fa-star"></i>';
                                    } elseif ($i == $fullStars + 1 && $hasHalfStar) {
                                        echo '<i class="fas fa-star-half-alt"></i>';
                                    } else {
                                        echo '<i class="far fa-star"></i>';
                                    }
                                }
                                ?>
                            </div>
                            <span class="rating-value"><?php echo number_format($product_rating, 1); ?></span>
                        </div>
                        
                        <div class="product-stock">
                            <i class="fas fa-check-circle"></i>
                            <?php echo $product_stock; ?> items in stock
                        </div>
                    
                        <!-- Add to Cart Form -->
                        <form method="POST" style="width: 100%;">
                            <input type="hidden" name="product_id" value="<?php echo $product_id; ?>">
                            <input type="hidden" name="product_name" value="<?php echo htmlspecialchars($product_name); ?>">
                            <input type="hidden" name="product_price" value="<?php echo $product_price; ?>">
                            <input type="hidden" name="product_icon" value="<?php echo $product_icon; ?>">
                            <button type="submit" name="add_to_cart" class="btn btn-primary" style="width: 100%; justify-content: center; padding: 1rem; font-size: 1rem;">
                                <i class="fas fa-shopping-cart"></i>
                                Add to Cart
                            </button>
                        </form>
                    </div>
                </div>
                <?php endforeach; ?>
            </div>
        </div>
    </section>

     <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <!-- About Section -->
                <div class="footer-section">
                    <h3>About SmartRetail</h3>
                    <p>Your trusted destination for quality products and exceptional service.</p>
                </div>
            </div>

            <div class="footer-bottom">
                <p>&copy; <?php echo date('Y'); ?> SmartRetail System. All rights reserved.</p>
            </div>
        </div>
    </footer>


    <!-- JavaScript -->
    <script src="assets/js/main.js"></script>
    <script src="../../assets/js/enhanced-features.js"></script>

</body>
</html>

--- File: login.php ---
<?php
/**
 * Login View
 * Displays the login form for users with role selection
 */

require_once 'config/config.php';
require_once 'utils/Auth.php';

// Redirect if already logged in
if (Auth::isLoggedIn()) {
    // Determine redirect based on user role
    $user_role = $_SESSION['role_name'] ?? '';
    $redirect = $_GET['redirect'] ?? getDefaultRedirect($user_role);
    header('Location: ' . $redirect);
    exit();
}

// Helper function to determine default redirect based on role
function getDefaultRedirect($role) {
    switch ($role) {
        case 'admin':
        case 'staff':
            return BASE_PATH . 'views/admin/admin-dashboard.php';
        case 'customer':
        default:
            return BASE_PATH . '/dashboard.php';
    }
}

// Generate CSRF token
$csrf_token = Auth::generateCSRFToken();

// Get form data from session if available (for form repopulation after errors)
$form_data = [
    'username' => $_SESSION['form_data']['username'] ?? '',
    'remember_me' => $_SESSION['form_data']['remember_me'] ?? false,
    'login_type' => $_SESSION['form_data']['login_type'] ?? 'customer'
];

// Clear form data from session after use
unset($_SESSION['form_data']);
?>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - <?php echo SITE_NAME; ?></title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="assets/css/auth.css">
</head>
<body>
    <div class="container">
        <div class="left-panel">
            <div class="logo">
                <i class="fas fa-store"></i>
                <?php echo SITE_NAME; ?>
            </div>
            <h1>Welcome Back</h1>
            <p>Sign in to access your <?php echo SITE_NAME; ?> account and continue your shopping experience.</p>
            <ul class="features">
                <li><i class="fas fa-check"></i> Track your orders</li>
                <li><i class="fas fa-check"></i> Manage your profile</li>
                <li><i class="fas fa-check"></i> Save your preferences</li>
                <li><i class="fas fa-check"></i> Faster checkout</li>
            </ul>
        </div>
        
        <div class="right-panel">
            <h2 style="text-align: center; margin-bottom: 1rem; color: #1f2937;">Sign In to Your Account</h2>

            <!-- Login Type Selector -->
            <div class="login-type-selector">
                <button type="button" class="login-type-btn customer <?php echo $form_data['login_type'] === 'customer' ? 'active' : ''; ?>" 
                        onclick="selectLoginType('customer')">
                    <i class="fas fa-user login-type-icon"></i>
                    Customer Login
                </button>
                <button type="button" class="login-type-btn admin <?php echo $form_data['login_type'] === 'admin' ? 'active' : ''; ?>" 
                        onclick="selectLoginType('admin')">
                    <i class="fas fa-user-shield login-type-icon"></i>
                    Staff/Admin Login
                </button>
            </div>

            <p class="role-hint" id="roleHint">
                <?php echo $form_data['login_type'] === 'customer' 
                    ? 'Sign in to shop and manage your orders' 
                    : 'Access the admin dashboard to manage products, orders, and customers'; ?>
            </p>

            <!-- Error/Success Messages -->
            <?php if (isset($_GET['error'])): ?>
                <div class="alert alert-error">
                    <?php 
                    $errors = [
                        'invalid' => 'Invalid username or password',
                        'inactive' => 'Your account has been deactivated',
                        'locked' => 'Account temporarily locked due to too many failed attempts',
                        'timeout' => 'Your session has expired. Please log in again.',
                        'access_denied' => 'Access denied. Please log in to continue.',
                        'role_mismatch' => 'This account does not have access to the selected login type',
                        'staff_access_denied' => 'Staff accounts must use the Staff/Admin login option'
                    ];
                    echo $errors[$_GET['error']] ?? 'An error occurred during login';
                    ?>
                </div>
            <?php endif; ?>

            <?php if (isset($_GET['success'])): ?>
                <div class="alert alert-success">
                    <?php
                    $success_messages = [
                        'registered' => 'Registration successful! Please log in.',
                        'logout' => 'You have been successfully logged out.',
                        'password_changed' => 'Password changed successfully. Please log in with your new password.'
                    ];
                    echo $success_messages[$_GET['success']] ?? 'Success!';
                    ?>
                </div>
            <?php endif; ?>

            <?php if (isset($_SESSION['error_message'])): ?>
                <div class="alert alert-error">
                    <?php echo htmlspecialchars($_SESSION['error_message']); ?>
                    <?php unset($_SESSION['error_message']); ?>
                </div>
            <?php endif; ?>

        
            <!-- Form action path -->
            <form id="loginForm" action="<?php echo BASE_PATH; ?>/api/auth/login.php" method="POST">
                <!-- CSRF Token -->
                <input type="hidden" name="csrf_token" value="<?php echo $csrf_token; ?>">
                
                <!-- Redirect URL -->
                <input type="hidden" name="redirect" value="<?php echo htmlspecialchars($_GET['redirect'] ?? ''); ?>">

                <!-- Login Type -->
                <input type="hidden" name="login_type" id="loginType" value="<?php echo $form_data['login_type']; ?>">

                <div class="form-group">
                    <label class="form-label" for="username">Username or Email *</label>
                    <input type="text" id="username" name="username" class="form-input" required 
                           autocomplete="username" value="<?php echo htmlspecialchars($form_data['username']); ?>">
                    <div class="error-message" id="username_error">Please enter your username or email</div>
                </div>

                <div class="form-group">
                    <label class="form-label" for="password">Password *</label>
                    <div class="password-toggle">
                        <input type="password" id="password" name="password" class="form-input" required 
                               autocomplete="current-password">
                        <button type="button" class="toggle-btn" onclick="togglePassword()">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                    <div class="error-message" id="password_error">Please enter your password</div>
                </div>

                <div class="form-options">
                    <label class="remember-me">
                        <input type="checkbox" name="remember_me" value="1" <?php echo $form_data['remember_me'] ? 'checked' : ''; ?>>
                        <span>Remember me</span>
                    </label>
                    <!-- FIXED: Forgot password link -->
                    <a href="reset-password.php" class="forgot-password">Forgot password?</a>
                </div>

                <button type="submit" class="btn-submit" id="submitBtn">
                    <span id="btnText">
                        <?php echo $form_data['login_type'] === 'customer' ? 'Sign In as Customer' : 'Sign In as Staff/Admin'; ?>
                    </span>
                    <div id="btnSpinner" class="loading-spinner" style="display: none;"></div>
                </button>
            </form>

            <!-- Demo Accounts (for development) -->
            <?php if (defined('ENVIRONMENT') && ENVIRONMENT === 'development'): ?>
            <div class="demo-accounts">
                <h4>Demo Accounts (Click to auto-fill):</h4>
                <div class="demo-account" onclick="fillDemoCredentials('customer', 'customer123', 'customer')">
                    <strong>Customer:</strong> customer / customer123
                </div>
                <div class="demo-account" onclick="fillDemoCredentials('admin', 'admin123', 'admin')">
                    <strong>Admin:</strong> admin / admin123
                </div>
                <div class="demo-account" onclick="fillDemoCredentials('staff', 'staff123', 'admin')">
                    <strong>Staff:</strong> staff / staff123
                </div>
            </div>
            <?php endif; ?>

            <div class="auth-links">
                <p>Don't have an account? <a href="register.php">Sign up here</a></p>
            </div>

            <!-- Back to Home in right panel (mobile friendly) -->
            <div class="back-to-home">
                <a href="<?php echo BASE_PATH; ?>/index.php">
                    <i class="fas fa-arrow-left"></i>
                    Back to Home Page
                </a>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="assets/js/auth.js"></script>

    <script>
    // Demo account auto-fill (for development)
    <?php 
    $showDemoAccounts = (defined('ENVIRONMENT') && ENVIRONMENT === 'development') 
        || (isset($_GET['demo']) && $_GET['demo'] === 'true');
    if ($showDemoAccounts): 
    ?>
    function fillDemoCredentials(username, password, type) {
        document.getElementById('username').value = username;
        document.getElementById('password').value = password;
        selectLoginType(type);
        
        // Clear any existing errors
        document.querySelectorAll('.error-message').forEach(el => el.style.display = 'none');
        document.querySelectorAll('.form-input').forEach(el => el.classList.remove('error'));
        
        // Show success message
        showAlert(`Demo credentials filled: ${username} / ${password} (${type})`, 'success');
    }
    <?php endif; ?>
    </script>
</body>
</html>

--- File: logout.php ---
<?php
/**
 * Logout Handler
 */

session_start();
require_once 'utils/Auth.php';

// Clear remember me token if set
if (isset($_COOKIE['remember_token'])) {
    setcookie('remember_token', '', time() - 3600, '/', '', true, true);
}

// Log the logout
if (isset($_SESSION['username'])) {
    error_log("User {$_SESSION['username']} logged out");
}

// Destroy session
Auth::logout();

// Redirect to login page
header('Location: login.php?success=logout');
exit;
?>

--- File: models\Cart.php ---
<?php
/**
 * Cart Model
 * Handles cart-related database operations and session management
 */

class Cart {
    private $conn;
    private $table_name = "cart_items";

    // Cart properties
    public $item_id;
    public $user_id;
    public $product_id;
    public $quantity;
    public $unit_price;

    public function __construct($db) {
        $this->conn = $db;
    }

    /**
     * Add item to cart (database version)
     */
    public function addToCart($user_id, $product_id, $quantity = 1) {
        // First, get product price
        $product_query = "SELECT price FROM products WHERE id = ?";
        $product_stmt = $this->conn->prepare($product_query);
        $product_stmt->bindParam(1, $product_id);
        $product_stmt->execute();
        
        $product = $product_stmt->fetch(PDO::FETCH_ASSOC);
        if (!$product) {
            return false; // Product not found
        }
        
        $unit_price = $product['price'];

        // Check if item already exists in cart
        $query = "SELECT item_id, quantity FROM " . $this->table_name . " 
                  WHERE user_id = ? AND product_id = ?";
        $stmt = $this->conn->prepare($query);
        $stmt->bindParam(1, $user_id);
        $stmt->bindParam(2, $product_id);
        $stmt->execute();

        if ($stmt->rowCount() > 0) {
            // Update existing item quantity
            $row = $stmt->fetch(PDO::FETCH_ASSOC);
            $new_quantity = $row['quantity'] + $quantity;
            
            $query = "UPDATE " . $this->table_name . " 
                      SET quantity = ?, unit_price = ?
                      WHERE item_id = ?";
            $stmt = $this->conn->prepare($query);
            $stmt->bindParam(1, $new_quantity);
            $stmt->bindParam(2, $unit_price);
            $stmt->bindParam(3, $row['item_id']);
        } else {
            // Insert new item
            $query = "INSERT INTO " . $this->table_name . " 
                      (user_id, product_id, quantity, unit_price) 
                      VALUES (?, ?, ?, ?)";
            $stmt = $this->conn->prepare($query);
            $stmt->bindParam(1, $user_id);
            $stmt->bindParam(2, $product_id);
            $stmt->bindParam(3, $quantity);
            $stmt->bindParam(4, $unit_price);
        }

        return $stmt->execute();
    }

    /**
     * Get user's cart items from database
     */
    public function getCartItems($user_id) {
        $query = "SELECT 
                    ci.item_id, ci.product_id, ci.quantity, ci.unit_price,
                    p.name, p.description, p.image
                  FROM " . $this->table_name . " ci
                  INNER JOIN products p ON ci.product_id = p.id
                  WHERE ci.user_id = ?
                  ORDER BY ci.item_id DESC";

        $stmt = $this->conn->prepare($query);
        $stmt->bindParam(1, $user_id);
        $stmt->execute();

        return $stmt;
    }

    /**
     * Update cart item quantity
     */
    public function updateQuantity($cart_item_id, $quantity, $user_id) {
        if ($quantity <= 0) {
            return $this->removeFromCart($cart_item_id, $user_id);
        }

        $query = "UPDATE " . $this->table_name . " 
                  SET quantity = ?
                  WHERE item_id = ? AND user_id = ?";

        $stmt = $this->conn->prepare($query);
        $stmt->bindParam(1, $quantity);
        $stmt->bindParam(2, $cart_item_id);
        $stmt->bindParam(3, $user_id);

        return $stmt->execute();
    }

    /**
     * Remove item from cart
     */
    public function removeFromCart($cart_item_id, $user_id) {
        $query = "DELETE FROM " . $this->table_name . " 
                  WHERE item_id = ? AND user_id = ?";

        $stmt = $this->conn->prepare($query);
        $stmt->bindParam(1, $cart_item_id);
        $stmt->bindParam(2, $user_id);

        return $stmt->execute();
    }

    /**
     * Clear user's cart
     */
    public function clearCart($user_id) {
        $query = "DELETE FROM " . $this->table_name . " WHERE user_id = ?";
        $stmt = $this->conn->prepare($query);
        $stmt->bindParam(1, $user_id);

        return $stmt->execute();
    }

    /**
     * Get cart total for user
     */
    public function getCartTotal($user_id) {
        $query = "SELECT SUM(ci.quantity * ci.unit_price) as total
                  FROM " . $this->table_name . " ci
                  WHERE ci.user_id = ?";

        $stmt = $this->conn->prepare($query);
        $stmt->bindParam(1, $user_id);
        $stmt->execute();

        $row = $stmt->fetch(PDO::FETCH_ASSOC);
        return $row['total'] ?? 0;
    }

    /**
     * Get cart item count for user
     */
    public function getCartCount($user_id) {
        $query = "SELECT SUM(quantity) as total_items 
                  FROM " . $this->table_name . " 
                  WHERE user_id = ?";

        $stmt = $this->conn->prepare($query);
        $stmt->bindParam(1, $user_id);
        $stmt->execute();

        $row = $stmt->fetch(PDO::FETCH_ASSOC);
        return $row['total_items'] ?? 0;
    }

    /**
     * Check if product is already in cart
     */
    public function isInCart($user_id, $product_id) {
        $query = "SELECT item_id FROM " . $this->table_name . " 
                  WHERE user_id = ? AND product_id = ?";

        $stmt = $this->conn->prepare($query);
        $stmt->bindParam(1, $user_id);
        $stmt->bindParam(2, $product_id);
        $stmt->execute();

        return $stmt->rowCount() > 0;
    }

    /**
     * Session-based cart methods (for guest users)
     */

    /**
     * Add item to session cart
     */
    public static function addToSessionCart($product_id, $product_data, $quantity = 1) {
        if (!isset($_SESSION['cart'])) {
            $_SESSION['cart'] = [];
        }

        $cart = $_SESSION['cart'];
        $item_key = self::findItemInSessionCart($product_id, $cart);

        if ($item_key !== false) {
            // Update existing item
            $cart[$item_key]['quantity'] += $quantity;
        } else {
            // Add new item
            $cart_item = [
                'id' => $product_id,
                'product_id' => $product_id,
                'name' => $product_data['name'],
                'price' => $product_data['price'],
                'quantity' => $quantity,
                'icon' => $product_data['icon'] ?? Product::getProductIcon($product_data['name']),
                'image' => $product_data['image'] ?? '',
                'description' => $product_data['description'] ?? ''
            ];
            $cart[] = $cart_item;
        }

        $_SESSION['cart'] = $cart;
        return true;
    }

    /**
     * Get session cart items
     */
    public static function getSessionCart() {
        return $_SESSION['cart'] ?? [];
    }

    /**
     * Update session cart item quantity
     */
    public static function updateSessionCartQuantity($product_id, $quantity) {
        if (!isset($_SESSION['cart'])) {
            return false;
        }

        $cart = $_SESSION['cart'];
        $item_key = self::findItemInSessionCart($product_id, $cart);

        if ($item_key !== false) {
            if ($quantity <= 0) {
                unset($cart[$item_key]);
            } else {
                $cart[$item_key]['quantity'] = $quantity;
            }
            
            $_SESSION['cart'] = array_values($cart); // Reindex array
            return true;
        }

        return false;
    }

    /**
     * Remove item from session cart
     */
    public static function removeFromSessionCart($product_id) {
        if (!isset($_SESSION['cart'])) {
            return false;
        }

        $cart = $_SESSION['cart'];
        $item_key = self::findItemInSessionCart($product_id, $cart);

        if ($item_key !== false) {
            unset($cart[$item_key]);
            $_SESSION['cart'] = array_values($cart); // Reindex array
            return true;
        }

        return false;
    }

    /**
     * Clear session cart
     */
    public static function clearSessionCart() {
        $_SESSION['cart'] = [];
        return true;
    }

    /**
     * Get session cart total
     */
    public static function getSessionCartTotal() {
        if (!isset($_SESSION['cart'])) {
            return 0;
        }

        $total = 0;
        foreach ($_SESSION['cart'] as $item) {
            $total += $item['price'] * $item['quantity'];
        }

        return $total;
    }

    /**
     * Get session cart count
     */
    public static function getSessionCartCount() {
        if (!isset($_SESSION['cart'])) {
            return 0;
        }

        $count = 0;
        foreach ($_SESSION['cart'] as $item) {
            $count += $item['quantity'];
        }

        return $count;
    }

    /**
     * Helper method to find item in session cart
     */
    private static function findItemInSessionCart($product_id, $cart) {
        foreach ($cart as $key => $item) {
            if ($item['product_id'] == $product_id) {
                return $key;
            }
        }
        return false;
    }

    /**
     * Sync session cart to database when user logs in
     */
    public function syncSessionToDatabase($user_id) {
        if (!isset($_SESSION['cart']) || empty($_SESSION['cart'])) {
            return true;
        }

        try {
            $this->conn->beginTransaction();

            // Clear existing cart items for user
            $this->clearCart($user_id);

            // Add session cart items to database
            foreach ($_SESSION['cart'] as $item) {
                $this->addToCart($user_id, $item['product_id'], $item['quantity']);
            }

            // Clear session cart
            self::clearSessionCart();

            $this->conn->commit();
            return true;
        } catch (Exception $e) {
            $this->conn->rollBack();
            error_log("Error syncing cart to database: " . $e->getMessage());
            return false;
        }
    }
}
?>

--- File: models\Category.php ---
<?php
/**
 * Category Model
 * Handles all category-related database operations
 */

class Category {
    private $conn;
    private $table_name = "categories";

    // Category properties - UPDATED to match your SQL schema
    public $id;  // Changed from category_id
    public $name;
    public $description;
    public $created_at;

    public function __construct($db) {
        $this->conn = $db;
    }

    /**
     * Get all categories - UPDATED to match your SQL schema
     */
    public function getAllCategories() {
        try {
            $query = "SELECT 
                        id,           -- Changed from category_id
                        name, 
                        description,
                        created_at
                      FROM " . $this->table_name . " 
                      ORDER BY name ASC";

            $stmt = $this->conn->prepare($query);
            $stmt->execute();

            // Return array instead of PDOStatement
            return $stmt->fetchAll(PDO::FETCH_ASSOC);
            
        } catch (PDOException $e) {
            error_log("Error fetching categories: " . $e->getMessage());
            throw new Exception("Unable to fetch categories: " . $e->getMessage());
        }
    }

    /**
     * Get category by ID - UPDATED to match your SQL schema
     */
    public function getCategoryById($id) {
        try {
            $query = "SELECT 
                        id,           -- Changed from category_id
                        name, 
                        description,
                        created_at
                      FROM " . $this->table_name . " 
                      WHERE id = :id 
                      LIMIT 1";

            $stmt = $this->conn->prepare($query);
            $stmt->bindParam(':id', $id, PDO::PARAM_INT);
            $stmt->execute();

            if ($stmt->rowCount() > 0) {
                $row = $stmt->fetch(PDO::FETCH_ASSOC);
                return $row;
            }

            return null;
        } catch (PDOException $e) {
            error_log("Error fetching category by ID: " . $e->getMessage());
            throw new Exception("Unable to fetch category");
        }
    }

    /**
     * Get categories with product count - UPDATED to match your SQL schema
     */
    public function getCategoriesWithProductCount() {
        $query = "SELECT 
                c.id,
                c.name,
                c.description,
                COUNT(p.id) as product_count
              FROM categories c 
              LEFT JOIN products p ON c.id = p.category_id 
              GROUP BY c.id, c.name, c.description
              ORDER BY c.name";
    
        $stmt = $this->conn->prepare($query);
        $stmt->execute();
        return $stmt->fetchAll(PDO::FETCH_ASSOC);
    }

    /**
     * Create a new category - UPDATED to match your SQL schema
     */
    public function create() {
        try {
            $query = "INSERT INTO " . $this->table_name . " 
                      (name, description) 
                      VALUES 
                      (:name, :description)";

            $stmt = $this->conn->prepare($query);

            // Sanitize input
            $this->name = htmlspecialchars(strip_tags($this->name));
            $this->description = htmlspecialchars(strip_tags($this->description));

            // Bind parameters
            $stmt->bindParam(':name', $this->name);
            $stmt->bindParam(':description', $this->description);

            if ($stmt->execute()) {
                $this->id = $this->conn->lastInsertId();
                return true;
            }

            return false;
        } catch (PDOException $e) {
            error_log("Error creating category: " . $e->getMessage());
            throw new Exception("Unable to create category");
        }
    }

    /**
     * Update a category
     */
    public function update() {
        try {
            $query = "UPDATE " . $this->table_name . " 
                      SET 
                        name = :name,
                        description = :description
                      WHERE 
                        id = :id";

            $stmt = $this->conn->prepare($query);

            // Sanitize input
            $this->name = htmlspecialchars(strip_tags($this->name));
            $this->description = htmlspecialchars(strip_tags($this->description));

            // Bind parameters
            $stmt->bindParam(':name', $this->name);
            $stmt->bindParam(':description', $this->description);
            $stmt->bindParam(':id', $this->id, PDO::PARAM_INT);

            return $stmt->execute();
        } catch (PDOException $e) {
            error_log("Error updating category: " . $e->getMessage());
            throw new Exception("Unable to update category");
        }
    }

    /**
     * Delete a category - UPDATED to match your SQL schema
     */
    public function delete() {
        try {
            // First check if category has products
            $product_count = $this->getProductCount($this->id);
            if ($product_count > 0) {
                throw new Exception("Cannot delete category with existing products");
            }

            $query = "DELETE FROM " . $this->table_name . " 
                      WHERE id = :id";

            $stmt = $this->conn->prepare($query);
            $stmt->bindParam(':id', $this->id, PDO::PARAM_INT);

            return $stmt->execute();
        } catch (PDOException $e) {
            error_log("Error deleting category: " . $e->getMessage());
            throw new Exception("Unable to delete category");
        }
    }

    /**
     * Get product count for a category - UPDATED to match your SQL schema
     */
    private function getProductCount($category_id) {
        try {
            $query = "SELECT COUNT(*) as product_count 
                      FROM products 
                      WHERE category_id = :category_id";

            $stmt = $this->conn->prepare($query);
            $stmt->bindParam(':category_id', $category_id, PDO::PARAM_INT);
            $stmt->execute();

            $row = $stmt->fetch(PDO::FETCH_ASSOC);
            return $row['product_count'];
        } catch (PDOException $e) {
            error_log("Error getting product count: " . $e->getMessage());
            return 0;
        }
    }

    /**
     * Search categories by name - UPDATED to match your SQL schema
     */
    public function search($keywords) {
        try {
            $query = "SELECT 
                        id,           -- Changed from category_id
                        name, 
                        description,
                        created_at
                      FROM " . $this->table_name . " 
                      WHERE name LIKE :keywords OR description LIKE :keywords
                      ORDER BY name ASC";

            $stmt = $this->conn->prepare($query);
            $search_term = "%{$keywords}%";
            $stmt->bindParam(':keywords', $search_term);
            $stmt->execute();

            return $stmt->fetchAll(PDO::FETCH_ASSOC);
            
        } catch (PDOException $e) {
            error_log("Error searching categories: " . $e->getMessage());
            throw new Exception("Unable to search categories");
        }
    }

    /**
     * Get categories 
     */
    public function getCategoriesCount() {
        try {
            $query = "SELECT COUNT(*) as count FROM " . $this->table_name;
            $stmt = $this->conn->prepare($query);
            $stmt->execute();
            
            $result = $stmt->fetch(PDO::FETCH_ASSOC);
            return $result['count'] ?? 0;
            
        } catch (PDOException $e) {
            error_log("Database error in getCategoriesCount: " . $e->getMessage());
            return 0;
        }
    }

    /**
     * Check if categories table exists
     */
    public function checkTableExists() {
        try {
            $query = "SHOW TABLES LIKE '" . $this->table_name . "'";
            $stmt = $this->conn->prepare($query);
            $stmt->execute();
            
            return $stmt->rowCount() > 0;
            
        } catch (PDOException $e) {
            error_log("Error checking table existence: " . $e->getMessage());
            return false;
        }
    }

    /**
     * Check if category name already exists
     */
    public function categoryExists($name, $exclude_id = null) {
        try {
            $query = "SELECT id 
                      FROM " . $this->table_name . " 
                      WHERE name = :name";

            if ($exclude_id) {
                $query .= " AND id != :exclude_id";
            }

            $query .= " LIMIT 1";

            $stmt = $this->conn->prepare($query);
            $stmt->bindParam(':name', $name);

            if ($exclude_id) {
                $stmt->bindParam(':exclude_id', $exclude_id, PDO::PARAM_INT);
            }

            $stmt->execute();

            return $stmt->rowCount() > 0;
        } catch (PDOException $e) {
            error_log("Error checking category existence: " . $e->getMessage());
            return false;
        }
    }

    /**
     * Get category icon based on category name
     */
    public static function getCategoryIcon($category_name) {
        $icons = [
            'electronics' => 'fas fa-laptop',
            'fashion' => 'fas fa-tshirt',
            'home' => 'fas fa-home',
            'sports' => 'fas fa-football-ball',
            'books' => 'fas fa-book',
            'garden' => 'fas fa-seedling'
        ];

        $category_lower = strtolower($category_name);
        
        foreach ($icons as $key => $icon) {
            if (strpos($category_lower, $key) !== false) {
                return $icon;
            }
        }

        // Default icon
        return 'fas fa-tag';
    }

    /**
     * Get all categories for dropdown - Simple version
     */
    public function getCategoriesForDropdown() {
        $query = "SELECT id, name FROM categories ORDER BY name";
        $stmt = $this->conn->prepare($query);
        $stmt->execute();
        return $stmt->fetchAll(PDO::FETCH_ASSOC);
    }
}
?>

--- File: models\Order.php ---
<?php
/**
 * Order Model
 * Handles all order-related database operations
 */

class Order {
    private $conn;
    private $table_name = "orders";

    // Order properties
    public $id;
    public $user_id;
    public $total;
    public $status;
    public $created_at;

    public function __construct($db) {
        $this->conn = $db;
    }

    /**
     * Get all orders with user information
     */
    public function getAllOrdersWithUsers($status = '', $date_from = '', $date_to = '') {
        $query = "SELECT 
                o.id,
                o.total,
                o.status,
                o.created_at,
                u.user_id,
                u.full_name,
                u.email,
                u.username
              FROM orders o 
              JOIN users u ON o.user_id = u.user_id 
              WHERE 1=1";
    
        $params = [];
    
        if ($status) {
            $query .= " AND o.status = :status";
            $params[':status'] = $status;
        }
    
        if ($date_from) {
            $query .= " AND DATE(o.created_at) >= :date_from";
            $params[':date_from'] = $date_from;
        }
    
        if ($date_to) {
            $query .= " AND DATE(o.created_at) <= :date_to";
            $params[':date_to'] = $date_to;
        }
    
        $query .= " ORDER BY o.created_at DESC";
    
        $stmt = $this->conn->prepare($query);
        foreach ($params as $key => $value) {
            $stmt->bindValue($key, $value);
        }
    
        $stmt->execute();
        return $stmt->fetchAll(PDO::FETCH_ASSOC);
    }

    /**
     * Get order by ID with user details
     */
    public function getOrderById($order_id) {
        try {
            $query = "SELECT o.*, u.full_name, u.email, u.username 
                      FROM " . $this->table_name . " o 
                      LEFT JOIN users u ON o.user_id = u.user_id 
                      WHERE o.id = :order_id 
                      LIMIT 1";

            $stmt = $this->conn->prepare($query);
            $stmt->bindParam(':order_id', $order_id, PDO::PARAM_INT);
            $stmt->execute();

            if ($stmt->rowCount() > 0) {
                return $stmt->fetch(PDO::FETCH_ASSOC);
            }

            return null;
        } catch (PDOException $e) {
            error_log("Error fetching order by ID: " . $e->getMessage());
            return null;
        }
    }

    /**
     * Get orders by user ID
     */
    public function getOrdersByUserId($user_id) {
        try {
            $query = "SELECT 
                    id,
                    user_id, 
                    total, 
                    status, 
                    created_at
                  FROM " . $this->table_name . " 
                  WHERE user_id = :user_id 
                  ORDER BY created_at DESC";

            $stmt = $this->conn->prepare($query);
            $stmt->bindParam(':user_id', $user_id, PDO::PARAM_INT);
            $stmt->execute();

            $orders = $stmt->fetchAll(PDO::FETCH_ASSOC);
        
            // Add order_id field for compatibility with existing code
            foreach ($orders as &$order) {
                $order['order_id'] = 'SR-' . str_pad($order['id'], 6, '0', STR_PAD_LEFT);
            }
        
            return $orders;
        } catch (PDOException $e) {
            error_log("Error fetching user orders: " . $e->getMessage());
            return [];
        }
    }

    /**
        * Get user orders (alias for getOrdersByUserId for compatibility)
    */
    public function getUserOrders($user_id) {
        return $this->getOrdersByUserId($user_id);
    }

    /**
    * Get order by ID (alias for consistency)
    */
    public function findById($order_id) {
        return $this->getOrderById($order_id);
    }

    /**
    * Get all orders (alias for getAllOrdersWithUsers with no filters)
    */
    public function getAllOrders() {    
        return $this->getAllOrdersWithUsers();
    }

    /**
     * Get order items with product details
     */
    public function getOrderItems($order_id) {
        try {
            $query = "SELECT oi.*, p.name as product_name, p.image 
                      FROM order_items oi 
                      LEFT JOIN products p ON oi.product_id = p.id 
                      WHERE oi.order_id = :order_id";

            $stmt = $this->conn->prepare($query);
            $stmt->bindParam(':order_id', $order_id, PDO::PARAM_INT);
            $stmt->execute();

            return $stmt->fetchAll(PDO::FETCH_ASSOC);
        } catch (PDOException $e) {
            error_log("Error fetching order items: " . $e->getMessage());
            return [];
        }
    }

    /**
     * Create a new order
     */
    public function create() {
        try {
            $this->conn->beginTransaction();

            // Insert order
            $query = "INSERT INTO " . $this->table_name . " 
                      (user_id, total, status, created_at) 
                      VALUES 
                      (:user_id, :total, :status, NOW())";

            $stmt = $this->conn->prepare($query);
            $stmt->bindParam(':user_id', $this->user_id, PDO::PARAM_INT);
            $stmt->bindParam(':total', $this->total);
            $stmt->bindParam(':status', $this->status);

            if ($stmt->execute()) {
                $this->id = $this->conn->lastInsertId();
                $this->conn->commit();
                return true;
            }

            $this->conn->rollBack();
            return false;
        } catch (PDOException $e) {
            $this->conn->rollBack();
            error_log("Error creating order: " . $e->getMessage());
            return false;
        }
    }

    /**
     * Add item to order
     */
    public function addOrderItem($product_id, $quantity, $unit_price) {
        try {
            $query = "INSERT INTO order_items 
                      (order_id, product_id, quantity, unit_price) 
                      VALUES 
                      (:order_id, :product_id, :quantity, :unit_price)";

            $stmt = $this->conn->prepare($query);
            $stmt->bindParam(':order_id', $this->id, PDO::PARAM_INT);
            $stmt->bindParam(':product_id', $product_id, PDO::PARAM_INT);
            $stmt->bindParam(':quantity', $quantity, PDO::PARAM_INT);
            $stmt->bindParam(':unit_price', $unit_price);

            return $stmt->execute();
        } catch (PDOException $e) {
            error_log("Error adding order item: " . $e->getMessage());
            return false;
        }
    }

    /**
     * Update order status
     */
    public function updateOrderStatus($order_id, $status) {
        try {
            $query = "UPDATE " . $this->table_name . " 
                      SET status = :status 
                      WHERE id = :order_id";

            $stmt = $this->conn->prepare($query);
            $stmt->bindParam(':status', $status);
            $stmt->bindParam(':order_id', $order_id, PDO::PARAM_INT);

            return $stmt->execute();
        } catch (PDOException $e) {
            error_log("Error updating order status: " . $e->getMessage());
            return false;
        }
    }

    /**
     * Get orders count
     */
    public function getOrdersCount() {
        try {
            $query = "SELECT COUNT(*) as count FROM " . $this->table_name;
            $stmt = $this->conn->prepare($query);
            $stmt->execute();
            
            $result = $stmt->fetch(PDO::FETCH_ASSOC);
            return $result['count'] ?? 0;
            
        } catch (PDOException $e) {
            error_log("Error getting orders count: " . $e->getMessage());
            return 0;
        }
    }

    /**
     * Get recent orders
     */
    public function getRecentOrders($limit = 10) {
        $query = "SELECT 
                o.id,
                o.total,
                o.status,
                o.created_at,
                u.full_name
              FROM orders o 
              JOIN users u ON o.user_id = u.user_id 
              ORDER BY o.created_at DESC 
              LIMIT :limit";
    
        $stmt = $this->conn->prepare($query);
        $stmt->bindValue(':limit', (int)$limit, PDO::PARAM_INT);
        $stmt->execute();
        return $stmt->fetchAll(PDO::FETCH_ASSOC);
    }

    /**
     * Get total revenue
     */
    public function getTotalRevenue() {
        $query = "SELECT SUM(total) as revenue FROM orders WHERE status = 'completed'";
        $stmt = $this->conn->prepare($query);
        $stmt->execute();
        $result = $stmt->fetch(PDO::FETCH_ASSOC);
        return $result['revenue'] ?? 0;
    }

    /**
     * Get orders by status
     */
    public function getOrdersByStatus($status) {
        try {
            $query = "SELECT o.*, u.full_name, u.email 
                      FROM " . $this->table_name . " o 
                      LEFT JOIN users u ON o.user_id = u.user_id 
                      WHERE o.status = :status 
                      ORDER BY o.created_at DESC";

            $stmt = $this->conn->prepare($query);
            $stmt->bindParam(':status', $status);
            $stmt->execute();

            return $stmt->fetchAll(PDO::FETCH_ASSOC);
        } catch (PDOException $e) {
            error_log("Error fetching orders by status: " . $e->getMessage());
            return [];
        }
    }

    /**
     * Delete order (and associated items via cascade)
     */
    public function delete() {
        try {
            $query = "DELETE FROM " . $this->table_name . " 
                      WHERE id = :id";

            $stmt = $this->conn->prepare($query);
            $stmt->bindParam(':id', $this->id, PDO::PARAM_INT);

            return $stmt->execute();
        } catch (PDOException $e) {
            error_log("Error deleting order: " . $e->getMessage());
            return false;
        }
    }

    /**
     * Check if order belongs to user
     */
    public function belongsToUser($order_id, $user_id) {
        try {
            $query = "SELECT id FROM " . $this->table_name . " 
                      WHERE id = :order_id AND user_id = :user_id 
                      LIMIT 1";

            $stmt = $this->conn->prepare($query);
            $stmt->bindParam(':order_id', $order_id, PDO::PARAM_INT);
            $stmt->bindParam(':user_id', $user_id, PDO::PARAM_INT);
            $stmt->execute();

            return $stmt->rowCount() > 0;
        } catch (PDOException $e) {
            error_log("Error checking order ownership: " . $e->getMessage());
            return false;
        }
    }

    /**
     * Get monthly sales data for charts
     */
    public function getMonthlySales($year = null) {
        try {
            if ($year === null) {
                $year = date('Y');
            }

            $query = "SELECT 
                        MONTH(created_at) as month, 
                        COUNT(*) as order_count,
                        SUM(total) as revenue
                      FROM " . $this->table_name . " 
                      WHERE YEAR(created_at) = :year AND status = 'completed'
                      GROUP BY MONTH(created_at) 
                      ORDER BY month ASC";

            $stmt = $this->conn->prepare($query);
            $stmt->bindParam(':year', $year, PDO::PARAM_INT);
            $stmt->execute();

            return $stmt->fetchAll(PDO::FETCH_ASSOC);
        } catch (PDOException $e) {
            error_log("Error fetching monthly sales: " . $e->getMessage());
            return [];
        }
    }

}
?>

--- File: models\Product.php ---
<?php
// models/Product.php
class Product {
    private $conn;
    private $table_name = "products";

    public function __construct($db) {
        $this->conn = $db;
    }

    /**
     * Get all products - returns PDOStatement for use with fetch()
     */
    public function getAllProducts() {
        $query = "SELECT 
                    p.id as product_id,  // ALIAS id to product_id
                    p.name,
                    p.description, 
                    p.price,
                    p.stock_quantity,
                    p.rating,
                    c.id as category_id,  // ALIAS id to category_id
                    c.name as category_name  // ALIAS name to category_name
                FROM products p 
                LEFT JOIN categories c ON p.category_id = c.id";
    
        $stmt = $this->conn->prepare($query);
        $stmt->execute();
        return $stmt;
    }

    /**
     * Search products - returns PDOStatement
     */
    public function searchProducts($keywords, $category_id = null) {
        $query = "SELECT 
                p.id as product_id,
                p.name,
                p.description,
                p.price,
                p.stock_quantity,
                p.rating,
                p.image,
                c.name as category_name
              FROM products p 
              LEFT JOIN categories c ON p.category_id = c.id 
              WHERE (p.name LIKE :keywords OR p.description LIKE :keywords)";
    
        if ($category_id) {
            $query .= " AND p.category_id = :category_id";
        }
    
        $query .= " ORDER BY p.name";
    
        $stmt = $this->conn->prepare($query);
        $searchTerm = "%$keywords%";
        $stmt->bindParam(':keywords', $searchTerm);
    
        if ($category_id) {
            $stmt->bindParam(':category_id', $category_id);
        }
    
        $stmt->execute();
        return $stmt->fetchAll(PDO::FETCH_ASSOC);
    }

    /**
    * Get product by ID
    */
    public function getProductById($product_id) {
        try {
            $query = "SELECT * FROM products WHERE id = :id LIMIT 1";
            $stmt = $this->conn->prepare($query);
            $stmt->bindParam(':id', $product_id, PDO::PARAM_INT);
            $stmt->execute();

            if ($stmt->rowCount() > 0) {
            return $stmt->fetch(PDO::FETCH_ASSOC);
            }
            return null;
        } catch (PDOException $e) {
            error_log("Error fetching product by ID: " . $e->getMessage());
            return null;
        }
    }

    /**
     * Get products by category - returns PDOStatement
     */
    public function getProductsByCategory($category_id) {
        $query = "SELECT 
                p.id as product_id,
                p.name,
                p.description,
                p.price,
                p.stock_quantity,
                p.rating,
                p.image,
                c.name as category_name
              FROM products p 
              LEFT JOIN categories c ON p.category_id = c.id 
              WHERE p.category_id = :category_id
              ORDER BY p.name";
    
        $stmt = $this->conn->prepare($query);
        $stmt->bindParam(':category_id', $category_id);
        $stmt->execute();
        return $stmt->fetchAll(PDO::FETCH_ASSOC);
    }

    /**
     * Get total number of products
     * @return int
     */
    public function getProductsCount() {
        try {
            $query = "SELECT COUNT(*) as total FROM " . $this->table_name;
            $stmt = $this->conn->prepare($query);
            $stmt->execute();
            
            $result = $stmt->fetch(PDO::FETCH_ASSOC);
            return $result['total'] ?? 0;
        } catch (Exception $e) {
            error_log("Error getting products count: " . $e->getMessage());
            return 0;
        }
    }

    /**
    * Get all products with category information for admin dashboard
    * @return array
    */
    public function getAllProductsWithCategory() {
        $query = "SELECT 
                p.id as product_id,
                p.name,
                p.description,
                p.price,
                p.stock_quantity,
                p.rating,
                p.image,
                p.created_at,
                c.id as category_id,
                c.name as category_name
              FROM products p 
              LEFT JOIN categories c ON p.category_id = c.id 
              ORDER BY p.created_at DESC";
    
        $stmt = $this->conn->prepare($query);
        $stmt->execute();
        return $stmt->fetchAll(PDO::FETCH_ASSOC);
    }
    
    /**
     * Get current stock quantity for a product
     */
    public function reduceStock($product_id, $quantity) {
        $query = "UPDATE products 
              SET stock_quantity = stock_quantity - :qty 
              WHERE product_id = :id AND stock_quantity >= :qty";

        $stmt = $this->conn->prepare($query);
        $stmt->bindParam(':qty', $quantity);
        $stmt->bindParam(':id', $product_id);

        return $stmt->execute();
    }

    /**
     * Get product icon based on name or category
     */
    public static function getProductIcon($productName) {
        $name = strtolower($productName);
    
        if (strpos($name, 'phone') !== false) return 'fas fa-mobile-alt';
        if (strpos($name, 'laptop') !== false || strpos($name, 'computer') !== false) return 'fas fa-laptop';
        if (strpos($name, 'headphone') !== false) return 'fas fa-headphones';
        if (strpos($name, 'watch') !== false) return 'fas fa-clock';
        if (strpos($name, 'camera') !== false) return 'fas fa-camera';
        if (strpos($name, 'game') !== false) return 'fas fa-gamepad';
        if (strpos($name, 'shoe') !== false) return 'fas fa-shoe-prints';
        if (strpos($name, 'bag') !== false || strpos($name, 'backpack') !== false) return 'fas fa-briefcase';
        if (strpos($name, 'speaker') !== false) return 'fas fa-volume-up';
        if (strpos($name, 'mouse') !== false) return 'fas fa-mouse';
        if (strpos($name, 'hub') !== false || strpos($name, 'plug') !== false) return 'fas fa-plug';
        if (strpos($name, 'shirt') !== false || strpos($name, 'clothing') !== false) return 'fas fa-tshirt';
        if (strpos($name, 'book') !== false) return 'fas fa-book';
        if (strpos($name, 'sport') !== false) return 'fas fa-football-ball';
        if (strpos($name, 'garden') !== false) return 'fas fa-leaf';
    
        return 'fas fa-box'; // Default icon
    }
}
?>

--- File: models\User.php ---
<?php
/**
 * User Model with Authentication
 */

class User {
    private $conn;
    private $table_name = "users";
    
    // Password requirements
    private $min_password_length = 8;
    private $max_login_attempts = 5;
    private $lockout_duration = 900; // 15 minutes

    public function __construct($db) {
        $this->conn = $db;
    }

    /**
     * Create new user
     */
    public function createUser($data) {
        $query = "INSERT INTO users (username, email, password_hash, full_name, role_id) 
              VALUES (:username, :email, :password_hash, :full_name, :role_id)";
    
        $stmt = $this->conn->prepare($query);
    
        // Hash password
        $password_hash = password_hash($data['password'], PASSWORD_DEFAULT);
    
        $stmt->bindParam(":username", $data['username']);
        $stmt->bindParam(":email", $data['email']);
        $stmt->bindParam(":password_hash", $password_hash);
        $stmt->bindParam(":full_name", $data['full_name']);
        $stmt->bindParam(":role_id", $data['role_id']);
    
        return $stmt->execute() ? $this->conn->lastInsertId() : false;
    }

    /**
     * Authenticate user
     */
    public function authenticate($username, $password) {
        $query = "SELECT u.*, r.role_name 
              FROM users u 
              JOIN roles r ON u.role_id = r.role_id 
              WHERE (u.username = :username OR u.email = :username) 
              AND u.is_active = TRUE";
    
        $stmt = $this->conn->prepare($query);
        $stmt->bindParam(':username', $username);
        $stmt->execute();
    
        $user = $stmt->fetch(PDO::FETCH_ASSOC);
    
        if ($user && password_verify($password, $user['password_hash'])) {
            return $user;
        }
    
        throw new Exception('Invalid username or password');
    }

    /**
     * Check if username exists
     */
    public function usernameExists($username) {
        $query = "SELECT user_id FROM " . $this->table_name . " 
                 WHERE username = :username";
        
        $stmt = $this->conn->prepare($query);
        $stmt->bindValue(':username', $username);
        $stmt->execute();
        
        return $stmt->rowCount() > 0;
    }

    /**
     * Check if email exists
     */
    public function emailExists($email) {
        $query = "SELECT user_id FROM " . $this->table_name . " 
                 WHERE email = :email";
        
        $stmt = $this->conn->prepare($query);
        $stmt->bindValue(':email', $email);
        $stmt->execute();
        
        return $stmt->rowCount() > 0;
    }

    /**
     * Validate user data
     */
    private function validateUserData($data) {
        // Validate username
        if (!preg_match('/^[a-zA-Z0-9_]{3,50}$/', $data['username'])) {
            throw new Exception('Username must be 3-50 characters and contain only letters, numbers, and underscores');
        }

        // Validate email
        if (!filter_var($data['email'], FILTER_VALIDATE_EMAIL)) {
            throw new Exception('Invalid email address');
        }

        // Validate password strength
        if (!$this->validatePassword($data['password'])) {
            throw new Exception('Password must be at least 8 characters long and contain at least one letter and one number');
        }

        // Validate full name
        if (strlen(trim($data['full_name'])) < 2) {
            throw new Exception('Full name must be at least 2 characters long');
        }

        return true;
    }

    /**
     * Validate password strength
     */
    private function validatePassword($password) {
        if (strlen($password) < $this->min_password_length) {
            return false;
        }

        // Check for at least one letter and one number
        if (!preg_match('/[A-Za-z]/', $password) || !preg_match('/[0-9]/', $password)) {
            return false;
        }

        return true;
    }

    /**
     * Record login attempt
     */
    private function recordLoginAttempt($username, $success) {
        $query = "INSERT INTO login_attempts (ip_address, username, success) 
                 VALUES (:ip_address, :username, :success)";
        
        $stmt = $this->conn->prepare($query);
        $stmt->bindValue(':ip_address', $_SERVER['REMOTE_ADDR']);
        $stmt->bindValue(':username', $username);
        $stmt->bindValue(':success', $success);
        $stmt->execute();
    }

    /**
     * Check if account is locked out
     */
    public function isLockedOut($username) {
        $query = "SELECT COUNT(*) as attempt_count 
                FROM login_attempts 
                WHERE username = :username 
                AND attempted_at > DATE_SUB(NOW(), INTERVAL :lockout_duration SECOND)
                AND success = FALSE";
    
        $stmt = $this->conn->prepare($query);
        $stmt->bindValue(':username', $username);
        $stmt->bindValue(':lockout_duration', $this->lockout_duration);
        $stmt->execute();
    
        $result = $stmt->fetch(PDO::FETCH_ASSOC);
        return $result['attempt_count'] >= $this->max_login_attempts;
    }

    /**
     * Update last login timestamp
     */
    public function updateLastLogin($user_id) {
        $query = "UPDATE " . $this->table_name . " 
                SET last_login = NOW() 
                WHERE user_id = :user_id";
    
        $stmt = $this->conn->prepare($query);
        $stmt->bindValue(':user_id', $user_id);
        return $stmt->execute();
    }

    /**
    * Store remember me token (optional - for persistent sessions)
    */
    public function storeRememberToken($user_id, $token, $expires) {
        // First, clear any existing tokens for this user
        $clear_query = "DELETE FROM remember_tokens WHERE user_id = :user_id";
        $clear_stmt = $this->conn->prepare($clear_query);
        $clear_stmt->bindValue(':user_id', $user_id);
        $clear_stmt->execute();
    
        // Insert new token
        $query = "INSERT INTO remember_tokens (user_id, token, expires_at) 
                VALUES (:user_id, :token, FROM_UNIXTIME(:expires))";
    
        $stmt = $this->conn->prepare($query);
        $stmt->bindValue(':user_id', $user_id);
        $stmt->bindValue(':token', password_hash($token, PASSWORD_DEFAULT));
        $stmt->bindValue(':expires', $expires);
        return $stmt->execute();
    }

    /**
     * Update password hash
     */
    private function updatePasswordHash($user_id, $password) {
        $new_hash = password_hash($password, PASSWORD_DEFAULT);
        
        $query = "UPDATE " . $this->table_name . " 
                 SET password_hash = :password_hash 
                 WHERE user_id = :user_id";
        
        $stmt = $this->conn->prepare($query);
        $stmt->bindValue(':password_hash', $new_hash);
        $stmt->bindValue(':user_id', $user_id);
        $stmt->execute();
    }

    /**
    * Validate remember me token (optional)
    */
    public function validateRememberToken($token) {
        $query = "SELECT rt.*, u.user_id, u.username, u.email, u.full_name, u.role_id 
                FROM remember_tokens rt 
                JOIN users u ON rt.user_id = u.user_id 
                WHERE rt.token = :token 
                AND rt.expires_at > NOW() 
                AND u.is_active = TRUE";
    
        $stmt = $this->conn->prepare($query);
        $stmt->bindValue(':token', $token);
        $stmt->execute();
    
        if ($stmt->rowCount() === 1) {
            $data = $stmt->fetch(PDO::FETCH_ASSOC);
        
            // Verify token (you might want to use hash_equals for timing attack protection)
            if (password_verify($token, $data['token'])) {
                return [
                    'user_id' => $data['user_id'],
                    'username' => $data['username'],
                    'email' => $data['email'],
                    'full_name' => $data['full_name'],
                    'role_id' => $data['role_id']
                ];
            }
        }
    
        return false;
    }

    /**
     * Get user by ID
     */
    public function getUserById($user_id) {
        $query = "SELECT u.*, r.role_name 
                 FROM " . $this->table_name . " u 
                 JOIN roles r ON u.role_id = r.role_id 
                 WHERE u.user_id = :user_id";
        
        $stmt = $this->conn->prepare($query);
        $stmt->bindValue(':user_id', $user_id);
        $stmt->execute();
        
        return $stmt->fetch(PDO::FETCH_ASSOC);
    }

    /**
     * Change user password
     */
    public function changePassword($user_id, $current_password, $new_password) {
        try {
            // Get current password hash
            $query = "SELECT password_hash FROM " . $this->table_name . " 
                     WHERE user_id = :user_id";
            
            $stmt = $this->conn->prepare($query);
            $stmt->bindValue(':user_id', $user_id);
            $stmt->execute();
            
            $user = $stmt->fetch(PDO::FETCH_ASSOC);
            
            if (!password_verify($current_password, $user['password_hash'])) {
                throw new Exception('Current password is incorrect');
            }

            // Validate new password
            if (!$this->validatePassword($new_password)) {
                throw new Exception('New password does not meet requirements');
            }

            // Update password
            $new_hash = password_hash($new_password, PASSWORD_DEFAULT);
            
            $update_query = "UPDATE " . $this->table_name . " 
                           SET password_hash = :password_hash 
                           WHERE user_id = :user_id";
            
            $update_stmt = $this->conn->prepare($update_query);
            $update_stmt->bindValue(':password_hash', $new_hash);
            $update_stmt->bindValue(':user_id', $user_id);
            
            return $update_stmt->execute();

        } catch (Exception $e) {
            error_log("Change password error: " . $e->getMessage());
            throw $e;
        }
    }

    /**
     * Get total number of customers
     */
    public function getTotalCustomers() {
        $query = "SELECT COUNT(*) as total FROM users u 
              JOIN roles r ON u.role_id = r.role_id 
              WHERE r.role_name = 'customer'";
        $stmt = $this->conn->prepare($query);
        $stmt->execute();
        $result = $stmt->fetch(PDO::FETCH_ASSOC);
        return $result['total'] ?? 0;
    }

    public function getUsersCount() {
        try {
            $query = "SELECT COUNT(*) as count FROM users";
            $stmt = $this->conn->prepare($query);
            $stmt->execute();
            $result = $stmt->fetch(PDO::FETCH_ASSOC);
            return $result['count'] ?? 0;
        } catch (PDOException $e) {
            error_log("Error getting users count: " . $e->getMessage());
            return 0;
        }
    }
}
?>

--- File: README.md ---


--- File: register.php ---
<?php
/**
 * Customer Registration View
 * Displays the registration form for new customers with role selection
 */
session_start();

require_once 'config/config.php';
require_once 'config/database.php';
require_once 'utils/Auth.php';

// Redirect if already logged in
if (Auth::isLoggedIn()) {
    header('Location: /dashboard.php');
    exit();
}

// Generate CSRF token
$csrf_token = Auth::generateCSRFToken();

// Get form data from session if available (for form repopulation after errors)
$form_data = [
    'full_name' => $_SESSION['form_data']['full_name'] ?? '',
    'email' => $_SESSION['form_data']['email'] ?? '',
    'username' => $_SESSION['form_data']['username'] ?? '',
    'role' => $_SESSION['form_data']['role'] ?? 'customer' // New: role selection
];

// Clear form data from session after use
unset($_SESSION['form_data']);
?>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registration - <?php echo SITE_NAME; ?></title>
    <link rel="stylesheet" href="assets/css/auth.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <div class="left-panel">
            <div class="logo">
                <i class="fas fa-store"></i>
                <?php echo SITE_NAME; ?>
            </div>
            <h1>Create your account</h1>
            <p>Join our platform and choose the right account type for your needs.</p>
            <ul class="features">
                <li><i class="fas fa-check"></i> Fast and secure checkout</li>
                <li><i class="fas fa-check"></i> Personalized recommendations</li>
                <li><i class="fas fa-check"></i> Order tracking and history</li>
                <li><i class="fas fa-check"></i> Exclusive member discounts</li>
            </ul>
        </div>
        
        <div class="right-panel">
            <h2 style="text-align: center; margin-bottom: 1rem; color: #1f2937;">Create Your Account</h2>
            
            <!-- Display error/success messages -->
            <?php if (isset($_SESSION['error_message'])): ?>
                <div class="alert alert-error">
                    <?php echo htmlspecialchars($_SESSION['error_message']); ?>
                    <?php unset($_SESSION['error_message']); ?>
                </div>
            <?php endif; ?>

            <?php if (isset($_SESSION['success_message'])): ?>
                <div class="alert alert-success">
                    <?php echo htmlspecialchars($_SESSION['success_message']); ?>
                    <?php unset($_SESSION['success_message']); ?>
                </div>
            <?php endif; ?>

            <form id="registrationForm" method="POST" novalidate>
                <input type="hidden" name="csrf_token" value="<?php echo $csrf_token; ?>">
    <input type="hidden" name="role" id="roleInput" value="<?php echo $form_data['role']; ?>">

                <!-- Role Selection - Same as login page -->
                <div class="login-type-selector">
                    <button type="button" class="login-type-btn customer <?php echo $form_data['role'] === 'customer' ? 'active' : ''; ?>" 
                            onclick="selectRole('customer')">
                        <i class="fas fa-user login-type-icon"></i>
                        Customer
                    </button>
                    <button type="button" class="login-type-btn staff <?php echo $form_data['role'] === 'staff' ? 'active' : ''; ?>" 
                            onclick="selectRole('staff')">
                        <i class="fas fa-user-tie login-type-icon"></i>
                        Staff
                    </button>
                    <button type="button" class="login-type-btn admin <?php echo $form_data['role'] === 'admin' ? 'active' : ''; ?>" 
                            onclick="selectRole('admin')">
                        <i class="fas fa-user-shield login-type-icon"></i>
                        Admin
                    </button>
                </div>

                <p class="role-hint" id="roleHint">
                    <?php 
                    $role_hints = [
                        'customer' => 'Create a customer account to shop and manage orders',
                        'staff' => 'Create a staff account to manage store operations',
                        'admin' => 'Create an admin account for full system access'
                    ];
                    echo $role_hints[$form_data['role']] ?? $role_hints['customer'];
                    ?>
                </p>

                <div class="form-group">
                    <label class="form-label" for="full_name">Full Name *</label>
                    <input type="text" id="full_name" name="full_name" class="form-input" 
                           value="<?php echo htmlspecialchars($form_data['full_name']); ?>" required>
                    <div class="error-message" id="full_name_error">Please enter your full name</div>
                </div>

                <div class="form-group">
                    <label class="form-label" for="email">Email Address *</label>
                    <input type="email" id="email" name="email" class="form-input" 
                           value="<?php echo htmlspecialchars($form_data['email']); ?>" required>
                    <div class="error-message" id="email_error">Please enter a valid email address</div>
                </div>

                <div class="form-group">
                    <label class="form-label" for="username">Username *</label>
                    <input type="text" id="username" name="username" class="form-input" 
                           value="<?php echo htmlspecialchars($form_data['username']); ?>" required>
                    <div class="error-message" id="username_error">Please enter a username (3-50 characters, letters, numbers, and underscores only)</div>
                </div>

                <div class="form-group">
                    <label class="form-label" for="password">Password *</label>
                    <div class="password-toggle">
                        <input type="password" id="password" name="password" class="form-input" required minlength="8">
                        <button type="button" class="toggle-btn" onclick="togglePassword('password')">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                    <div class="error-message" id="password_error">Password must be at least 8 characters long and contain at least one letter and one number</div>
                </div>

                <div class="form-group">
                    <label class="form-label" for="confirm_password">Confirm Password *</label>
                    <div class="password-toggle">
                        <input type="password" id="confirm_password" name="confirm_password" class="form-input" required>
                        <button type="button" class="toggle-btn" onclick="togglePassword('confirm_password')">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                    <div class="error-message" id="confirm_password_error">Passwords do not match</div>
                </div>

                <button type="submit" class="btn-submit" id="submitBtn">
                    <span id="btnText">
                        <?php 
                        $button_texts = [
                            'customer' => 'Create Customer Account',
                            'staff' => 'Create Staff Account', 
                            'admin' => 'Create Admin Account'
                        ];
                        echo $button_texts[$form_data['role']] ?? $button_texts['customer'];
                        ?>
                    </span>
                    <div id="btnSpinner" class="loading-spinner" style="display: none;"></div>
                </button>
            </form>

            <div class="login-link">
                <p>Already have an account? <a href="login.php">Sign in here</a></p>
            </div>

            <!-- Back to Home in right panel (mobile friendly) -->
            <div class="back-to-home">
                <a href="<?php echo BASE_PATH; ?>/index.php">
                    <i class="fas fa-arrow-left"></i>
                    Back to Home Page
                </a>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="assets/js/auth.js"></script>
</body>
</html>

--- File: sql\sample.sql ---
USE smartretail_db;

/* 1 Insert roles */
INSERT INTO roles (role_name, description) VALUES
('admin', 'Administrator with full system access'),
('customer', 'Regular customer'),
('staff', 'Store staff with limited admin access');

/* 2 Insert test users */
INSERT INTO users (username, email, password_hash, full_name, role_id, is_active) VALUES
(
    'admin', 
    'admin@smartretail.com', 
    '$2y$10$2SxC6X8KiwiEVLZERSm7D.yKWtYQOlfxwYosXbjLhM8pdO5WKyKIu', -- password: admin123
    'System Administrator', 
    (SELECT role_id FROM roles WHERE role_name = 'admin'), 
    TRUE
),
(
    'customer', 
    'customer@smartretail.com', 
    '$2y$10$BPO3vi9y2dnYQpuDPLX1N.ym.QO5Z5G4ZMNWPMt6PlfRvVLC5W//6', -- password: customer123
    'John Customer', 
    (SELECT role_id FROM roles WHERE role_name = 'customer'), 
    TRUE
),
(
    'staff', 
    'staff@smartretail.com', 
    '$2y$10$bCjfSr.kMbK.byVf6qMNVupv3vPlJeHLk05YP4f0/1GXzSrDJSbtC', -- password: staff123
    'Jane Staff', 
    (SELECT role_id FROM roles WHERE role_name = 'staff'), 
    TRUE
);

/* 3 Insert categories */
INSERT INTO categories (name, description) VALUES
('Books & Media', 'Books, movies, music, and educational media.'),
('Electronics', 'Smart devices, gadgets, and electronic accessories.'),
('Fashion', 'Clothing, shoes, and accessories for all styles.'),
('Home & Garden', 'Furniture, decor, and outdoor equipment.'),
('Sports & Outdoors', 'Sports gear and outdoor adventure items.');

/* 4 Insert sample products */
-- Books & Media
INSERT INTO products (name, description, price, image, category_id, stock_quantity, rating)
VALUES
('The Great Gatsby', 'Classic novel by F. Scott Fitzgerald.', 14.99, 'images/gatsby.jpg', 1, 50, 4.8),
('Noise-Cancelling Headphones Guide', 'A comprehensive guide to top headphone technologies.', 9.99, 'images/headphone_guide.jpg', 1, 30, 4.6),
('Vinyl Record – The Beatles: Abbey Road', 'Limited edition remastered vinyl record.', 29.99, 'images/abbey_road.jpg', 1, 20, 4.9);

-- Electronics
INSERT INTO products (name, description, price, image, category_id, stock_quantity, rating)
VALUES
('Smartphone X200', '6.5-inch AMOLED display, 128GB storage, 5G ready.', 699.00, 'images/smartphone_x200.jpg', 2, 40, 4.7),
('Wireless Earbuds Pro', 'Noise-cancelling Bluetooth earbuds with long battery life.', 129.99, 'images/earbuds_pro.jpg', 2, 80, 4.5),
('4K Smart TV 55"', 'Ultra HD television with streaming apps built-in.', 549.99, 'images/4k_tv.jpg', 2, 25, 4.8),
('Gaming Laptop G15', 'High-performance laptop with RTX graphics.', 1199.00, 'images/gaming_laptop_g15.jpg', 2, 15, 4.6),
('Portable Power Bank 20000mAh', 'Fast-charging USB-C power bank for all devices.', 39.99, 'images/powerbank_20k.jpg', 2, 100, 4.4);

-- Fashion
INSERT INTO products (name, description, price, image, category_id, stock_quantity, rating)
VALUES
('Men''s Denim Jacket', 'Classic blue denim jacket for casual wear.', 59.99, 'images/denim_jacket.jpg', 3, 45, 4.5),
('Women''s Leather Handbag', 'Stylish brown leather handbag with compartments.', 79.99, 'images/leather_handbag.jpg', 3, 30, 4.7);

-- Home & Garden
INSERT INTO products (name, description, price, image, category_id, stock_quantity, rating)
VALUES
('LED Table Lamp', 'Adjustable brightness lamp for study or bedroom.', 34.99, 'images/table_lamp.jpg', 4, 60, 4.6),
('Wooden Coffee Table', 'Modern minimalist coffee table made from oak wood.', 199.99, 'images/coffee_table.jpg', 4, 15, 4.8),
('Cotton Bed Sheet Set', 'Soft, breathable 4-piece bed sheet set.', 49.99, 'images/bed_sheets.jpg', 4, 70, 4.5),
('Ceramic Flower Pot', 'Elegant ceramic pot for indoor plants.', 24.99, 'images/flower_pot.jpg', 4, 40, 4.3),
('Outdoor Garden Chair', 'Weather-resistant chair for patios and gardens.', 89.99, 'images/garden_chair.jpg', 4, 25, 4.7);

-- Sports & Outdoors
INSERT INTO products (name, description, price, image, category_id, stock_quantity, rating)
VALUES
('Mountain Bike XTR', 'Durable mountain bike with 21-speed gear system.', 499.99, 'images/mountain_bike.jpg', 5, 10, 4.9),
('Yoga Mat Pro', 'Non-slip, eco-friendly yoga mat for all exercises.', 29.99, 'images/yoga_mat.jpg', 5, 60, 4.6),
('Camping Tent 4-Person', 'Waterproof and lightweight tent for outdoor adventures.', 149.99, 'images/camping_tent.jpg', 5, 20, 4.8);

/* 5 Insert sample orders - ALL THREE ORDERS */
INSERT INTO orders (user_id, total, status, created_at) VALUES
(
    (SELECT user_id FROM users WHERE username = 'customer'),
    888.98,
    'completed',
    DATE_SUB(NOW(), INTERVAL 5 DAY)
),
(
    (SELECT user_id FROM users WHERE username = 'customer'),
    314.97,
    'completed', 
    DATE_SUB(NOW(), INTERVAL 2 DAY)
),
(
    (SELECT user_id FROM users WHERE username = 'customer'),
    14.99,
    'pending',
    DATE_SUB(NOW(), INTERVAL 1 DAY)
);

/* 6 Insert sample order items - AFTER ALL ORDERS EXIST */
INSERT INTO order_items (order_id, product_id, quantity, unit_price) VALUES
-- Order 1: Electronics + Fashion
(1, 4, 1, 699.00),   -- Smartphone X200
(1, 5, 1, 129.99),   -- Wireless Earbuds Pro
(1, 9, 1, 59.99),    -- Men's Denim Jacket

-- Order 2: Home & Garden
(2, 12, 1, 199.99),  -- Wooden Coffee Table
(2, 14, 1, 24.99),   -- Ceramic Flower Pot
(2, 15, 1, 89.99),   -- Outdoor Garden Chair

-- Order 3: Books
(3, 1, 1, 14.99);    -- The Great Gatsby

/* 7 Verification queries (optional) */
-- Verify orders
SELECT 'Orders verification:' AS '';
SELECT o.id, o.total, o.status, u.username 
FROM orders o 
JOIN users u ON o.user_id = u.user_id 
ORDER BY o.id;

-- Verify order items
SELECT 'Order items verification:' AS '';
SELECT oi.order_id, p.name, oi.quantity, oi.unit_price 
FROM order_items oi 
JOIN products p ON oi.product_id = p.id 
ORDER BY oi.order_id, oi.item_id;

--- File: sql\schema.sql ---
-- Create the database
CREATE DATABASE IF NOT EXISTS smartretail_db;
USE smartretail_db;

-- 1️⃣ Roles Table
CREATE TABLE roles (
    role_id INT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
    role_name VARCHAR(50) UNIQUE NOT NULL,
    description TEXT
);

-- 2️⃣ Users Table
CREATE TABLE users (
    user_id INT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(50) UNIQUE NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    full_name VARCHAR(100) NOT NULL,
    role_id INT UNSIGNED,
    is_active BOOLEAN DEFAULT TRUE,
    last_login DATETIME,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (role_id) REFERENCES roles(role_id)
        ON DELETE SET NULL
        ON UPDATE CASCADE
);

-- =======================
-- 3️⃣ Categories Table (NEW)
-- =======================
CREATE TABLE categories (
    id INT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(255) NOT NULL UNIQUE,
    description TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- =======================
-- 4️⃣ Products Table (UPDATED with category_id)
-- =======================
CREATE TABLE products (
    id INT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    description TEXT,
    price DECIMAL(10,2) NOT NULL,
    image VARCHAR(255),
    category_id INT UNSIGNED,
    stock_quantity INT DEFAULT 0,
    rating DECIMAL(3,2) DEFAULT 0.00,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (category_id) REFERENCES categories(id)
        ON DELETE SET NULL
        ON UPDATE CASCADE
);

-- =======================
-- 5️⃣ Cart Items Table
-- =======================
CREATE TABLE cart_items (
    item_id INT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    user_id INT UNSIGNED NOT NULL,
    product_id INT UNSIGNED NOT NULL,
    quantity INT NOT NULL DEFAULT 1,
    unit_price DECIMAL(10,2) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(user_id)
        ON DELETE CASCADE
        ON UPDATE CASCADE,
    FOREIGN KEY (product_id) REFERENCES products(id)
        ON DELETE CASCADE
        ON UPDATE CASCADE,
    UNIQUE KEY unique_user_product (user_id, product_id)
);

-- =======================
-- 6️⃣ Orders Table
-- =======================
CREATE TABLE orders (
    id INT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    user_id INT UNSIGNED NOT NULL,
    total DECIMAL(10,2) NOT NULL,
    status ENUM('pending', 'completed', 'cancelled') DEFAULT 'pending',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(user_id)
        ON DELETE CASCADE
        ON UPDATE CASCADE
);

-- =======================
-- 7️⃣ Order Items Table
-- =======================
CREATE TABLE order_items (
    item_id INT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    order_id INT UNSIGNED NOT NULL,
    product_id INT UNSIGNED NOT NULL,
    quantity INT NOT NULL,
    unit_price DECIMAL(10,2) NOT NULL,
    FOREIGN KEY (order_id) REFERENCES orders(id)
        ON DELETE CASCADE
        ON UPDATE CASCADE,
    FOREIGN KEY (product_id) REFERENCES products(id)
        ON DELETE CASCADE
        ON UPDATE CASCADE
);

-- =======================
-- 8️⃣ Password Reset Tokens
-- =======================
CREATE TABLE password_reset_tokens (
    token_id INT PRIMARY KEY AUTO_INCREMENT,
    user_id INT UNSIGNED NOT NULL,
    token VARCHAR(100) UNIQUE NOT NULL,
    expires_at DATETIME NOT NULL,
    used BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(user_id)
        ON DELETE CASCADE
);

-- =======================
-- 9️⃣ Login Attempts
-- =======================
CREATE TABLE login_attempts (
    attempt_id INT PRIMARY KEY AUTO_INCREMENT,
    ip_address VARCHAR(45) NOT NULL,
    username VARCHAR(50) NOT NULL,
    attempted_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    success BOOLEAN DEFAULT FALSE
);

-- =======================
-- 🔟 Remember Tokens
-- =======================
CREATE TABLE remember_tokens (
    token_id INT PRIMARY KEY AUTO_INCREMENT,
    user_id INT UNSIGNED NOT NULL,
    token VARCHAR(255) NOT NULL,
    expires_at DATETIME NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(user_id)
        ON DELETE CASCADE,
    INDEX idx_token (token),
    INDEX idx_expires (expires_at)
);


--- File: utils\Auth.php ---
<?php
/**
 * Authentication Utility Class
 * Handles user authentication, session management, and security
 */

class Auth {
    private static $session_timeout = 3600; // 1 hour
    
    /**
     * Start secure session
     */
    public static function startSession() {
        if (session_status() === PHP_SESSION_NONE) {
            // Secure session configuration
            ini_set('session.cookie_httponly', 1);
            ini_set('session.cookie_secure', 1);
            ini_set('session.use_strict_mode', 1);
            ini_set('session.cookie_samesite', 'Strict');
            
            session_start();
            
            // Regenerate session ID periodically
            if (!isset($_SESSION['last_regeneration'])) {
                self::regenerateSession();
            } elseif (time() - $_SESSION['last_regeneration'] > 1800) {
                self::regenerateSession();
            }
            
            // Check session timeout
            self::checkTimeout();
        }
    }
    
    /**
     * Initialize user session after successful login
     */
    public static function initUserSession($user_id, $username, $email, $full_name, $role_id, $role_name) {
        self::startSession();
    
        $_SESSION['user_id'] = $user_id;
        $_SESSION['username'] = $username;
        $_SESSION['email'] = $email;
        $_SESSION['full_name'] = $full_name;
        $_SESSION['role_id'] = $role_id;
        $_SESSION['role_name'] = $role_name;
        $_SESSION['authenticated'] = true;
        $_SESSION['last_activity'] = time();
    
        self::regenerateSession();
    }
    
    /**
     * Regenerate session ID
     */
    private static function regenerateSession() {
        session_regenerate_id(true);
        $_SESSION['last_regeneration'] = time();
    }
    
    /**
     * Check session timeout
     */
    private static function checkTimeout() {
        if (isset($_SESSION['last_activity']) && 
            (time() - $_SESSION['last_activity'] > self::$session_timeout)) {
            self::logout();
            header('Location: /login.php?timeout=1');
            exit;
        }
        $_SESSION['last_activity'] = time();
    }
    
    /**
     * Check if user is logged in
     */
    public static function isLoggedIn() {
        return isset($_SESSION['user_id']) && isset($_SESSION['authenticated']);
    }
    
    /**
     * Check if user has specific role
     */
    public static function hasRole($role) {
        if (!self::isLoggedIn()) return false;
        return $_SESSION['role_name'] === $role;
    }
    
    /**
     * Check if user has permission
     */
    public static function hasPermission($permission) {
        if (!self::isLoggedIn()) return false;
        
        // Admin has all permissions
        if ($_SESSION['role_name'] === 'admin') return true;
        
        // Check role-based permissions
        $permissions = self::getRolePermissions($_SESSION['role_id']);
        return in_array($permission, $permissions);
    }
    
    /**
     * Get permissions for a role
     */
    private static function getRolePermissions($role_id) {
        $permissions = [
            1 => ['manage_users', 'manage_products', 'view_reports', 'manage_orders'], // admin
            2 => ['place_orders', 'view_orders', 'update_profile'], // customer
            3 => ['manage_products', 'view_orders', 'update_inventory'] // staff
        ];
        
        return $permissions[$role_id] ?? [];
    }
    
    /**
     * Redirect if not authenticated
     */
    public static function requireAuth() {
        if (!self::isLoggedIn()) {
            header('Location: /login.php?redirect=' . urlencode($_SERVER['REQUEST_URI']));
            exit;
        }
    
        // Ensure required session variables exist
        self::ensureSessionVariables();
    }
    
    /**
     * Ensure all required session variables are set
     */
    private static function ensureSessionVariables() {
        if (!isset($_SESSION['full_name'])) {
            $_SESSION['full_name'] = $_SESSION['username'] ?? 'User';
        }
        if (!isset($_SESSION['email'])) {
            $_SESSION['email'] = 'No email provided';
        }
        if (!isset($_SESSION['role_name'])) {
            $_SESSION['role_name'] = 'user';
        }
    }
    
    /**
     * Redirect if not authorized
     */
    public static function requireRole($role) {
        self::requireAuth();
        if (!self::hasRole($role)) {
            http_response_code(403);
            include '../views/errors/403.php';
            exit;
        }
    }
    
    /**
     * Redirect if no permission
     */
    public static function requirePermission($permission) {
        self::requireAuth();
        if (!self::hasPermission($permission)) {
            http_response_code(403);
            include '../views/errors/403.php';
            exit;
        }
    }
    
    /**
     * Logout user
     */
    public static function logout() {
        // Clear session data
        $_SESSION = array();
        
        // Delete session cookie
        if (ini_get("session.use_cookies")) {
            $params = session_get_cookie_params();
            setcookie(session_name(), '', time() - 42000,
                $params["path"], $params["domain"],
                $params["secure"], $params["httponly"]
            );
        }
        
        session_destroy();
    }
    
    /**
     * Generate CSRF token
     */
    public static function generateCSRFToken() {
        if (empty($_SESSION['csrf_token'])) {
            $_SESSION['csrf_token'] = bin2hex(random_bytes(32));
        }
        return $_SESSION['csrf_token'];
    }
    
    /**
     * Validate CSRF token
     */
    public static function validateCSRFToken($token) {
        return isset($_SESSION['csrf_token']) && 
               hash_equals($_SESSION['csrf_token'], $token);
    }
    
    /**
     * Get current user ID
     */
    public static function getUserId() {
        return $_SESSION['user_id'] ?? null;
    }
    
    /**
     * Get current user role
     */
    public static function getUserRole() {
        return $_SESSION['role_name'] ?? null;
    }
    
    /**
     * Get current username
     */
    public static function getUsername() {
        return $_SESSION['username'] ?? null;
    }
    
    /**
     * Get current user email
     */
    public static function getEmail() {
        return $_SESSION['email'] ?? null;
    }
    
    /**
     * Get current user full name
     */
    public static function getFullName() {
        return $_SESSION['full_name'] ?? null;
    }
}
?>

--- File: views\admin\admin-dashboard.php ---
<?php
/**
 * SmartRetail - Admin Dashboard
 * Admin panel for managing products, stock, and customer orders
 */

// Start session if not already started
if (session_status() === PHP_SESSION_NONE) {
    session_start();
}

require_once '../../config/config.php';
require_once '../../config/Database.php';
require_once '../../utils/Auth.php';
require_once '../../models/Order.php';
require_once '../../models/Product.php';
require_once '../../models/User.php';
require_once '../../models/Category.php';

// Require admin authentication
Auth::requireAuth();
if (!Auth::hasRole('admin')) {
    header('Location: ../../dashboard.php');
    exit;
}

// Get admin information
$user_id = Auth::getUserId();
$username = $_SESSION['username'];
$full_name = $_SESSION['full_name'];
$email = $_SESSION['email'];

// Initialize cart if not exists (for header cart count)
if (!isset($_SESSION['cart'])) {
    $_SESSION['cart'] = [];
}

// Get cart items from session and calculate proper cart count
$cart_items = $_SESSION['cart'];
$cart_count = 0;
foreach ($cart_items as $item) {
    $cart_count += $item['quantity'] ?? 1;
}

// Initialize database connection
try {
    $database = new Database();
    $db = $database->getConnection();
    $orderModel = new Order($db);
    $productModel = new Product($db);
    $userModel = new User($db);
    $categoryModel = new Category($db);
} catch (Exception $e) {
    error_log("Database connection failed: " . $e->getMessage());
    die("Database connection failed. Please try again later.");
}

// Get dashboard statistics
try {
    $stats = [
        'total_products' => count($productModel->getAllProductsWithCategory()),
        'total_orders' => count($orderModel->getAllOrdersWithUsers()),
        'total_customers' => $userModel->getUsersCount(),
        'total_revenue' => $orderModel->getTotalRevenue(),
        'pending_orders' => $orderModel->getOrdersByStatus('pending')
    ];
} catch (Exception $e) {
    error_log("Error getting stats: " . $e->getMessage());
    $stats = [
        'total_products' => 0,
        'total_orders' => 0,
        'total_customers' => 0,
        'total_revenue' => 0,
        'pending_orders' => []
    ];
}

// Get recent orders
try {
    $recent_orders = $orderModel->getRecentOrders(10);
} catch (Exception $e) {
    error_log("Error getting recent orders: " . $e->getMessage());
    $recent_orders = [];
}

// Handle product actions
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    if (isset($_POST['add_product'])) {
        // Add new product
        $product_data = [
            'name' => $_POST['name'],
            'description' => $_POST['description'],
            'price' => $_POST['price'],
            'category_id' => $_POST['category_id'],
            'stock_quantity' => $_POST['stock_quantity'],
            'image' => $_POST['image'] ?? ''
        ];
        
        if ($productModel->create($product_data)) {
            $_SESSION['success'] = "Product added successfully!";
        } else {
            $_SESSION['error'] = "Failed to add product.";
        }
        header('Location: admin-dashboard.php');
        exit;
        
    } elseif (isset($_POST['update_stock'])) {
        // Update product stock
        $product_id = $_POST['product_id'];
        $new_stock = $_POST['stock_quantity'];
        
        if ($productModel->updateStock($product_id, $new_stock)) {
            $_SESSION['success'] = "Stock updated successfully!";
        } else {
            $_SESSION['error'] = "Failed to update stock.";
        }
        header('Location: admin-dashboard.php');
        exit;
        
    } elseif (isset($_POST['update_order_status'])) {
        // Update order status
        $order_id = $_POST['order_id'];
        $new_status = $_POST['status'];
        
        if ($orderModel->updateOrderStatus($order_id, $new_status)) {
            $_SESSION['success'] = "Order status updated successfully!";
        } else {
            $_SESSION['error'] = "Failed to update order status.";
        }
        header('Location: admin-dashboard.php');
        exit;
    }
}

// Get all products and categories for forms
try {
    $products = $productModel->getAllProductsWithCategory();
    $categories = $categoryModel->getAllCategories();
    $all_orders = $orderModel->getAllOrdersWithUsers();
    
    // Debug: Check what data we're getting
    error_log("Products count: " . (is_array($products) ? count($products) : '0'));
    error_log("Categories count: " . (is_array($categories) ? count($categories) : '0'));
    error_log("Orders count: " . (is_array($all_orders) ? count($all_orders) : '0'));
    
} catch (Exception $e) {
    error_log("Error fetching data: " . $e->getMessage());
    $products = [];
    $categories = [];
    $all_orders = [];
}
?>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - SmartRetail</title>
    <link rel="stylesheet" href="../../assets/css/style.css">
    
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* Additional admin-specific styles */
        .admin-page {
            padding: 2rem 0;
            min-height: calc(100vh - 200px);
            background: var(--light-bg);
        }

        .admin-welcome {
            background: white;
            border-radius: 0.75rem;
            box-shadow: var(--shadow);
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .admin-welcome h2 {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text-dark);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            border-radius: 0.75rem;
            box-shadow: var(--shadow);
            padding: 1.25rem;
            text-align: center;
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
            font-size: 1.5rem;
        }

        .stat-icon.primary {
            background: #dbeafe;
            color: var(--primary-color);
        }

        .stat-icon.success {
            background: #d1fae5;
            color: var(--success-color);
        }

        .stat-icon.warning {
            background: #fef3c7;
            color: var(--warning-color);
        }

        .stat-icon.danger {
            background: #fee2e2;
            color: var(--danger-color);
        }

        .stat-value {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: var(--text-light);
            font-size: 0.875rem;
        }

        .tabs {
            background: white;
            border-radius: 0.75rem;
            box-shadow: var(--shadow);
            overflow: hidden;
            margin-bottom: 2rem;
        }

        .tab-headers {
            display: flex;
            border-bottom: 1px solid var(--border-color);
            background: var(--light-bg);
            overflow-x: auto;
        }

        .tab-header {
            padding: 1rem 1.5rem;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.3s;
            font-weight: 500;
            white-space: nowrap;
        }

        .tab-header.active {
            border-bottom-color: var(--primary-color);
            color: var(--primary-color);
            background: white;
        }

        .tab-content {
            padding: 0;
        }

        .tab-pane {
            display: none;
            padding: 1.25rem;
        }

        .tab-pane.active {
            display: block;
        }

        .table-container {
            background: white;
            border-radius: 0.75rem;
            box-shadow: var(--shadow);
            overflow: hidden;
            margin-bottom: 2rem;
        }

        .table-header {
            padding: 1.25rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table th,
        .table td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .table th {
            background: var(--light-bg);
            font-weight: 600;
            color: var(--text-dark);
            font-size: 0.875rem;
        }

        .table tr:hover {
            background: #f8fafc;
        }

        .status-badge {
            padding: 0.25rem 0.5rem;
            border-radius: 2rem;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-pending {
            background: #fef3c7;
            color: #92400e;
        }

        .status-completed {
            background: #d1fae5;
            color: #065f46;
        }

        .status-cancelled {
            background: #fee2e2;
            color: #991b1b;
        }

        .stock-low {
            color: var(--danger-color);
            font-weight: 600;
        }

        .stock-ok {
            color: var(--success-color);
            font-weight: 600;
        }

        .form-container {
            background: white;
            border-radius: 0.75rem;
            box-shadow: var(--shadow);
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            font-weight: 500;
            margin-bottom: 0.5rem;
            color: var(--text-dark);
        }

        .form-control {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            font-size: 1rem;
            transition: all 0.3s;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .notification {
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .notification.success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #a7f3d0;
        }

        .notification.error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fecaca;
        }

        .table-responsive {
            overflow-x: auto;
        }

        .admin-subtitle {
            font-size: 0.8rem;
            color: var(--text-light);
            margin-top: 0.25rem;
            font-weight: 500;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .tab-headers {
                flex-direction: column;
            }
            
            .tab-header {
                text-align: center;
                border-bottom: none;
                border-left: 3px solid transparent;
            }
            
            .tab-header.active {
                border-left-color: var(--primary-color);
                border-bottom-color: transparent;
            }
            
            .table {
                min-width: 700px;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <!-- Logo -->
                <span class="logo">
                    <i class="fas fa-store"></i>
                    SmartRetail
                </span>
                
                <!-- Navigation -->
                <nav>
                    <ul class="nav-links">
                        <li><a href="manage-products.php">Products</a></li>
                        <li><a href="manage-orders.php">Orders</a></li>
                    </ul>
                </nav>
                
                <!-- Header Actions -->
                <div class="header-actions">
                    <!-- User Info -->
                    <div class="user-info" style="display: flex; align-items: center; gap: 0.5rem;">
                        <i class="fas fa-user-shield" style="color: var(--primary-color);"></i>
                        <span style="font-weight: 500;"><?php echo htmlspecialchars($username); ?> (Admin)</span>
                    </div>
                    
                    <a href="../../logout.php" class="btn btn-outline">
                        <i class="fas fa-sign-out-alt"></i>
                        Logout
                    </a>
                </div>
            </div>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero-section">
        <div class="container">
            <div class="hero-content">
                <h1>Welcome back, <?php echo htmlspecialchars($full_name); ?>! 👋</h1>
                <p>Manage your store, track orders, and update inventory from this admin dashboard.</p>
            </div>
        </div>
    </section>

    <!-- Admin Dashboard -->
    <section class="hero-container">
        <div class="container">
            <!-- Notifications -->
            <?php if (isset($_SESSION['success'])): ?>
                <div class="notification success">
                    <i class="fas fa-check-circle"></i>
                    <?php echo $_SESSION['success']; unset($_SESSION['success']); ?>
                </div>
            <?php endif; ?>

            <?php if (isset($_SESSION['error'])): ?>
                <div class="notification error">
                    <i class="fas fa-exclamation-circle"></i>
                    <?php echo $_SESSION['error']; unset($_SESSION['error']); ?>
                </div>
            <?php endif; ?>

            <!-- Stats Grid -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon primary">
                        <i class="fas fa-box"></i>
                    </div>
                    <div class="stat-value"><?php echo $stats['total_products']; ?></div>
                    <div class="stat-label">Total Products</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon success">
                        <i class="fas fa-shopping-bag"></i>
                    </div>
                    <div class="stat-value"><?php echo $stats['total_orders']; ?></div>
                    <div class="stat-label">Total Orders</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon warning">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-value"><?php echo $stats['total_customers']; ?></div>
                    <div class="stat-label">Total Customers</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon danger">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="stat-value">R<?php echo number_format($stats['total_revenue'], 2); ?></div>
                    <div class="stat-label">Total Revenue</div>
                </div>
            </div>

            <!-- Tabs Content -->
            <div class="tabs">
                <div class="tab-headers">
                    <div class="tab-header active" onclick="showTab('dashboard')">Dashboard</div>
                    <div class="tab-header" onclick="showTab('products')">Products</div>
                    <div class="tab-header" onclick="showTab('orders')">Orders</div>
                </div>
                
                <div class="tab-content">
                    <!-- Dashboard Tab -->
                    <div id="dashboard-tab" class="tab-pane active">
                        <!-- Recent Orders -->
                        <div class="table-container">
                            <div class="table-header">
                                <h3><i class="fas fa-clock"></i> Recent Orders</h3>
                                <a href="?tab=orders" class="btn btn-outline btn-sm">View All</a>
                            </div>
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Order ID</th>
                                        <th>Customer</th>
                                        <th>Amount</th>
                                        <th>Status</th>
                                        <th>Date</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <?php if (!empty($recent_orders)): ?>
                                        <?php foreach ($recent_orders as $order): ?>
                                        <tr>
                                            <td>#<?php echo str_pad($order['id'], 6, '0', STR_PAD_LEFT); ?></td>
                                            <td>
                                                <?php echo htmlspecialchars($order['full_name'] ?? 'Unknown Customer'); ?>
                                            </td>
                                            <td>R<?php echo number_format($order['total'], 2); ?></td>
                                            <td>
                                                <span class="status-badge status-<?php echo $order['status']; ?>">
                                                    <?php echo ucfirst($order['status']); ?>
                                                </span>
                                            </td>
                                            <td><?php echo date('M j, Y', strtotime($order['created_at'])); ?></td>
                                            <td>
                                                <button class="btn btn-outline btn-sm" onclick="viewOrder(<?php echo $order['id']; ?>)">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                            </td>
                                        </tr>
                                        <?php endforeach; ?>
                                    <?php else: ?>
                                        <tr>
                                            <td colspan="6" style="text-align: center; color: var(--text-light);">
                                                No orders found.
                                            </td>
                                        </tr>
                                    <?php endif; ?>
                                </tbody>
                            </table>
                        </div>

                        <?php 
                        // Get low stock products
                        $low_stock_products = [];
                            if (is_array($products) && !empty($products)) {
                                $low_stock_products = array_filter($products, function($product) {
                                    return isset($product['stock_quantity']) && $product['stock_quantity'] < 10;
                                });
                            }
                        ?>
                        
                        <?php if (!empty($low_stock_products)): ?>
                        <div class="table-container">
                        <div class="table-header">
                            <h3><i class="fas fa-exclamation-triangle"></i> Low Stock Alert</h3>
                        </div>
                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Product</th>
                                        <th>Current Stock</th>
                                        <th>Price</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <?php foreach ($low_stock_products as $product): ?>
                                        <tr>
                                            <td><?php echo htmlspecialchars($product['name'] ?? 'Unknown Product'); ?></td>
                                            <td class="stock-low"><?php echo $product['stock_quantity'] ?? 0; ?></td>
                                            <td>R<?php echo number_format($product['price'] ?? 0, 2); ?></td>
                                            <td>
                                                <button class="btn btn-warning btn-sm" onclick="updateStock(<?php echo $product['product_id'] ?? 0; ?>, '<?php echo htmlspecialchars(addslashes($product['name'] ?? 'Unknown')); ?>', <?php echo $product['stock_quantity'] ?? 0; ?>)">
                                                    <i class="fas fa-edit"></i> Update Stock
                                                </button>
                                            </td>
                                        </tr>
                                    <?php endforeach; ?>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    <?php endif; ?>
                    </div>

                    <!-- Products Tab -->
                    <div id="products-tab" class="tab-pane">
                        <!-- Add Product Form -->
                        <div class="form-container">
                            <h3 style="margin-bottom: 1.5rem;"><i class="fas fa-plus-circle"></i> Add New Product</h3>
                            <form method="POST">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label">Product Name</label>
                                        <input type="text" name="name" class="form-control" required>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Category</label>
                                        <select name="category_id" class="form-control" required>
                                            <option value="">Select Category</option>
                                            <?php foreach ($categories as $category): ?>
                                                <option value="<?php echo $category['id']; ?>">
                                                    <?php echo htmlspecialchars($category['name']); ?>
                                                </option>
                                            <?php endforeach; ?>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Description</label>
                                    <textarea name="description" class="form-control" rows="3" required></textarea>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label">Price (R)</label>
                                        <input type="number" name="price" step="0.01" class="form-control" required>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Stock Quantity</label>
                                        <input type="number" name="stock_quantity" class="form-control" required>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Image URL (Optional)</label>
                                    <input type="url" name="image" class="form-control" placeholder="https://example.com/image.jpg">
                                </div>
                                <button type="submit" name="add_product" class="btn btn-primary">
                                    <i class="fas fa-save"></i> Add Product
                                </button>
                            </form>
                        </div>

                        <!-- Products List -->
                        <div class="table-container">
                            <div class="table-header">
                                <h3><i class="fas fa-boxes"></i> All Products</h3>
                            </div>
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Name</th>
                                        <th>Category</th>
                                        <th>Price</th>
                                        <th>Stock</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                     <?php if (!empty($products) && is_array($products)): ?>
                                        <?php foreach ($products as $product): ?>
                                            <?php 
                                            // Skip invalid products - note the change from 'id' to 'product_id'
                                            if (empty($product['product_id'])) continue;
                                            ?>
                                            <tr>
                                                <td><?php echo htmlspecialchars($product['product_id']); ?></td>
                                                <td><?php echo htmlspecialchars($product['name'] ?? 'Unknown Product'); ?></td>
                                                <td><?php echo htmlspecialchars($product['category_name'] ?? 'Uncategorized'); ?></td>
                                                <td>R<?php echo number_format($product['price'] ?? 0, 2); ?></td>
                                                <td class="<?php echo ($product['stock_quantity'] ?? 0) < 10 ? 'stock-low' : 'stock-ok'; ?>">
                                                <?php echo $product['stock_quantity'] ?? 0; ?>
                                            </td>
                                            <td>
                                                <span class="status-badge <?php echo ($product['stock_quantity'] ?? 0) > 0 ? 'status-completed' : 'status-cancelled'; ?>">
                                                    <?php echo ($product['stock_quantity'] ?? 0) > 0 ? 'In Stock' : 'Out of Stock'; ?>
                                                </span>
                                            </td>
                                            <td>
                                                <button class="btn btn-outline btn-sm" onclick="editProduct(<?php echo $product['product_id']; ?>)">
                                                    <i class="fas fa-edit"></i>
                                                </button>
                                                <button class="btn btn-outline btn-sm" onclick="updateStock(<?php echo $product['product_id']; ?>, '<?php echo htmlspecialchars(addslashes($product['name'] ?? 'Unknown Product')); ?>', <?php echo $product['stock_quantity'] ?? 0; ?>)">
                                                    <i class="fas fa-box"></i>
                                                </button>
                                            </td>
                                        </tr>
                                        <?php endforeach; ?>
                                        <?php else: ?>
                                        <tr>
                                            <td colspan="7" style="text-align: center; color: var(--text-light);">
                                                No products found.
                                            </td>
                                        </tr>
                                    <?php endif; ?>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Orders Tab -->
                    <div id="orders-tab" class="tab-pane">
                        <!-- Orders List -->
                        <div class="table-container">
                            <div class="table-header">
                                <h3><i class="fas fa-shopping-bag"></i> All Orders</h3>
                            </div>
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Order ID</th>
                                        <th>Customer</th>
                                        <th>Email</th>
                                        <th>Amount</th>
                                        <th>Status</th>
                                        <th>Date</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <?php if (!empty($all_orders)): ?>
                                        <?php foreach ($all_orders as $order): ?>
                                        <tr>
                                            <td>#<?php echo str_pad($order['id'], 6, '0', STR_PAD_LEFT); ?></td>
                                            <td><?php echo htmlspecialchars($order['full_name'] ?? 'Unknown'); ?></td>
                                            <td><?php echo htmlspecialchars($order['email'] ?? 'N/A'); ?></td>
                                            <td>R<?php echo number_format($order['total'], 2); ?></td>
                                            <td>
                                                <span class="status-badge status-<?php echo $order['status']; ?>">
                                                    <?php echo ucfirst($order['status']); ?>
                                                </span>
                                            </td>
                                            <td><?php echo date('M j, Y g:i A', strtotime($order['created_at'])); ?></td>
                                            <td>
                                                <button class="btn btn-outline btn-sm" onclick="viewOrder(<?php echo $order['id']; ?>)">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                                <button class="btn btn-outline btn-sm" onclick="updateOrderStatus(<?php echo $order['id']; ?>, '<?php echo $order['status']; ?>')">
                                                    <i class="fas fa-edit"></i>
                                                </button>
                                            </td>
                                        </tr>
                                        <?php endforeach; ?>
                                    <?php else: ?>
                                        <tr>
                                            <td colspan="7" style="text-align: center; color: var(--text-light);">
                                                No orders found.
                                            </td>
                                        </tr>
                                    <?php endif; ?>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- JavaScript -->
    <script>
        // Tab functionality
        function showTab(tabName) {
            // Hide all tab panes
            document.querySelectorAll('.tab-pane').forEach(pane => {
                pane.classList.remove('active');
            });
            
            // Show selected tab pane
            document.getElementById(tabName + '-tab').classList.add('active');
            
            // Update tab header states
            document.querySelectorAll('.tab-header').forEach(header => {
                header.classList.remove('active');
            });
            
            // Set current tab header as active
            event.target.classList.add('active');
        }

        // Update stock modal
        function updateStock(productId, productName, currentStock) {
            const newStock = prompt(`Update stock for "${productName}"\nCurrent stock: ${currentStock}\n\nEnter new stock quantity:`, currentStock);
            
            if (newStock !== null && newStock !== '' && !isNaN(newStock)) {
                // Create form and submit
                const form = document.createElement('form');
                form.method = 'POST';
                form.style.display = 'none';
                
                const productIdInput = document.createElement('input');
                productIdInput.name = 'product_id';
                productIdInput.value = productId;
                form.appendChild(productIdInput);
                
                const stockInput = document.createElement('input');
                stockInput.name = 'stock_quantity';
                stockInput.value = newStock;
                form.appendChild(stockInput);
                
                const submitInput = document.createElement('input');
                submitInput.name = 'update_stock';
                submitInput.value = '1';
                form.appendChild(submitInput);
                
                document.body.appendChild(form);
                form.submit();
            }
        }

        // Update order status modal
        function updateOrderStatus(orderId, currentStatus) {
            const newStatus = prompt(`Update order #${orderId.toString().padStart(6, '0')}\nCurrent status: ${currentStatus}\n\nEnter new status (pending/completed/cancelled):`, currentStatus);
            
            if (newStatus && ['pending', 'completed', 'cancelled'].includes(newStatus.toLowerCase())) {
                // Create form and submit
                const form = document.createElement('form');
                form.method = 'POST';
                form.style.display = 'none';
                
                const orderIdInput = document.createElement('input');
                orderIdInput.name = 'order_id';
                orderIdInput.value = orderId;
                form.appendChild(orderIdInput);
                
                const statusInput = document.createElement('input');
                statusInput.name = 'status';
                statusInput.value = newStatus.toLowerCase();
                form.appendChild(statusInput);
                
                const submitInput = document.createElement('input');
                submitInput.name = 'update_order_status';
                submitInput.value = '1';
                form.appendChild(submitInput);
                
                document.body.appendChild(form);
                form.submit();
            }
        }

        // View order details
        function viewOrder(orderId) {
            alert(`Viewing order #${orderId.toString().padStart(6, '0')}\n\nIn a real application, this would show detailed order information including:\n- Customer details\n- Shipping address\n- Order items\n- Payment information\n- Order history`);
        }

        // Edit product
        function editProduct(productId) {
            alert(`Editing product #${productId}\n\nIn a real application, this would open a product edit form with pre-filled data.`);
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            // Check URL for tab parameter
            const urlParams = new URLSearchParams(window.location.search);
            const tab = urlParams.get('tab');
            if (tab && ['dashboard', 'products', 'orders'].includes(tab)) {
                showTab(tab);
            }
        });
    </script>
</body>
</html>

--- File: views\admin\manage-orders.php ---
<?php
/**
 * Admin - Manage Orders
 * Allows admin to view and manage customer orders
 */

// Start session if not already started
if (session_status() === PHP_SESSION_NONE) {
    session_start();
}

// Define base directory and fix path separators
define('DS', DIRECTORY_SEPARATOR);
define('BASE_DIR', dirname(__DIR__, 2));

// Include required files with proper path handling
$config_files = [
    BASE_DIR . DS . 'config' . DS . 'config.php',
    BASE_DIR . DS . 'config' . DS . 'Database.php',
    BASE_DIR . DS . 'utils' . DS . 'Auth.php',
    BASE_DIR . DS . 'models' . DS . 'Order.php',
    BASE_DIR . DS . 'models' . DS . 'User.php'
];

foreach ($config_files as $file) {
    if (!file_exists($file)) {
        die("Required file not found: " . $file);
    }
    require_once $file;
}

// Check if user is authenticated and has admin/staff role
if (!isset($_SESSION['user_id']) || !in_array($_SESSION['role_name'] ?? '', ['admin', 'staff'])) {
    header('Location: ' . BASE_DIR . DS . 'login.php');
    exit();
}

try {
    // Initialize database connection
    $database = new Database();
    $db = $database->getConnection();
    
    // Initialize models
    $orderModel = new Order($db);
    $userModel = new User($db);
    
    // Handle form actions
    $action = $_POST['action'] ?? $_GET['action'] ?? '';
    $message = '';
    $message_type = '';
    
    // Handle status updates
    if ($action === 'update_status' && $_SERVER['REQUEST_METHOD'] === 'POST') {
        $order_id = intval($_POST['order_id'] ?? 0);
        $new_status = $_POST['status'] ?? '';
        
        if ($order_id > 0 && in_array($new_status, ['pending', 'completed', 'cancelled'])) {
            if ($orderModel->updateOrderStatus($order_id, $new_status)) {
                $message = 'Order status updated successfully!';
                $message_type = 'success';
            } else {
                $message = 'Failed to update order status. Please try again.';
                $message_type = 'error';
            }
        } else {
            $message = 'Invalid order ID or status.';
            $message_type = 'error';
        }
    }
    
    // Get filter parameters
    $status_filter = $_GET['status'] ?? '';
    $date_from = $_GET['date_from'] ?? '';
    $date_to = $_GET['date_to'] ?? '';
    
    // Get orders with filters
    $orders = $orderModel->getAllOrdersWithUsers($status_filter, $date_from, $date_to);
    
    // Get order statistics
    $total_orders = count($orders);
    $pending_orders = array_filter($orders, function($order) {
        return ($order['status'] ?? '') === 'pending';
    });
    $completed_orders = array_filter($orders, function($order) {
        return ($order['status'] ?? '') === 'completed';
    });
    $cancelled_orders = array_filter($orders, function($order) {
        return ($order['status'] ?? '') === 'cancelled';
    });
    
    $total_revenue = array_sum(array_map(function($order) {
        return ($order['status'] ?? '') === 'completed' ? floatval($order['total'] ?? 0) : 0;
    }, $orders));
    
} catch (Exception $e) {
    error_log("Manage Orders Error: " . $e->getMessage());
    $message = 'Error loading orders: ' . $e->getMessage();
    $message_type = 'error';
    $orders = [];
    $total_orders = $pending_orders = $completed_orders = $cancelled_orders = 0;
    $total_revenue = 0;
}

// Get site name safely
$site_name = defined('SITE_NAME') ? SITE_NAME : 'Admin Panel';
?>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Orders - <?php echo htmlspecialchars($site_name); ?></title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: #f5f7fa;
            color: #333;
        }
        
        .admin-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .header h1 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .breadcrumb {
            color: #7f8c8d;
            font-size: 0.9em;
        }
        
        .breadcrumb a {
            color: #3498db;
            text-decoration: none;
        }
        
        .alert {
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
            border: 1px solid transparent;
        }
        
        .alert-success {
            color: #155724;
            background-color: #d4edda;
            border-color: #c3e6cb;
        }
        
        .alert-error {
            color: #721c24;
            background-color: #f8d7da;
            border-color: #f5c6cb;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .stat-label {
            color: #7f8c8d;
            font-size: 0.9em;
        }
        
        .filters-section {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .filters-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            align-items: end;
        }
        
        .form-group {
            margin-bottom: 0;
        }
        
        .form-label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #2c3e50;
        }
        
        .form-control {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #dcdfe6;
            border-radius: 5px;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: #3498db;
            color: white;
        }
        
        .btn-primary:hover {
            background: #2980b9;
        }
        
        .btn-success {
            background: #27ae60;
            color: white;
        }
        
        .btn-success:hover {
            background: #219a52;
        }
        
        .btn-warning {
            background: #f39c12;
            color: white;
        }
        
        .btn-warning:hover {
            background: #d35400;
        }
        
        .btn-danger {
            background: #e74c3c;
            color: white;
        }
        
        .btn-danger:hover {
            background: #c0392b;
        }
        
        .btn-sm {
            padding: 6px 12px;
            font-size: 0.85em;
        }
        
        .orders-section {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #ecf0f1;
        }
        
        .section-header h2 {
            color: #2c3e50;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ecf0f1;
        }
        
        th {
            background: #f8f9fa;
            font-weight: 600;
            color: #2c3e50;
        }
        
        tr:hover {
            background: #f8f9fa;
        }
        
        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: 500;
        }
        
        .status-pending {
            background: #fff3cd;
            color: #856404;
        }
        
        .status-completed {
            background: #d1edff;
            color: #004085;
        }
        
        .status-cancelled {
            background: #f8d7da;
            color: #721c24;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #7f8c8d;
        }
        
        .empty-state i {
            font-size: 3em;
            margin-bottom: 15px;
            color: #bdc3c7;
        }
        
        .action-buttons {
            display: flex;
            gap: 5px;
        }
        
        .price {
            font-weight: bold;
            color: #2c3e50;
        }
        
        .order-details {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin-top: 10px;
            display: none;
        }
        
        .order-items {
            width: 100%;
            border-collapse: collapse;
        }
        
        .order-items th,
        .order-items td {
            padding: 8px 12px;
            border: 1px solid #dee2e6;
        }
        
        .toggle-details {
            background: none;
            border: none;
            color: #3498db;
            cursor: pointer;
            font-size: 0.9em;
        }
        
        .toggle-details:hover {
            text-decoration: underline;
        }
        
        .role-badge {
            background: #e74c3c;
            color: white;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 0.7em;
            margin-left: 5px;
        }
        
        .staff-badge {
            background: #f39c12;
        }
        
        .admin-badge {
            background: #e74c3c;
        }
        
        @media (max-width: 768px) {
            .filters-form {
                grid-template-columns: 1fr;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            table {
                font-size: 0.9em;
            }
            
            th, td {
                padding: 8px 10px;
            }
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <div class="header">
            <h1><i class="fas fa-shopping-cart"></i> Manage Orders</h1>
            <div class="breadcrumb">
                <a href="admin-dashboard.php"><i class="fas fa-home"></i> Dashboard</a> / Manage Orders
                <?php if (isset($_SESSION['role_name'])): ?>
                    <span class="role-badge <?php echo $_SESSION['role_name'] === 'staff' ? 'staff-badge' : 'admin-badge'; ?>">
                        <?php echo ucfirst($_SESSION['role_name']); ?>
                    </span>
                <?php endif; ?>
            </div>
        </div>

        <?php if ($message): ?>
            <div class="alert alert-<?php echo $message_type === 'success' ? 'success' : 'error'; ?>">
                <?php echo htmlspecialchars($message); ?>
            </div>
        <?php endif; ?>

        <!-- Statistics -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number"><?php echo $total_orders; ?></div>
                <div class="stat-label">Total Orders</div>
            </div>
            <div class="stat-card">
                <div class="stat-number"><?php echo count($pending_orders); ?></div>
                <div class="stat-label">Pending Orders</div>
            </div>
            <div class="stat-card">
                <div class="stat-number"><?php echo count($completed_orders); ?></div>
                <div class="stat-label">Completed Orders</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">R<?php echo number_format($total_revenue, 2); ?></div>
                <div class="stat-label">Total Revenue</div>
            </div>
        </div>

        <!-- Filters -->
        <div class="filters-section">
            <form method="GET" class="filters-form">
                <div class="form-group">
                    <label class="form-label" for="status">Order Status</label>
                    <select id="status" name="status" class="form-control">
                        <option value="">All Statuses</option>
                        <option value="pending" <?php echo $status_filter === 'pending' ? 'selected' : ''; ?>>Pending</option>
                        <option value="completed" <?php echo $status_filter === 'completed' ? 'selected' : ''; ?>>Completed</option>
                        <option value="cancelled" <?php echo $status_filter === 'cancelled' ? 'selected' : ''; ?>>Cancelled</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="date_from">Date From</label>
                    <input type="date" id="date_from" name="date_from" class="form-control" value="<?php echo htmlspecialchars($date_from); ?>">
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="date_to">Date To</label>
                    <input type="date" id="date_to" name="date_to" class="form-control" value="<?php echo htmlspecialchars($date_to); ?>">
                </div>
                
                <div class="form-group">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-filter"></i> Apply Filters
                    </button>
                    <a href="manage-orders.php" class="btn" style="background: #95a5a6; color: white;">
                        <i class="fas fa-times"></i> Clear
                    </a>
                </div>
            </form>
        </div>

        <!-- Orders List -->
        <div class="orders-section">
            <div class="section-header">
                <h2><i class="fas fa-list"></i> Orders List</h2>
                <div>
                    <span class="stat-label">Showing <?php echo count($orders); ?> orders</span>
                </div>
            </div>

            <?php if (empty($orders)): ?>
                <div class="empty-state">
                    <i class="fas fa-shopping-cart"></i>
                    <h3>No Orders Found</h3>
                    <p>No orders match your current filters.</p>
                </div>
            <?php else: ?>
                <div style="overflow-x: auto;">
                    <table>
                        <thead>
                            <tr>
                                <th>Order ID</th>
                                <th>Customer</th>
                                <th>Date</th>
                                <th>Amount</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <?php foreach ($orders as $order): ?>
                                <tr>
                                    <td>
                                        <strong>#<?php echo htmlspecialchars($order['id'] ?? 'N/A'); ?></strong>
                                        <br>
                                        <button class="toggle-details" onclick="toggleOrderDetails(<?php echo $order['id'] ?? 0; ?>)">
                                            <i class="fas fa-chevron-down"></i> Details
                                        </button>
                                    </td>
                                    <td>
                                        <?php echo htmlspecialchars($order['full_name'] ?? 'Unknown Customer'); ?>
                                        <br>
                                        <small style="color: #7f8c8d;"><?php echo htmlspecialchars($order['email'] ?? ''); ?></small>
                                    </td>
                                    <td><?php echo isset($order['created_at']) ? date('M j, Y g:i A', strtotime($order['created_at'])) : 'N/A'; ?></td>
                                    <td class="price">R<?php echo isset($order['total']) ? number_format($order['total'], 2) : '0.00'; ?></td>
                                    <td>
                                        <span class="status-badge status-<?php echo htmlspecialchars($order['status'] ?? 'pending'); ?>">
                                            <?php echo ucfirst($order['status'] ?? 'Pending'); ?>
                                        </span>
                                    </td>
                                    <td>
                                        <div class="action-buttons">
                                            <form method="POST" style="display: inline;">
                                                <input type="hidden" name="action" value="update_status">
                                                <input type="hidden" name="order_id" value="<?php echo $order['id'] ?? ''; ?>">
                                                <select name="status" onchange="this.form.submit()" class="form-control" style="width: 120px; display: inline-block; margin-right: 5px;">
                                                    <option value="pending" <?php echo ($order['status'] ?? '') === 'pending' ? 'selected' : ''; ?>>Pending</option>
                                                    <option value="completed" <?php echo ($order['status'] ?? '') === 'completed' ? 'selected' : ''; ?>>Completed</option>
                                                    <option value="cancelled" <?php echo ($order['status'] ?? '') === 'cancelled' ? 'selected' : ''; ?>>Cancelled</option>
                                                </select>
                                            </form>
                                            <button class="btn btn-primary btn-sm" onclick="viewOrder(<?php echo $order['id'] ?? 0; ?>)">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                <tr id="order-details-<?php echo $order['id'] ?? ''; ?>" style="display: none;">
                                    <td colspan="6">
                                        <div class="order-details">
                                            <h4>Order Details #<?php echo htmlspecialchars($order['id'] ?? 'N/A'); ?></h4>
                                            <p><strong>Customer:</strong> <?php echo htmlspecialchars($order['full_name'] ?? 'Unknown'); ?></p>
                                            <p><strong>Email:</strong> <?php echo htmlspecialchars($order['email'] ?? 'N/A'); ?></p>
                                            <p><strong>Order Date:</strong> <?php echo isset($order['created_at']) ? date('F j, Y g:i A', strtotime($order['created_at'])) : 'N/A'; ?></p>
                                            <p><strong>Total Amount:</strong> R<?php echo isset($order['total']) ? number_format($order['total'], 2) : '0.00'; ?></p>
                                            <p><strong>Status:</strong> 
                                                <span class="status-badge status-<?php echo htmlspecialchars($order['status'] ?? 'pending'); ?>">
                                                    <?php echo ucfirst($order['status'] ?? 'Pending'); ?>
                                                </span>
                                            </p>
                                            <div style="margin-top: 15px;">
                                                <small style="color: #7f8c8d;">
                                                    <i>Order items would be displayed here in a real application</i>
                                                </small>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                            <?php endforeach; ?>
                        </tbody>
                    </table>
                </div>
            <?php endif; ?>
        </div>
    </div>

    <script>
        function toggleOrderDetails(orderId) {
            const detailsRow = document.getElementById('order-details-' + orderId);
            const button = event.target.closest('button') || event.target;
            
            if (detailsRow.style.display === 'none') {
                detailsRow.style.display = 'table-row';
                button.innerHTML = '<i class="fas fa-chevron-up"></i> Hide Details';
            } else {
                detailsRow.style.display = 'none';
                button.innerHTML = '<i class="fas fa-chevron-down"></i> Details';
            }
        }
        
        function viewOrder(orderId) {
            alert('View order details for order #' + orderId + ' - This would open a detailed order view.');
            // In a real application, this would redirect to an order details page
            // window.location.href = 'order-details.php?id=' + orderId;
        }
        
        // Auto-submit status change forms
        document.querySelectorAll('select[name="status"]').forEach(select => {
            select.addEventListener('change', function() {
                this.form.submit();
            });
        });
        
        // Date validation
        const dateFrom = document.getElementById('date_from');
        const dateTo = document.getElementById('date_to');
        
        if (dateFrom && dateTo) {
            dateFrom.addEventListener('change', function() {
                if (dateTo.value && this.value > dateTo.value) {
                    alert('Date From cannot be after Date To');
                    this.value = '';
                }
            });
            
            dateTo.addEventListener('change', function() {
                if (dateFrom.value && this.value < dateFrom.value) {
                    alert('Date To cannot be before Date From');
                    this.value = '';
                }
            });
        }
    </script>
</body>
</html>

--- File: views\admin\manage-products.php ---
<?php
/**
 * Admin - Manage Products
 * Allows admin to view, add, edit, and delete products
 */

// Start session if not already started
if (session_status() === PHP_SESSION_NONE) {
    session_start();
}

// Define base directory and fix path separators
define('DS', DIRECTORY_SEPARATOR);
define('BASE_DIR', dirname(__DIR__, 2)); // Goes up two levels from current directory

// Include required files with proper path handling
$config_files = [
    BASE_DIR . DS . 'config' . DS . 'config.php',
    BASE_DIR . DS . 'config' . DS . 'Database.php',
    BASE_DIR . DS . 'utils' . DS . 'Auth.php',
    BASE_DIR . DS . 'models' . DS . 'Product.php',
    BASE_DIR . DS . 'models' . DS . 'Category.php'
];

foreach ($config_files as $file) {
    if (!file_exists($file)) {
        die("Required file not found: " . $file);
    }
    require_once $file;
}

// Check if user is authenticated and has admin/staff role
if (!isset($_SESSION['user_id']) || !in_array($_SESSION['role_name'] ?? '', ['admin', 'staff'])) {
    header('Location: ' . BASE_DIR . DS . 'login.php');
    exit();
}

try {
    // Initialize database connection
    $database = new Database();
    $db = $database->getConnection();
    
    // Initialize models
    $productModel = new Product($db);
    $categoryModel = new Category($db);
    
    // Handle form actions
    $action = $_POST['action'] ?? $_GET['action'] ?? '';
    $message = '';
    $message_type = '';
    
    // Get categories for dropdown
    $categories = $categoryModel->getCategoriesForDropdown();
    
    // Handle different actions
    switch ($action) {
        case 'add':
            if ($_SERVER['REQUEST_METHOD'] === 'POST') {
                // Validate and sanitize input
                $product_data = [
                    'name' => trim($_POST['name'] ?? ''),
                    'description' => trim($_POST['description'] ?? ''),
                    'price' => floatval($_POST['price'] ?? 0),
                    'category_id' => !empty($_POST['category_id']) ? intval($_POST['category_id']) : null,
                    'stock_quantity' => intval($_POST['stock_quantity'] ?? 0),
                    'image' => trim($_POST['image'] ?? ''),
                    'rating' => 0.00 // Default rating
                ];
                
                // Validate required fields
                if (empty($product_data['name']) || $product_data['price'] <= 0) {
                    $message = 'Product name and price are required. Price must be greater than 0.';
                    $message_type = 'error';
                } else {
                    if ($productModel->create($product_data)) {
                        $message = 'Product added successfully!';
                        $message_type = 'success';
                    } else {
                        $message = 'Failed to add product. Please try again.';
                        $message_type = 'error';
                    }
                }
            }
            break;
            
        case 'edit':
            if ($_SERVER['REQUEST_METHOD'] === 'POST') {
                $product_id = intval($_POST['product_id'] ?? 0);
                $product_data = [
                    'name' => trim($_POST['name'] ?? ''),
                    'description' => trim($_POST['description'] ?? ''),
                    'price' => floatval($_POST['price'] ?? 0),
                    'category_id' => !empty($_POST['category_id']) ? intval($_POST['category_id']) : null,
                    'stock_quantity' => intval($_POST['stock_quantity'] ?? 0),
                    'image' => trim($_POST['image'] ?? '')
                ];
            
                // Debug: Check what values are being received
                error_log("Editing product ID: " . $product_id);
                error_log("Product data: " . print_r($product_data, true));
            
                if ($product_id <= 0) {
                    $message = 'Invalid product ID. Received: ' . $product_id;
                    $message_type = 'error';
                } elseif (empty($product_data['name']) || $product_data['price'] <= 0) {
                    $message = 'Product name and price are required. Price must be greater than 0.';
                    $message_type = 'error';
                } else {
                    if ($productModel->update($product_id, $product_data)) {
                        $message = 'Product updated successfully!';
                        $message_type = 'success';
                    } else {
                        $message = 'Failed to update product. Please try again.';
                        $message_type = 'error';
                    }
                }
            }
            break;
            
        case 'delete':
            $product_id = intval($_GET['product_id'] ?? 0);
            if ($product_id > 0) {
                if ($productModel->delete($product_id)) {
                    $message = 'Product deleted successfully!';
                    $message_type = 'success';
                } else {
                    $message = 'Failed to delete product. Please try again.';
                    $message_type = 'error';
                }
            } else {
                $message = 'Invalid product ID.';
                $message_type = 'error';
            }
            break;
    }
    
    // Get all products with category information
    $products = $productModel->getAllProductsWithCategory();
    
} catch (Exception $e) {
    error_log("Manage Products Error: " . $e->getMessage());
    $message = 'Error loading products: ' . $e->getMessage();
    $message_type = 'error';
    $products = [];
    $categories = [];
}

// Function to get product icon based on category
function getProductIcon($categoryName, $productName = '') {
    $categoryName = strtolower($categoryName ?? '');
    $productName = strtolower($productName ?? '');
    
    // Category-based icons
    if (strpos($categoryName, 'electron') !== false) {
        return 'fas fa-laptop';
    } elseif (strpos($categoryName, 'cloth') !== false || strpos($categoryName, 'fashion') !== false) {
        return 'fas fa-tshirt';
    } elseif (strpos($categoryName, 'book') !== false) {
        return 'fas fa-book';
    } elseif (strpos($categoryName, 'home') !== false || strpos($categoryName, 'garden') !== false) {
        return 'fas fa-home';
    } elseif (strpos($categoryName, 'sport') !== false) {
        return 'fas fa-football-ball';
    } elseif (strpos($categoryName, 'beauty') !== false) {
        return 'fas fa-spa';
    } elseif (strpos($categoryName, 'toy') !== false) {
        return 'fas fa-gamepad';
    } elseif (strpos($categoryName, 'food') !== false) {
        return 'fas fa-utensils';
    } elseif (strpos($categoryName, 'health') !== false) {
        return 'fas fa-heartbeat';
    } elseif (strpos($categoryName, 'auto') !== false) {
        return 'fas fa-car';
    } elseif (strpos($categoryName, 'jewel') !== false) {
        return 'fas fa-gem';
    } elseif (strpos($categoryName, 'furniture') !== false) {
        return 'fas fa-couch';
    } elseif (strpos($categoryName, 'music') !== false) {
        return 'fas fa-music';
    } elseif (strpos($categoryName, 'movie') !== false) {
        return 'fas fa-film';
    }
    
    // Product name based icons
    if (strpos($productName, 'phone') !== false) {
        return 'fas fa-mobile-alt';
    } elseif (strpos($productName, 'laptop') !== false || strpos($productName, 'computer') !== false) {
        return 'fas fa-laptop';
    } elseif (strpos($productName, 'headphone') !== false) {
        return 'fas fa-headphones';
    } elseif (strpos($productName, 'watch') !== false) {
        return 'fas fa-clock';
    } elseif (strpos($productName, 'camera') !== false) {
        return 'fas fa-camera';
    } elseif (strpos($productName, 'game') !== false) {
        return 'fas fa-gamepad';
    } elseif (strpos($productName, 'shoe') !== false) {
        return 'fas fa-shoe-prints';
    } elseif (strpos($productName, 'bag') !== false) {
        return 'fas fa-shopping-bag';
    }
    
    // Default icon
    return 'fas fa-box';
}

// Get site name safely
$site_name = defined('SITE_NAME') ? SITE_NAME : 'Admin Panel';
?>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Products - <?php echo htmlspecialchars($site_name); ?></title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Your existing CSS remains the same */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: #f5f7fa;
            color: #333;
        }
        
        .admin-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .header h1 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .breadcrumb {
            color: #7f8c8d;
            font-size: 0.9em;
        }
        
        .breadcrumb a {
            color: #3498db;
            text-decoration: none;
        }
        
        .alert {
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
            border: 1px solid transparent;
        }
        
        .alert-success {
            color: #155724;
            background-color: #d4edda;
            border-color: #c3e6cb;
        }
        
        .alert-error {
            color: #721c24;
            background-color: #f8d7da;
            border-color: #f5c6cb;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .stat-label {
            color: #7f8c8d;
            font-size: 0.9em;
        }
        
        .content-grid {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 20px;
        }
        
        .products-section, .form-section {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #ecf0f1;
        }
        
        .section-header h2 {
            color: #2c3e50;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: #3498db;
            color: white;
        }
        
        .btn-primary:hover {
            background: #2980b9;
        }
        
        .btn-danger {
            background: #e74c3c;
            color: white;
        }
        
        .btn-danger:hover {
            background: #c0392b;
        }
        
        .btn-edit {
            background: #f39c12;
            color: white;
        }
        
        .btn-edit:hover {
            background: #d35400;
        }
        
        .btn-sm {
            padding: 6px 12px;
            font-size: 0.85em;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ecf0f1;
        }
        
        th {
            background: #f8f9fa;
            font-weight: 600;
            color: #2c3e50;
        }
        
        tr:hover {
            background: #f8f9fa;
        }
        
        .product-icon {
            width: 50px;
            height: 50px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            color: white;
        }
        
        .icon-electronics { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .icon-fashion { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .icon-books { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
        .icon-home { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); }
        .icon-sports { background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); }
        .icon-beauty { background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); }
        .icon-default { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        
        .stock-low {
            color: #e74c3c;
            font-weight: bold;
        }
        
        .stock-ok {
            color: #27ae60;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #2c3e50;
        }
        
        .form-control {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #dcdfe6;
            border-radius: 5px;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        
        .form-control:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }
        
        .form-actions {
            display: flex;
            gap: 10px;
            margin-top: 25px;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #7f8c8d;
        }
        
        .empty-state i {
            font-size: 3em;
            margin-bottom: 15px;
            color: #bdc3c7;
        }
        
        .action-buttons {
            display: flex;
            gap: 5px;
        }
        
        .price {
            font-weight: bold;
            color: #2c3e50;
        }
        
        .rating-stars {
            color: #f39c12;
        }
        
        @media (max-width: 1024px) {
            .content-grid {
                grid-template-columns: 1fr;
            }
            
            .form-section {
                order: -1;
            }
        }
        
        .role-badge {
            background: #e74c3c;
            color: white;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 0.7em;
            margin-left: 5px;
        }
        
        .staff-badge {
            background: #f39c12;
        }
        
        .admin-badge {
            background: #e74c3c;
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <div class="header">
            <h1><i class="fas fa-boxes"></i> Manage Products</h1>
            <div class="breadcrumb">
                <a href="admin-dashboard.php"><i class="fas fa-home"></i> Dashboard</a> / Manage Products
                <?php if (isset($_SESSION['role_name'])): ?>
                    <span class="role-badge <?php echo $_SESSION['role_name'] === 'staff' ? 'staff-badge' : 'admin-badge'; ?>">
                        <?php echo ucfirst($_SESSION['role_name']); ?>
                    </span>
                <?php endif; ?>
            </div>
        </div>

        <?php if ($message): ?>
            <div class="alert alert-<?php echo $message_type === 'success' ? 'success' : 'error'; ?>">
                <?php echo htmlspecialchars($message); ?>
            </div>
        <?php endif; ?>

        <!-- Statistics -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number"><?php echo count($products); ?></div>
                <div class="stat-label">Total Products</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">
                    <?php 
                    $lowStock = array_filter($products, function($product) {
                        return ($product['stock_quantity'] ?? 0) < 10;
                    });
                    echo count($lowStock);
                    ?>
                </div>
                <div class="stat-label">Low Stock Items</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">
                    <?php 
                    $totalValue = array_sum(array_map(function($product) {
                        return ($product['price'] ?? 0) * ($product['stock_quantity'] ?? 0);
                    }, $products));
                    echo 'R' . number_format($totalValue, 2);
                    ?>
                </div>
                <div class="stat-label">Total Inventory Value</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">
                    <?php 
                    $categoriesCount = array_unique(array_column($products, 'category_name'));
                    echo count($categoriesCount);
                    ?>
                </div>
                <div class="stat-label">Active Categories</div>
            </div>
        </div>

        <div class="content-grid">
            <!-- Products List -->
            <div class="products-section">
                <div class="section-header">
                    <h2><i class="fas fa-list"></i> Products List</h2>
                    <button type="button" class="btn btn-primary" onclick="showAddForm()">
                        <i class="fas fa-plus"></i> Add New Product
                    </button>
                </div>

                <?php if (empty($products)): ?>
                    <div class="empty-state">
                        <i class="fas fa-box-open"></i>
                        <h3>No Products Found</h3>
                        <p>Get started by adding your first product.</p>
                    </div>
                <?php else: ?>
                    <div style="overflow-x: auto;">
                        <table>
                            <thead>
                                <tr>
                                    <th>Icon</th>
                                    <th>Name</th>
                                    <th>Category</th>
                                    <th>Price</th>
                                    <th>Stock</th>
                                    <th>Rating</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <?php foreach ($products as $product): ?>
                                    <?php 
                                    $iconClass = 'icon-default';
                                    $categoryLower = strtolower($product['category_name'] ?? '');
                                    if (strpos($categoryLower, 'electron') !== false) $iconClass = 'icon-electronics';
                                    elseif (strpos($categoryLower, 'cloth') !== false || strpos($categoryLower, 'fashion') !== false) $iconClass = 'icon-fashion';
                                    elseif (strpos($categoryLower, 'book') !== false) $iconClass = 'icon-books';
                                    elseif (strpos($categoryLower, 'home') !== false || strpos($categoryLower, 'garden') !== false) $iconClass = 'icon-home';
                                    elseif (strpos($categoryLower, 'sport') !== false) $iconClass = 'icon-sports';
                                    elseif (strpos($categoryLower, 'beauty') !== false) $iconClass = 'icon-beauty';
                                    ?>
                                    <tr>
                                        <td>
                                            <div class="product-icon <?php echo $iconClass; ?>">
                                                <i class="<?php echo getProductIcon($product['category_name'] ?? '', $product['name'] ?? ''); ?>"></i>
                                            </div>
                                        </td>
                                        <td>
                                            <strong><?php echo htmlspecialchars($product['name'] ?? ''); ?></strong>
                                            <?php if (!empty($product['description'])): ?>
                                                <br><small style="color: #7f8c8d;"><?php echo substr(htmlspecialchars($product['description']), 0, 50); ?>...</small>
                                            <?php endif; ?>
                                        </td>
                                        <td><?php echo htmlspecialchars($product['category_name'] ?? 'Uncategorized'); ?></td>
                                        <td class="price">R<?php echo number_format($product['price'] ?? 0, 2); ?></td>
                                        <td>
                                            <span class="<?php echo ($product['stock_quantity'] ?? 0) < 10 ? 'stock-low' : 'stock-ok'; ?>">
                                                <?php echo $product['stock_quantity'] ?? 0; ?>
                                            </span>
                                        </td>
                                        <td>
                                            <?php if (($product['rating'] ?? 0) > 0): ?>
                                                <div class="rating-stars">
                                                    <i class="fas fa-star"></i>
                                                    <?php echo number_format($product['rating'], 1); ?>
                                                </div>
                                            <?php else: ?>
                                                <span style="color: #bdc3c7;">No ratings</span>
                                            <?php endif; ?>
                                        </td>
                                        <td>
                                            <div class="action-buttons">
                                                <button class="btn btn-edit btn-sm" onclick="editProduct(<?php echo $product['id'] ?? 0; ?>)">
                                                    <i class="fas fa-edit"></i>
                                                </button>
                                                <button class="btn btn-danger btn-sm" onclick="deleteProduct(<?php echo $product['id'] ?? 0; ?>, '<?php echo htmlspecialchars($product['name'] ?? ''); ?>')">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                <?php endforeach; ?>
                            </tbody>
                        </table>
                    </div>
                <?php endif; ?>
            </div>

            <!-- Add/Edit Product Form -->
            <div class="form-section">
                <div class="section-header">
                    <h2 id="form-title"><i class="fas fa-plus"></i> Add New Product</h2>
                </div>
                
                <form id="productForm" method="POST">
                    <input type="hidden" name="action" id="formAction" value="add">
                    <input type="hidden" name="product_id" id="productId">
                    
                    <div class="form-group">
                        <label class="form-label" for="name">Product Name *</label>
                        <input type="text" id="name" name="name" class="form-control" required maxlength="255">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="description">Description</label>
                        <textarea id="description" name="description" class="form-control" rows="3" maxlength="1000"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="price">Price (R) *</label>
                        <input type="number" id="price" name="price" class="form-control" step="0.01" min="0.01" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="category_id">Category</label>
                        <select id="category_id" name="category_id" class="form-control">
                            <option value="">Select Category</option>
                            <?php foreach ($categories as $category): ?>
                                <option value="<?php echo $category['id']; ?>">
                                    <?php echo htmlspecialchars($category['name']); ?>
                                </option>
                            <?php endforeach; ?>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="stock_quantity">Stock Quantity *</label>
                        <input type="number" id="stock_quantity" name="stock_quantity" class="form-control" min="0" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="image">Image URL (Optional)</label>
                        <input type="text" id="image" name="image" class="form-control" placeholder="product-image.jpg" maxlength="500">
                        <small style="color: #7f8c8d; font-size: 0.85em;">Icons will be used instead of images for product display</small>
                    </div>
                    
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Save Product
                        </button>
                        <button type="button" class="btn" onclick="resetForm()" style="background: #95a5a6; color: white;">
                            <i class="fas fa-times"></i> Cancel
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        function showAddForm() {
            document.getElementById('form-title').innerHTML = '<i class="fas fa-plus"></i> Add New Product';
            document.getElementById('formAction').value = 'add';
            document.getElementById('productId').value = '';
            document.getElementById('productForm').reset();
        }
        
        function editProduct(productId) {
            // Use the table-based approach since get-product.php might not exist
            const buttons = document.querySelectorAll(`button[onclick="editProduct(${productId})"]`);
            if (buttons.length === 0) {
                alert('Could not find product data. Please refresh the page and try again.');
                return;
            }
            
            const productRow = buttons[0].closest('tr');
            if (productRow) {
                const cells = productRow.cells;
                
                // Get category name from the table
                const categoryName = cells[2].textContent.trim();
                
                // Find the corresponding category ID from the dropdown
                const categorySelect = document.getElementById('category_id');
                let categoryId = '';
                for (let option of categorySelect.options) {
                    if (option.text === categoryName) {
                        categoryId = option.value;
                        break;
                    }
                }
                
                // Get product name and description
                const nameElement = cells[1].querySelector('strong');
                const descriptionElement = cells[1].querySelector('small');
                
                // Get price (remove 'R' and convert to number)
                const priceText = cells[3].textContent.replace('R', '').trim();
                
                // Get stock quantity
                const stockElement = cells[4].querySelector('span');
                
                // Populate form with existing data
                document.getElementById('form-title').innerHTML = '<i class="fas fa-edit"></i> Edit Product';
                document.getElementById('formAction').value = 'edit';
                document.getElementById('productId').value = productId;
                document.getElementById('name').value = nameElement ? nameElement.textContent.trim() : '';
                
                // For description, remove the trailing '...' if present
                let description = '';
                if (descriptionElement) {
                    description = descriptionElement.textContent.trim();
                    if (description.endsWith('...')) {
                        description = description.slice(0, -3);
                    }
                }
                document.getElementById('description').value = description;
                
                document.getElementById('price').value = parseFloat(priceText).toFixed(2);
                document.getElementById('category_id').value = categoryId;
                document.getElementById('stock_quantity').value = stockElement ? parseInt(stockElement.textContent) : 0;
                
                // Note: Image URL cannot be retrieved from the table, so it will be empty
                document.getElementById('image').value = '';
                
                // Scroll to form
                document.querySelector('.form-section').scrollIntoView({ behavior: 'smooth' });
            } else {
                alert('Could not find product data. Please refresh the page and try again.');
            }
        }
        
        function deleteProduct(productId, productName) {
            if (confirm('Are you sure you want to delete "' + productName + '"?')) {
                window.location.href = 'manage-products.php?action=delete&product_id=' + productId;
            }
        }
        
        function resetForm() {
            showAddForm();
        }
        
        // Form validation
        document.getElementById('productForm').addEventListener('submit', function(e) {
            const price = parseFloat(document.getElementById('price').value);
            const stock = parseInt(document.getElementById('stock_quantity').value);
            const name = document.getElementById('name').value.trim();
            
            if (!name) {
                alert('Product name is required.');
                e.preventDefault();
                return;
            }
            
            if (price <= 0) {
                alert('Price must be greater than 0.');
                e.preventDefault();
                return;
            }
            
            if (stock < 0) {
                alert('Stock quantity cannot be negative.');
                e.preventDefault();
                return;
            }
        });

        // Preview icon based on category selection
        document.getElementById('category_id').addEventListener('change', function() {
            const categoryName = this.options[this.selectedIndex].text.toLowerCase();
            // You could add a live preview of the icon here if needed
        });
    </script>
</body>
</html>

--- File: views\cart\cart-remove.php ---
<?php
session_start();
require_once '../../config/config.php';

header('Content-Type: application/json');

// Simple removal logic
if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_POST['item_id'])) {
    $item_id = $_POST['item_id'];
    
    // Remove item
    if (isset($_SESSION['cart']) && is_array($_SESSION['cart'])) {
        $_SESSION['cart'] = array_filter($_SESSION['cart'], function($item) use ($item_id) {
            return isset($item['id']) && $item['id'] != $item_id;
        });
        $_SESSION['cart'] = array_values($_SESSION['cart']); // Re-index
    }
    
    // Calculate total
    $total = 0;
    $count = 0;
    if (isset($_SESSION['cart'])) {
        foreach ($_SESSION['cart'] as $item) {
            if (isset($item['price']) && isset($item['quantity'])) {
                $total += $item['price'] * $item['quantity'];
            }
        }
        $count = count($_SESSION['cart']);
    }
    
    echo json_encode([
        'success' => true,
        'cart_total' => number_format($total, 2),
        'cart_count' => $count
    ]);
} else {
    echo json_encode([
        'success' => false,
        'error' => 'Invalid request'
    ]);
}
exit;
?>

--- File: views\cart\cart.php ---
<?php
/**
 * SmartRetail - Shopping Cart
 * Modern, responsive cart page with order summary
 */

session_start();

require_once '../../config/config.php';
require_once '../../config/database.php';
require_once '../../utils/Auth.php';
require_once '../../models/Order.php';
require_once '../../models/User.php';

// Require authentication
Auth::requireAuth();

// Get user information
$user_id = Auth::getUserId();
$username = $_SESSION['username'];
$full_name = $_SESSION['full_name'];
$email = $_SESSION['email'];

// Initialize database connection
try {
    $database = new Database();
    $db = $database->getConnection();
    $orderModel = new Order($db);
    $userModel = new User($db);
} catch (Exception $e) {
    error_log("Database connection failed: " . $e->getMessage());
}

// Initialize cart in session if not exists
if (!isset($_SESSION['cart'])) {
    $_SESSION['cart'] = [];
}

// Get cart items from session
$cart_items = $_SESSION['cart'];
$cart_total = 0;
$cart_count = count($cart_items);

// Map product names to icons
$product_icons = [
    'Wireless Headphones' => 'fas fa-headphones',
    'Smart Watch' => 'fas fa-clock',
    'Laptop Backpack' => 'fas fa-briefcase',
    'Bluetooth Speaker' => 'fas fa-volume-up',
    'Gaming Mouse' => 'fas fa-mouse',
    'USB-C Hub' => 'fas fa-plug',
    'Product' => 'fas fa-box' // Default icon
];

// Calculate total and ensure we have proper data structure
foreach ($cart_items as &$item) {
    if (!isset($item['quantity'])) {
        $item['quantity'] = 1;
    }
    if (isset($item['price'])) {
        $cart_total += $item['price'] * $item['quantity'];
    }
    
    // Ensure all required fields exist for display
    $item['id'] = $item['id'] ?? uniqid();
    $item['name'] = $item['name'] ?? 'Product';
    $item['price'] = $item['price'] ?? 0;
    $item['icon'] = $product_icons[$item['name']] ?? $product_icons['Product'];
    $item['stock_quantity'] = $item['stock_quantity'] ?? 10;
}

// Handle cart actions
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    error_log("=== POST REQUEST RECEIVED ===");
    error_log("POST data: " . print_r($_POST, true));
    
    if (isset($_POST['update_quantity']) && isset($_POST['item_id']) && isset($_POST['action'])) {
        $item_id = $_POST['item_id'];
        $action = $_POST['action'];
        
        error_log("Updating quantity for item: $item_id, action: $action");
        
        // Handle increase/decrease actions - USE CONSISTENT 'id' FIELD
        foreach ($_SESSION['cart'] as &$item) {
            if ($item['id'] == $item_id) { // Only check 'id' field
                if ($action === 'increase') {
                    $item['quantity'] = min($item['quantity'] + 1, $item['stock_quantity'] ?? 10);
                    error_log("Increased quantity to: " . $item['quantity']);
                } elseif ($action === 'decrease') {
                    $item['quantity'] = max($item['quantity'] - 1, 1);
                    error_log("Decreased quantity to: " . $item['quantity']);
                }
                break;
            }
        }
        
        $_SESSION['cart'] = array_values($_SESSION['cart']);
        header('Location: cart.php?updated=1');
        exit;
        
    } elseif (isset($_POST['remove_item']) && isset($_POST['item_id'])) {
        session_start();
        $item_id = $_POST['item_id'];

        error_log("=== REMOVING ITEM ===");
        error_log("Item ID to remove: $item_id");
        error_log("Cart before removal: " . print_r($_SESSION['cart'], true));

        // Remove item - USE CONSISTENT 'id' FIELD
        $_SESSION['cart'] = array_values(array_filter($_SESSION['cart'], function ($item) use ($item_id) {
            return $item['id'] == $item_id; // Only check 'id' field
        }));

        error_log("Cart after removal: " . print_r($_SESSION['cart'], true));

        header('Location: ' . $_SERVER['PHP_SELF'] . '?removed=1');
        exit;  
    }
}

// Handle checkout
if (isset($_GET['checkout']) && !empty($cart_items)) {
    // Debug: Check what we're passing to checkout
    error_log("=== CHECKOUT INITIATED ===");
    error_log("Cart items count: " . count($cart_items));
    error_log("Cart total: R" . $cart_total);
    error_log("Session ID: " . session_id());
    
    // Simply redirect to checkout page - cart data is in session
    header('Location: checkout.php');
    exit;
}

?>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shopping Cart - SmartRetail</title>
    <link rel="stylesheet" href="../../assets/css/style.css">
    
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <!-- Mobile Navigation Toggle -->
                <button class="mobile-nav-toggle" id="mobileNavToggle">
                    <i class="fas fa-bars"></i>
                    <span class="logo">
                        <i class="fas fa-store"></i>
                        SmartRetail
                    </span>
                </button>
            
                <!-- Desktop Logo (hidden on mobile) -->
                <a href="/" class="logo desktop-logo">
                    <i class="fas fa-store"></i>
                    SmartRetail
                </a>
                
                <!-- Navigation -->
                <nav>
                    <ul class="nav-links">
                        <li><a href="../products/products.php">Products</a></li>
                        <li><a href="../categories/category.php">Categories</a></li>
                        <li><a href="../../dashboard.php">Dashboard</a></li>
                    </ul>
                </nav>
                
                <!-- Header Actions -->
                <div class="header-actions">    
                    <!-- Shopping Cart -->
                    <a href="../cart/cart.php" class="cart-icon" title="Shopping Cart">
                        <i class="fas fa-shopping-cart"></i>
                        <?php if ($cart_count > 0): ?>
                            <span class="cart-count"><?php echo $cart_count; ?></span>
                        <?php endif; ?>
                    </a>
                    
                    <!-- User Dropdown Menu -->
                    <div class="user-menu">
                        <button class="btn btn-outline" id="userMenuButton" style="display: flex; align-items: center; gap: 0.5rem;">
                            <i class="fas fa-user"></i>
                            <?php echo htmlspecialchars($username); ?>
                            <i class="fas fa-chevron-down" style="font-size: 0.75rem;"></i>
                        </button>
                        
                        <div class="user-dropdown" id="userDropdown">
                            <div class="user-dropdown-header">
                                <div class="username"><?php echo htmlspecialchars($full_name); ?></div>
                                <div class="email"><?php echo htmlspecialchars($email); ?></div>
                                <div class="role"><?php echo ucfirst($_SESSION['role'] ?? 'User'); ?> Account</div>
                            </div>
                            
                            <div class="user-dropdown-links">
                                <a href="../order/orders.php" class="user-dropdown-link">
                                    <i class="fas fa-shopping-bag"></i>
                                    My Orders
                                </a>
                                
                                <?php if (Auth::hasRole('admin') || Auth::hasRole('staff')): ?>
                                    <div class="user-dropdown-divider"></div>
                                    <a href="views/admin/admin-dashboard.php" class="user-dropdown-link">
                                        <i class="fas fa-cog"></i>
                                        Admin Panel
                                    </a>
                                <?php endif; ?>
                                
                                <div class="user-dropdown-divider"></div>
                                <a href="../../logout.php" class="user-dropdown-link logout">
                                    <i class="fas fa-sign-out-alt"></i>
                                    Logout
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Mobile Navigation -->
    <div class="mobile-nav" id="mobileNav">
        <div class="mobile-nav-sidebar">
            <!-- Single Line Header -->
            <div class="mobile-nav-header">
                <div class="mobile-nav-brand">
                    <i class="fas fa-store"></i>
                    <span>SmartRetail</span>
                </div>
                <button class="mobile-nav-close" id="mobileNavClose">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <!-- User Info -->
            <div class="mobile-nav-user">
                <div class="mobile-nav-user-avatar">
                    <?php echo strtoupper(substr($full_name, 0, 1)); ?>
                </div>
                <div class="mobile-nav-user-info">
                    <div class="username"><?php echo htmlspecialchars($full_name); ?></div>
                    <div class="email"><?php echo htmlspecialchars($email); ?></div>
                    <div class="role"><?php echo ucfirst($_SESSION['role'] ?? 'User'); ?></div>
                </div>
            </div>

            <!-- Navigation Links -->
            <div class="mobile-nav-content">
                <ul class="mobile-nav-links">
                    <li><a href="dashboard.php" class="active">
                        <i class="fas fa-home"></i>
                        Dashboard
                    </a></li>
                    <li><a href="../products/products.php">
                        <i class="fas fa-shopping-bag"></i>
                        All Products
                    </a></li>
                    <li><a href="../categories/category.php">
                        <i class="fas fa-list"></i>
                        Categories
                    </a></li>
                    <li><a href="../order/orders.php">
                        <i class="fas fa-receipt"></i>
                        My Orders
                    </a></li>
                
                    <?php if (Auth::hasRole('admin') || Auth::hasRole('staff')): ?>
                        <div class="mobile-nav-divider"></div>
                        <li><a href="views/admin/admin-dashboard.php">
                            <i class="fas fa-cog"></i>
                            Admin Panel
                        </a></li>
                    <?php endif; ?>
                
                    <div class="mobile-nav-divider"></div>
                    <li><a href="../../logout.php" class="logout-link">
                        <i class="fas fa-sign-out-alt"></i>
                        Logout
                    </a></li>
                </ul>
            </div>

            <!-- Cart Summary -->
            <div class="mobile-nav-footer">
                <a href="views/cart/cart.php" class="mobile-nav-cart">
                    <div class="mobile-nav-cart-info">
                        <div class="mobile-nav-cart-label">Shopping Cart</div>
                    <div class="mobile-nav-cart-count">
                            <?php echo $cart_count; ?> item<?php echo $cart_count !== 1 ? 's' : ''; ?>
                        </div>
                    </div>
                    <div class="mobile-nav-cart-icon">
                        <i class="fas fa-shopping-cart"></i>
                        <?php if ($cart_count > 0): ?>
                            <span class="mobile-nav-cart-badge"><?php echo $cart_count; ?></span>
                        <?php endif; ?>
                    </div>
                </a>
            </div>
        </div>
    </div>

    <!-- Cart Page -->
    <section class="cart-page">
        <div class="container">
            <div class="page-header">
                <h1>Shopping Cart</h1>
                <p>Review your items and proceed to checkout</p>
            </div>

            <?php if (!empty($cart_items)): ?>
                <div class="cart-content">
                    <!-- Cart Items -->
                    <div class="cart-items">
                            <?php foreach ($cart_items as $item): ?>
                            <div class="cart-item" data-item-id="<?php echo $item['id']; ?>">
                                <div class="item-icon">
                                    <i class="<?php echo $item['icon']; ?>"></i>
                                </div>
                                <div class="item-details">
                                    <h3 class="item-name"><?php echo htmlspecialchars($item['name']); ?></h3>
                                    <div class="item-price">R<?php echo number_format($item['price'], 2); ?></div>
                                    <div class="item-stock">
                                        <i class="fas fa-check-circle"></i>
                                        <?php echo $item['stock_quantity']; ?> in stock
                                    </div>
                                <div class="item-actions">
                                <!-- Quantity Update Form -->
                                <form method="POST" class="quantity-selector">
                                    <input type="hidden" name="update_quantity" value="1">
                                    <input type="hidden" name="item_id" value="<?php echo $item['id']; ?>">
                                    <button type="submit" name="action" value="decrease" class="quantity-btn">
                                        <i class="fas fa-minus"></i>
                                    </button>
                                    <span class="quantity-display" style="padding: 0.5rem; min-width: 60px; text-align: center; display: inline-block; border: 1px solid var(--border-color); border-radius: 0.375rem;">
                                        <?php echo $item['quantity']; ?>
                                    </span>
                                    <button type="submit" name="action" value="increase" class="quantity-btn">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </form>

                                <!-- Remove Form -->
                                <form class="remove-form" onsubmit="removeFromCart(event, '<?php echo $item['id']; ?>')">
                                    <input type="hidden" name="item_id" value="<?php echo $item['id']; ?>">
                                    <button type="submit" class="remove-btn">
                                        <i class="fas fa-trash"></i>
                                        <span>Remove</span>
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                    <?php endforeach; ?>
    
                    <!-- Continue Shopping -->
                    <div class="continue-shopping">
                        <a href="../../dashboard.php" class="btn btn-outline">
                            <i class="fas fa-arrow-left"></i>
                                Continue Shopping
                            </a>
                        </div>
                    </div>    

                    <!-- Order Summary -->
                    <div class="order-summary">
                        <h2 class="summary-header">Order Summary</h2>
                        
                        <div class="summary-row">
                            <span class="summary-label">Subtotal:</span>
                            <span class="summary-value">R<?php echo number_format($cart_total, 2); ?></span>
                        </div>
                        
                        <div class="summary-row">
                            <span class="summary-label">Shipping:</span>
                            <span class="summary-value">Free</span>
                        </div>
                        
                        <div class="summary-row">
                            <span class="summary-label">Total:</span>
                            <span class="summary-value summary-total">R<?php echo number_format($cart_total, 2); ?></span>
                        </div>

                        <div class="shipping-note">
                            <i class="fas fa-shipping-fast"></i>
                            Free shipping on all orders
                        </div>

                        <a href="?checkout=1" class="btn btn-primary checkout-btn" onclick="return confirm('Proceed to checkout?')">
                            <i class="fas fa-lock"></i>
                            Proceed to Checkout
                        </a>
                    </div>
                </div>
            <?php else: ?>
                <!-- Empty Cart -->
                <div class="empty-cart">
                    <div class="empty-cart-icon">
                        <i class="fas fa-shopping-cart"></i>
                    </div>
                    <h2>Your cart is empty</h2>
                    <p>Looks like you haven't added any items to your cart yet.</p>
                    <a href="../products/products.php" class="btn btn-primary">
                        <i class="fas fa-shopping-bag"></i>
                        Start Shopping
                    </a>
                </div>
            <?php endif; ?>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <!-- About Section -->
                <div class="footer-section">
                    <h3>About SmartRetail</h3>
                    <p>Your trusted destination for quality products and exceptional service.</p>
                    <div class="social-links">
                        <a href="#"><i class="fab fa-facebook"></i></a>
                        <a href="#"><i class="fab fa-twitter"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                        <a href="#"><i class="fab fa-linkedin"></i></a>
                    </div>
                </div>

                <!-- Customer Service -->
                <div class="footer-section">
                    <h3>Customer Service</h3>
                    <ul class="footer-links">
                        <li><a href="/contact">Contact Us</a></li>
                        <li><a href="/shipping">Shipping Info</a></li>
                        <li><a href="/returns">Returns</a></li>
                        <li><a href="/faq">FAQ</a></li>
                    </ul>
                </div>

                <!-- Quick Links -->
                <div class="footer-section">
                    <h3>Quick Links</h3>
                    <ul class="footer-links">
                        <li><a href="/views/user/profile.php">My Account</a></li>
                        <li><a href="/views/order/orders.php">Order History</a></li>
                        <li><a href="/views/user/wishlist.php">Wishlist</a></li>
                        <li><a href="/track-order">Track Order</a></li>
                    </ul>
                </div>

                <!-- Newsletter -->
                <div class="footer-section">
                    <h3>Newsletter</h3>
                    <p>Subscribe for exclusive deals and updates</p>
                    <form class="newsletter-form" onsubmit="subscribeNewsletter(event)">
                        <input type="email" class="newsletter-input" placeholder="Your email" required>
                        <button type="submit" class="btn btn-primary">Subscribe</button>
                    </form>
                </div>
            </div>

            <div class="footer-bottom">
                <p>&copy; <?php echo date('Y'); ?> SmartRetail System. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- JavaScript -->
    <script src="../../assets/js/cart.js"></script>
    <script src="../../assets/js/enhanced-features.js"></script>
    <script src="../../assets/js/enhanced-features.js"></script>
    <script src="../../assets/js/dynamic-cart.js"></script>
</body>
</html>

--- File: views\cart\checkout.php ---
<?php
/**
 * SmartRetail - Checkout Page
 * Gets items from cart session and displays order summary
 */

// Start session if not already started
if (session_status() === PHP_SESSION_NONE) {
    session_start();
}

require_once '../../config/config.php';
require_once '../../utils/Auth.php';

// Require authentication
Auth::requireAuth();

// Initialize cart if not exists
if (!isset($_SESSION['cart'])) {
    $_SESSION['cart'] = [];
}

// Get cart items from session
$cart_items = $_SESSION['cart'];
$cart_total = 0;

// Calculate total from actual cart items and ensure proper structure
if (!empty($cart_items)) {
    foreach ($cart_items as &$item) {
        // Ensure all required fields exist with proper structure
        $item['id'] = $item['id'] ?? $item['product_id'] ?? uniqid();
        $item['product_id'] = $item['product_id'] ?? $item['id'] ?? uniqid();
        $item['name'] = $item['name'] ?? 'Product';
        $item['price'] = $item['price'] ?? 0;
        $item['quantity'] = $item['quantity'] ?? 1;
        $item['icon'] = $item['icon'] ?? 'fas fa-box';
        $item['stock_quantity'] = $item['stock_quantity'] ?? 10;
        
        // Calculate item total
        $cart_total += $item['price'] * $item['quantity'];
    }
}

// If cart is empty, redirect to cart page
if (empty($cart_items)) {
    header('Location: cart.php');
    exit;
}
?>
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SmartRetail - Checkout</title>
<style>
    body {
        font-family: "Inter", sans-serif;
        background: #f9fafb;
        color: #1f2937;
        margin: 0;
        padding: 0;
    }
    header {
        background: white;
        border-bottom: 1px solid #e5e7eb;
        padding: 1rem 2rem;
        font-size: 1.25rem;
        font-weight: 600;
        color: #0284c7;
    }
    .checkout-container {
        max-width: 1200px;
        margin: 2rem auto;
        display: grid;
        grid-template-columns: 1fr 380px;
        gap: 2rem;
        padding: 0 1rem;
    }
    .section {
        background: white;
        border: 1px solid #e5e7eb;
        border-radius: 0.75rem;
        padding: 2rem;
    }
    .section h2 {
        font-size: 1.25rem;
        font-weight: 600;
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        color: #111827;
    }
    .form-group {
        margin-bottom: 1rem;
    }
    .form-label {
        display: block;
        font-weight: 500;
        margin-bottom: 0.25rem;
    }
    .form-input, textarea {
        width: 100%;
        padding: 0.5rem 0.75rem;
        border: 1px solid #d1d5db;
        border-radius: 0.375rem;
        font-size: 1rem;
    }
    .form-input:focus, textarea:focus {
        outline: none;
        border-color: #0284c7;
        box-shadow: 0 0 0 2px rgba(2, 132, 199, 0.2);
    }
    .payment-methods {
        display: flex;
        gap: 1rem;
        margin-top: 1rem;
    }
    .payment-method {
        flex: 1;
        border: 2px solid #e5e7eb;
        border-radius: 0.5rem;
        text-align: center;
        padding: 1rem;
        cursor: pointer;
        transition: 0.3s;
    }
    .payment-method:hover {
        border-color: #0284c7;
    }
    .payment-method.selected {
        border-color: #0284c7;
        background: #f0f9ff;
    }
    .order-summary {
        border: 1px solid #e5e7eb;
        border-radius: 0.75rem;
        background: white;
        padding: 2rem;
        height: fit-content;
    }
    .order-item {
        display: flex;
        justify-content: space-between;
        margin-bottom: 0.75rem;
        padding-bottom: 0.75rem;
        border-bottom: 1px solid #f3f4f6;
    }
    .order-item:last-child {
        border-bottom: none;
    }
    .order-total {
        border-top: 1px solid #e5e7eb;
        margin-top: 1rem;
        padding-top: 1rem;
        font-size: 1.125rem;
        font-weight: 600;
        display: flex;
        justify-content: space-between;
    }
    .btn-submit {
        width: 100%;
        background: #0284c7;
        color: white;
        border: none;
        border-radius: 0.5rem;
        padding: 0.75rem;
        font-size: 1rem;
        font-weight: 500;
        cursor: pointer;
        transition: background 0.3s;
    }
    .btn-submit:hover {
        background: #0369a1;
    }
    .btn-submit:disabled {
        background: #9ca3af;
        cursor: not-allowed;
    }
</style>
</head>
<body>
<header>
    SmartRetail - Checkout
</header>

<div class="checkout-container">
    <!-- Shipping Section -->
    <div class="section">
        <h2>📦 Shipping Address</h2>
        <form id="shippingForm">
            <div class="form-group">
                <label class="form-label">Full Name</label>
                <input type="text" name="shipping_name" class="form-input" required value="<?php echo htmlspecialchars($_SESSION['full_name'] ?? ''); ?>">
            </div>
            <div class="form-group">
                <label class="form-label">Email</label>
                <input type="email" name="shipping_email" class="form-input" required value="<?php echo htmlspecialchars($_SESSION['email'] ?? ''); ?>">
            </div>
            <div class="form-group">
                <label class="form-label">Street Address</label>
                <textarea name="shipping_address" rows="2" class="form-input" required placeholder="Enter your full street address"></textarea>
            </div>
            <div class="form-group">
                <label class="form-label">City</label>
                <input type="text" name="shipping_city" class="form-input" required placeholder="Enter your city">
            </div>
            <div class="form-group">
                <label class="form-label">Postal Code</label>
                <input type="text" name="shipping_postal_code" class="form-input" required placeholder="Enter postal code">
            </div>
        </form>

        <h2 style="margin-top:2rem;">💳 Payment Method</h2>
        <div class="payment-methods">
            <div class="payment-method selected" data-method="credit_card">Credit/Debit Card</div>
            <div class="payment-method" data-method="cash">Cash on Delivery</div>
        </div>

        <!-- Credit Card Inputs -->
        <div id="creditCardForm" style="margin-top:1rem;">
            <div class="form-group">
                <label class="form-label">Card Number</label>
                <input type="text" class="form-input" placeholder="1234 5678 9012 3456" required>
            </div>
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:1rem;">
                <div class="form-group">
                    <label class="form-label">Expiry Date</label>
                    <input type="text" class="form-input" placeholder="MM/YY" required>
                </div>
                <div class="form-group">
                    <label class="form-label">CVV</label>
                    <input type="text" class="form-input" placeholder="123" required>
                </div>
            </div>
        </div>
    </div>

    <!-- Order Summary -->
    <div class="order-summary">
        <h2>🧾 Order Summary</h2>
        <?php if (!empty($cart_items)): ?>
            <?php foreach ($cart_items as $item): ?>
                <div class="order-item">
                    <span><?php echo htmlspecialchars($item['name']); ?> x<?php echo $item['quantity']; ?></span>
                    <span>R<?php echo number_format($item['price'] * $item['quantity'], 2); ?></span>
                </div>
            <?php endforeach; ?>
        <?php else: ?>
            <div class="order-item">
                <span>No items in cart</span>
            </div>
        <?php endif; ?>

        <div class="order-total">
            <span>Total:</span>
            <span id="total">R<?php echo number_format($cart_total, 2); ?></span>
        </div>

        <button id="placeOrderBtn" class="btn-submit" style="margin-top:1.5rem;">
            Place Order - R<?php echo number_format($cart_total, 2); ?>
        </button>
        
        <div style="text-align: center; margin-top: 1rem;">
            <a href="cart.php" style="color: #0284c7; text-decoration: none;">← Return to Cart</a>
        </div>
    </div>
</div>

<script src="../../assets/js/enhanced-features.js"></script>
<script>
// Payment method toggle
document.querySelectorAll('.payment-method').forEach(method => {
    method.addEventListener('click', function() {
        document.querySelectorAll('.payment-method').forEach(m => m.classList.remove('selected'));
        this.classList.add('selected');
        const ccForm = document.getElementById('creditCardForm');
        const inputs = ccForm.querySelectorAll('input');
        
        if (this.dataset.method === 'credit_card') {
            ccForm.style.display = 'block';
            inputs.forEach(input => input.required = true);
        } else {
            ccForm.style.display = 'none';
            inputs.forEach(input => input.required = false);
        }
    });
});

// Form submission
document.getElementById('placeOrderBtn').addEventListener('click', function() {
    const shippingForm = document.getElementById('shippingForm');
    const selectedPayment = document.querySelector('.payment-method.selected').dataset.method;
    
    // Validate shipping form
    if (!shippingForm.checkValidity()) {
        alert('Please fill in all required shipping information.');
        return;
    }
    
    // Validate credit card if selected
    if (selectedPayment === 'credit_card') {
        const cardInputs = document.querySelectorAll('#creditCardForm input');
        for (let input of cardInputs) {
            if (!input.value.trim()) {
                alert('Please fill in all credit card details.');
                return;
            }
        }
    }
    
    // Show loading state
    this.innerHTML = 'Processing Order...';
    this.disabled = true;
    
    // Simulate order processing
    setTimeout(() => {
        alert('Order placed successfully! Thank you for your purchase.');
        // In a real application, you would submit the form to a server endpoint
        window.location.href = 'order-success.php';
    }, 2000);
});

// Initialize payment method on page load
document.addEventListener('DOMContentLoaded', function() {
    // Set credit card as default selected
    document.querySelector('.payment-method[data-method="credit_card"]').click();
});
</script>
</body>
</html>

--- File: views\cart\order-success.php ---
<?php
/**
 * SmartRetail - Order Success Page
 * Displays order confirmation and thank you message
 */

// Start session if not already started
if (session_status() === PHP_SESSION_NONE) {
    session_start();
}

require_once '../../config/config.php';
require_once '../../utils/Auth.php';

// Require authentication
Auth::requireAuth();

// Get user information
$user_id = Auth::getUserId();
$username = $_SESSION['username'];
$full_name = $_SESSION['full_name'];
$email = $_SESSION['email'];

// Generate a fake order ID for demo purposes
$order_id = 'SR-' . strtoupper(uniqid());
$order_date = date('F j, Y \a\t g:i A');
$estimated_delivery = date('F j, Y', strtotime('+3 days'));

// Clear the cart after successful order
if (isset($_SESSION['cart'])) {
    $ordered_items = $_SESSION['cart']; // Store items for display before clearing
    $_SESSION['cart'] = [];
} else {
    $ordered_items = [];
}

// Calculate order total
$order_total = 0;
foreach ($ordered_items as $item) {
    $order_total += $item['price'] * $item['quantity'];
}
?>
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Order Successful - SmartRetail</title>
<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    :root {
        --primary-color: #28ACD8;
        --primary-dark: #1d4ed8;
        --secondary-color: #64748b;
        --success-color: #10b981;
        --light-bg: #f8fafc;
        --text-dark: #334155;
        --text-light: #64748b;
        --border-color: #e2e8f0;
    }

    body {
        font-family: 'Inter', sans-serif;
        line-height: 1.6;
        color: var(--text-dark);
        background-color: var(--light-bg);
    }

    .container {
        max-width: 800px;
        margin: 0 auto;
        padding: 0 20px;
    }

    /* Success Page Styles */
    .success-page {
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 2rem 0;
    }

    .success-card {
        background: white;
        border-radius: 1rem;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        padding: 3rem;
        text-align: center;
        width: 100%;
    }

    .success-icon {
        width: 80px;
        height: 80px;
        background: var(--success-color);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 2rem;
        font-size: 2.5rem;
        color: white;
    }

    .success-title {
        font-size: 2.5rem;
        font-weight: 700;
        color: var(--text-dark);
        margin-bottom: 1rem;
    }

    .success-message {
        font-size: 1.125rem;
        color: var(--text-light);
        margin-bottom: 2rem;
        line-height: 1.8;
    }

    .order-details {
        background: var(--light-bg);
        border-radius: 0.75rem;
        padding: 2rem;
        margin: 2rem 0;
        text-align: left;
    }

    .order-details h3 {
        font-size: 1.25rem;
        font-weight: 600;
        margin-bottom: 1.5rem;
        color: var(--text-dark);
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .detail-row {
        display: flex;
        justify-content: space-between;
        margin-bottom: 1rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid var(--border-color);
    }

    .detail-row:last-child {
        border-bottom: none;
        margin-bottom: 0;
        padding-bottom: 0;
    }

    .detail-label {
        color: var(--text-light);
        font-weight: 500;
    }

    .detail-value {
        color: var(--text-dark);
        font-weight: 600;
    }

    .order-items {
        margin-top: 1.5rem;
    }

    .order-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem 0;
        border-bottom: 1px solid var(--border-color);
    }

    .order-item:last-child {
        border-bottom: none;
    }

    .item-info {
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    .item-icon {
        width: 40px;
        height: 40px;
        background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
        border-radius: 0.5rem;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1.25rem;
    }

    .item-name {
        font-weight: 500;
    }

    .item-quantity {
        color: var(--text-light);
        font-size: 0.875rem;
    }

    .item-total {
        font-weight: 600;
        color: var(--primary-color);
    }

    .order-total {
        background: white;
        border: 2px solid var(--primary-color);
        border-radius: 0.75rem;
        padding: 1.5rem;
        margin: 2rem 0;
        text-align: center;
    }

    .total-label {
        font-size: 1rem;
        color: var(--text-light);
        margin-bottom: 0.5rem;
    }

    .total-amount {
        font-size: 2rem;
        font-weight: 700;
        color: var(--primary-color);
    }

    .action-buttons {
        display: flex;
        gap: 1rem;
        justify-content: center;
        margin-top: 2rem;
        flex-wrap: wrap;
    }

    .btn {
        padding: 0.75rem 1.5rem;
        border: none;
        border-radius: 0.5rem;
        font-weight: 500;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        cursor: pointer;
        transition: all 0.3s;
        font-size: 0.875rem;
    }

    .btn-primary {
        background: var(--primary-color);
        color: white;
    }

    .btn-primary:hover {
        background: var(--primary-dark);
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(37, 99, 235, 0.2);
    }

    .btn-outline {
        border: 1px solid var(--border-color);
        background: white;
        color: var(--text-dark);
    }

    .btn-outline:hover {
        border-color: var(--primary-color);
        color: var(--primary-color);
    }

    .delivery-info {
        background: #f0f9ff;
        border: 1px solid #bae6fd;
        border-radius: 0.75rem;
        padding: 1.5rem;
        margin: 2rem 0;
        text-align: center;
    }

    .delivery-icon {
        font-size: 2rem;
        color: var(--primary-color);
        margin-bottom: 1rem;
    }

    .delivery-text {
        color: var(--text-dark);
        font-weight: 500;
    }

    .delivery-date {
        color: var(--primary-color);
        font-weight: 700;
        font-size: 1.125rem;
        margin-top: 0.5rem;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
        .success-card {
            padding: 2rem 1.5rem;
            margin: 1rem;
        }

        .success-title {
            font-size: 2rem;
        }

        .action-buttons {
            flex-direction: column;
        }

        .btn {
            width: 100%;
            justify-content: center;
        }

        .detail-row {
            flex-direction: column;
            gap: 0.5rem;
        }
    }
</style>
</head>
<body>
    <div class="success-page">
        <div class="container">
            <div class="success-card">
                <!-- Success Icon -->
                <div class="success-icon">
                    <i class="fas fa-check"></i>
                </div>

                <!-- Success Title & Message -->
                <h1 class="success-title">Order Confirmed!</h1>
                <p class="success-message">
                    Thank you for your purchase, <?php echo htmlspecialchars($full_name); ?>! Your order has been successfully placed and is being processed.
                </p>

                <!-- Order Details -->
                <div class="order-details">
                    <h3><i class="fas fa-receipt"></i> Order Information</h3>
                    
                    <div class="detail-row">
                        <span class="detail-label">Order Number:</span>
                        <span class="detail-value"><?php echo $order_id; ?></span>
                    </div>
                    
                    <div class="detail-row">
                        <span class="detail-label">Order Date:</span>
                        <span class="detail-value"><?php echo $order_date; ?></span>
                    </div>
                    
                    <div class="detail-row">
                        <span class="detail-label">Customer:</span>
                        <span class="detail-value"><?php echo htmlspecialchars($full_name); ?></span>
                    </div>
                    
                    <div class="detail-row">
                        <span class="detail-label">Email:</span>
                        <span class="detail-value"><?php echo htmlspecialchars($email); ?></span>
                    </div>

                    <!-- Ordered Items -->
                    <?php if (!empty($ordered_items)): ?>
                    <div class="order-items">
                        <h3><i class="fas fa-shopping-bag"></i> Ordered Items</h3>
                        <?php foreach ($ordered_items as $item): ?>
                            <div class="order-item">
                                <div class="item-info">
                                    <div class="item-icon">
                                        <i class="<?php echo $item['icon']; ?>"></i>
                                    </div>
                                    <div>
                                        <div class="item-name"><?php echo htmlspecialchars($item['name']); ?></div>
                                        <div class="item-quantity">Quantity: <?php echo $item['quantity']; ?></div>
                                    </div>
                                </div>
                                <div class="item-total">
                                    R<?php echo number_format($item['price'] * $item['quantity'], 2); ?>
                                </div>
                            </div>
                        <?php endforeach; ?>
                    </div>
                    <?php endif; ?>
                </div>

                <!-- Delivery Information -->
                <div class="delivery-info">
                    <div class="delivery-icon">
                        <i class="fas fa-shipping-fast"></i>
                    </div>
                    <div class="delivery-text">Estimated Delivery</div>
                    <div class="delivery-date"><?php echo $estimated_delivery; ?></div>
                </div>

                <!-- Order Total -->
                <div class="order-total">
                    <div class="total-label">Total Amount Paid</div>
                    <div class="total-amount">R<?php echo number_format($order_total, 2); ?></div>
                </div>

                <!-- Action Buttons -->
                <div class="action-buttons">
                    <a href="../products/products.php" class="btn btn-primary">
                        <i class="fas fa-shopping-bag"></i>
                        Continue Shopping
                    </a>
                    
                    <a href="../order/orders.php" class="btn btn-outline">
                        <i class="fas fa-list-alt"></i>
                        View Order History
                    </a>
                    
                    <a href="../../dashboard.php" class="btn btn-outline">
                        <i class="fas fa-tachometer-alt"></i>
                        Go to Dashboard
                    </a>
                </div>

                <!-- Additional Information -->
                <div style="margin-top: 2rem; padding-top: 2rem; border-top: 1px solid var(--border-color);">
                    <p style="color: var(--text-light); font-size: 0.875rem;">
                        <i class="fas fa-envelope"></i>
                        A confirmation email has been sent to <?php echo htmlspecialchars($email); ?>. 
                        You'll receive tracking information once your order ships.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Font Awesome -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/js/all.min.js"></script>

    <script src="../../assets/js/enhanced-features.js"></script>

    <script>
        // Add some interactive effects
        document.addEventListener('DOMContentLoaded', function() {
            // Add celebration effect
            const successIcon = document.querySelector('.success-icon');
            successIcon.style.transform = 'scale(0)';
            successIcon.style.transition = 'transform 0.6s ease-out';
            
            setTimeout(() => {
                successIcon.style.transform = 'scale(1)';
            }, 100);

            // Add confetti effect (simple version)
            function createConfetti() {
                const colors = ['#28ACD8', '#10b981', '#f59e0b', '#ef4444'];
                for (let i = 0; i < 20; i++) {
                    setTimeout(() => {
                        const confetti = document.createElement('div');
                        confetti.innerHTML = '🎉';
                        confetti.style.position = 'fixed';
                        confetti.style.left = Math.random() * 100 + 'vw';
                        confetti.style.top = '-50px';
                        confetti.style.fontSize = (Math.random() * 20 + 10) + 'px';
                        confetti.style.opacity = '0.8';
                        confetti.style.zIndex = '9999';
                        confetti.style.pointerEvents = 'none';
                        confetti.style.animation = `fall ${Math.random() * 3 + 2}s linear forwards`;
                        document.body.appendChild(confetti);

                        setTimeout(() => {
                            confetti.remove();
                        }, 5000);
                    }, i * 100);
                }
            }

            // Add CSS for confetti animation
            const style = document.createElement('style');
            style.textContent = `
                @keyframes fall {
                    to {
                        transform: translateY(100vh) rotate(360deg);
                        opacity: 0;
                    }
                }
            `;
            document.head.appendChild(style);

            // Trigger confetti
            createConfetti();
        });
    </script>
</body>
</html>

--- File: views\categories\category.php ---
<?php
/**
 * SmartRetail - Categories Page
 * Display all product categories
 */

require_once '../../config/config.php';
require_once '../../config/Database.php';
require_once '../../utils/Auth.php';
require_once '../../models/Category.php';
require_once '../../models/Cart.php';

// Require authentication
Auth::requireAuth();

// Get user information
$user_id = Auth::getUserId();
$username = $_SESSION['username'];
$full_name = $_SESSION['full_name'];
$email = $_SESSION['email'];

// Initialize database connection and models
try {
    $database = new Database();
    $db = $database->getConnection();
    $categoryModel = new Category($db);
    $cartModel = new Cart($db);
} catch (Exception $e) {
    error_log("Database connection failed: " . $e->getMessage());
    $categoryModel = null;
}

// Initialize cart
if (!isset($_SESSION['cart'])) {
    $_SESSION['cart'] = [];
}

$cart_count = $user_id && $cartModel ? $cartModel->getCartCount($user_id) : Cart::getSessionCartCount();

$cart_count = 0;
if (isset($_SESSION['cart']) && is_array($_SESSION['cart'])) {
    foreach ($_SESSION['cart'] as $item) {
        $cart_count += $item['quantity'] ?? 1;
    }
}

// Get categories with product counts
$categories = [];
if ($categoryModel) {
    try {
        $categories_data = $categoryModel->getCategoriesWithProductCount();
        
        // Process categories for display
        $categories = [];
        foreach ($categories_data as $row) {
            $row['icon'] = Category::getCategoryIcon($row['name']);
            $categories[] = $row;
        }
        
    } catch (Exception $e) {
        error_log("Error fetching categories: " . $e->getMessage());
        $categories = getDemoCategories();
    }
} else {
    $categories = getDemoCategories();
}

// Helper function for demo categories
function getDemoCategories() {
    return [
        [
            'category_id' => 1,
            'name' => 'Electronics',
            'description' => 'Latest gadgets, smartphones, laptops, and electronic devices',
            'product_count' => 15,
            'icon' => 'fas fa-laptop'
        ],
        [
            'category_id' => 2,
            'name' => 'Clothing',
            'description' => 'Fashionable clothing for men, women, and children',
            'product_count' => 28,
            'icon' => 'fas fa-tshirt'
        ],
        [
            'category_id' => 3,
            'name' => 'Home & Garden',
            'description' => 'Furniture, decor, and gardening supplies for your home',
            'product_count' => 42,
            'icon' => 'fas fa-home'
        ],
        [
            'category_id' => 4,
            'name' => 'Sports & Outdoors',
            'description' => 'Sports equipment, outdoor gear, and fitness accessories',
            'product_count' => 23,
            'icon' => 'fas fa-football-ball'
        ],
        [
            'category_id' => 5,
            'name' => 'Books & Media',
            'description' => 'Books, movies, music, and educational materials',
            'product_count' => 56,
            'icon' => 'fas fa-book'
        ],
        [
            'category_id' => 6,
            'name' => 'Beauty & Health',
            'description' => 'Cosmetics, skincare, health products, and personal care',
            'product_count' => 34,
            'icon' => 'fas fa-spa'
        ],
        [
            'category_id' => 7,
            'name' => 'Toys & Games',
            'description' => 'Toys, games, and entertainment for all ages',
            'product_count' => 19,
            'icon' => 'fas fa-gamepad'
        ],
        [
            'category_id' => 8,
            'name' => 'Automotive',
            'description' => 'Car accessories, tools, and automotive supplies',
            'product_count' => 12,
            'icon' => 'fas fa-car'
        ]
    ];
}
?>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Categories - SmartRetail</title>
    <link rel="stylesheet" href="../../assets/css/style.css">
    
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <!-- Mobile Navigation Toggle -->
                <button class="mobile-nav-toggle" id="mobileNavToggle">
                    <i class="fas fa-bars"></i>
                    <span class="logo">
                        <i class="fas fa-store"></i>
                        SmartRetail
                    </span>
                </button>
            
                <!-- Desktop Logo (hidden on mobile) -->
                <a href="/" class="logo desktop-logo">
                    <i class="fas fa-store"></i>
                    SmartRetail
                </a>
                
                <!-- Navigation -->
                <nav>
                    <ul class="nav-links">
                        <li><a href="../products/products.php">Products</a></li>
                        <li><a href="../categories/category.php">Categories</a></li>
                        <li><a href="../../dashboard.php">Dashboard</a></li>
                    </ul>
                </nav>
                
                <!-- Header Actions -->
                <div class="header-actions">    
                    <!-- Shopping Cart -->
                    <a href="../cart/cart.php" class="cart-icon" title="Shopping Cart">
                        <i class="fas fa-shopping-cart"></i>
                        <?php if ($cart_count > 0): ?>
                            <span class="cart-count"><?php echo $cart_count; ?></span>
                        <?php endif; ?>
                    </a>
                    
                    <!-- User Dropdown Menu -->
                    <div class="user-menu">
                        <button class="btn btn-outline" id="userMenuButton" style="display: flex; align-items: center; gap: 0.5rem;">
                            <i class="fas fa-user"></i>
                            <?php echo htmlspecialchars($username); ?>
                            <i class="fas fa-chevron-down" style="font-size: 0.75rem;"></i>
                        </button>
                        
                        <div class="user-dropdown" id="userDropdown">
                            <div class="user-dropdown-header">
                                <div class="username"><?php echo htmlspecialchars($full_name); ?></div>
                                <div class="email"><?php echo htmlspecialchars($email); ?></div>
                                <div class="role"><?php echo ucfirst($_SESSION['role'] ?? 'User'); ?> Account</div>
                            </div>
                            
                            <div class="user-dropdown-links">
                                <a href="../order/orders.php" class="user-dropdown-link">
                                    <i class="fas fa-shopping-bag"></i>
                                    My Orders
                                </a>
                                
                                <?php if (Auth::hasRole('admin') || Auth::hasRole('staff')): ?>
                                    <div class="user-dropdown-divider"></div>
                                    <a href="views/admin/admin-dashboard.php" class="user-dropdown-link">
                                        <i class="fas fa-cog"></i>
                                        Admin Panel
                                    </a>
                                <?php endif; ?>
                                
                                <div class="user-dropdown-divider"></div>
                                <a href="logout.php" class="user-dropdown-link logout">
                                    <i class="fas fa-sign-out-alt"></i>
                                    Logout
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Mobile Navigation -->
    <div class="mobile-nav" id="mobileNav">
        <div class="mobile-nav-sidebar">
            <!-- Single Line Header -->
            <div class="mobile-nav-header">
                <div class="mobile-nav-brand">
                    <i class="fas fa-store"></i>
                    <span>SmartRetail</span>
                </div>
                <button class="mobile-nav-close" id="mobileNavClose">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <!-- User Info -->
            <div class="mobile-nav-user">
                <div class="mobile-nav-user-avatar">
                    <?php echo strtoupper(substr($full_name, 0, 1)); ?>
                </div>
                <div class="mobile-nav-user-info">
                    <div class="username"><?php echo htmlspecialchars($full_name); ?></div>
                    <div class="email"><?php echo htmlspecialchars($email); ?></div>
                    <div class="role"><?php echo ucfirst($_SESSION['role'] ?? 'User'); ?></div>
                </div>
            </div>

            <!-- Navigation Links -->
            <div class="mobile-nav-content">
                <ul class="mobile-nav-links">
                    <li><a href="dashboard.php" class="active">
                        <i class="fas fa-home"></i>
                        Dashboard
                    </a></li>
                    <li><a href="../products/products.php">
                        <i class="fas fa-shopping-bag"></i>
                        All Products
                    </a></li>
                    <li><a href="../categories/category.php">
                        <i class="fas fa-list"></i>
                        Categories
                    </a></li>
                    <li><a href="../order/orders.php">
                        <i class="fas fa-receipt"></i>
                        My Orders
                    </a></li>
                
                    <?php if (Auth::hasRole('admin') || Auth::hasRole('staff')): ?>
                        <div class="mobile-nav-divider"></div>
                        <li><a href="views/admin/admin-dashboard.php">
                            <i class="fas fa-cog"></i>
                            Admin Panel
                        </a></li>
                    <?php endif; ?>
                
                    <div class="mobile-nav-divider"></div>
                    <li><a href="../../logout.php" class="logout-link">
                        <i class="fas fa-sign-out-alt"></i>
                        Logout
                    </a></li>
                </ul>
            </div>

            <!-- Cart Summary -->
            <div class="mobile-nav-footer">
                <a href="../cart/cart.php" class="mobile-nav-cart">
                    <div class="mobile-nav-cart-info">
                        <div class="mobile-nav-cart-label">Shopping Cart</div>
                    <div class="mobile-nav-cart-count">
                            <?php echo $cart_count; ?> item<?php echo $cart_count !== 1 ? 's' : ''; ?>
                        </div>
                    </div>
                    <div class="mobile-nav-cart-icon">
                        <i class="fas fa-shopping-cart"></i>
                        <?php if ($cart_count > 0): ?>
                            <span class="mobile-nav-cart-badge"><?php echo $cart_count; ?></span>
                        <?php endif; ?>
                    </div>
                </a>
            </div>
        </div>
    </div>

    <!-- Categories Page -->
    <section class="categories-page">
        <div class="container">
            <div class="page-header">
                <h1>Product Categories</h1>
                <p>Browse our wide range of product categories to find exactly what you're looking for</p>
            </div>

            <!-- Stats Section -->
            <div class="stats-section">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-tags"></i>
                        </div>
                        <div class="stat-number"><?php echo count($categories); ?></div>
                        <div class="stat-label">Total Categories</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-boxes"></i>
                        </div>
                        <div class="stat-number"><?php echo array_sum(array_column($categories, 'product_count')); ?></div>
                        <div class="stat-label">Total Products</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-star"></i>
                        </div>
                        <div class="stat-number">8</div>
                        <div class="stat-label">Main Categories</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-shipping-fast"></i>
                        </div>
                        <div class="stat-number">24/7</div>
                        <div class="stat-label">Customer Support</div>
                    </div>
                </div>
            </div>

            <!-- All Categories -->
            <div class="section-header">
                <h2>All Categories</h2>
                <p>Explore our complete collection of product categories</p>
            </div>

            <?php if (!empty($categories)): ?>
                <div class="categories-grid" id="categoriesGrid">
                    <?php foreach ($categories as $category): ?>
                    <a href="../products/products.php?category=<?php echo $category['id']; ?>" class="category-card">
                        <div class="category-icon">
                            <i class="<?php echo $category['icon']; ?>"></i>
                        </div>
                        <div class="category-info">
                            <div class="category-header">
                                <h3 class="category-name"><?php echo htmlspecialchars($category['name']); ?></h3>
                                <span class="product-count"><?php echo $category['product_count']; ?> products</span>
                            </div>
                            <p class="category-description"><?php echo htmlspecialchars($category['description'] ?? 'Discover amazing products in this category'); ?></p>
                            <div class="btn btn-primary view-products-btn">
                                <i class="fas fa-arrow-right"></i>
                                View Products
                            </div>
                        </div>
                    </a>
                    <?php endforeach; ?>
                </div>
            <?php else: ?>
                <!-- No Categories Message -->
                <div class="no-categories">
                    <div class="no-categories-icon">
                        <i class="fas fa-folder-open"></i>
                    </div>
                    <h2>No Categories Found</h2>
                    <p>We're working on adding more categories to our store.</p>
                    <a href="../products/products.php" class="btn btn-primary">
                        <i class="fas fa-shopping-bag"></i>
                        Browse All Products
                    </a>
                </div>
            <?php endif; ?>

            <!-- Popular Categories -->
            <?php if (!empty($categories)): ?>
            <div class="popular-categories">
                <div class="section-header">
                    <h2>Most Popular</h2>
                    <p>Check out our most shopped categories</p>
                </div>
                <div class="categories-grid">
                    <?php 
                    // Sort categories by product count (descending) and take top 4
                    $popular_categories = $categories;
                    usort($popular_categories, function($a, $b) {
                        return $b['product_count'] - $a['product_count'];
                    });
                    $popular_categories = array_slice($popular_categories, 0, 4);
                    ?>
                    <?php foreach ($popular_categories as $category): ?>
                    <a href="../products/products.php?category=<?php echo $category['id']; ?>" class="category-card">
                        <div class="category-icon" style="background: linear-gradient(135deg, var(--accent-color) 0%, #f97316 100%);">
                            <i class="<?php echo $category['icon']; ?>"></i>
                        </div>
                        <div class="category-info">
                            <div class="category-header">
                                <h3 class="category-name"><?php echo htmlspecialchars($category['name']); ?></h3>
                                <span class="product-count" style="background: var(--accent-color);"><?php echo $category['product_count']; ?> products</span>
                            </div>
                            <p class="category-description"><?php echo htmlspecialchars($category['description'] ?? 'Popular products in this category'); ?></p>
                            <div class="btn btn-primary view-products-btn" style="background: var(--accent-color);">
                                <i class="fas fa-fire"></i>
                                Shop Now
                            </div>
                        </div>
                    </a>
                    <?php endforeach; ?>
                </div>
            </div>
            <?php endif; ?>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <!-- About Section -->
                <div class="footer-section">
                    <h3>About SmartRetail</h3>
                    <p>Your trusted destination for quality products and exceptional service.</p>
                </div>
            </div>

            <div class="footer-bottom">
                <p>&copy; <?php echo date('Y'); ?> SmartRetail System. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- JavaScript -->
    <script src="../../assets/js/dashboard.js"></script>
    <script src="../../assets/js/enhanced-features.js"></script>

</body>
</html>

--- File: views\order\orders.php ---
<?php
/**
 * SmartRetail - Order History Page
 * Displays user's order history with order details
 */

// Start session if not already started
if (session_status() === PHP_SESSION_NONE) {
    session_start();
}

require_once '../../config/config.php';
require_once '../../config/database.php';
require_once '../../utils/Auth.php';
require_once '../../models/Order.php';
require_once '../../models/Product.php';

// Require authentication
Auth::requireAuth();

// Get user information
$user_id = Auth::getUserId();
$username = $_SESSION['username'];
$full_name = $_SESSION['full_name'];
$email = $_SESSION['email'];

// Initialize database connection
try {
    $database = new Database();
    $db = $database->getConnection();
    $orderModel = new Order($db);
    $productModel = new Product($db);
} catch (Exception $e) {
    error_log("Database connection failed: " . $e->getMessage());
    $orderModel = null;
    $productModel = null;
}

// Get cart count for header
if (!isset($_SESSION['cart'])) {
    $_SESSION['cart'] = [];
}
$cart_count = count($_SESSION['cart']);

// Get orders for the user
$orders = [];
if ($orderModel) {
    try {
        // Get orders - this returns an array
        $orders_result = $orderModel->getUserOrders($user_id);
        
        // Process each order
        foreach ($orders_result as $order) {
            // Get order items for this order
            $order_items = $orderModel->getOrderItems($order['id']);
            $items = [];
            
            // Process each item
            foreach ($order_items as $item) {
                // Get product details for each item
                $product = null;
                if ($productModel) {
                    $product = $productModel->getProductById($item['product_id']);
                }
                
                if ($product) {
                    $items[] = [
                        'name' => $product['name'],
                        'price' => $item['unit_price'],
                        'quantity' => $item['quantity'],
                        'icon' => Product::getProductIcon($product['name'])
                    ];
                } else {
                    // Fallback if product not found
                    $items[] = [
                        'name' => $item['product_name'] ?? 'Unknown Product',
                        'price' => $item['unit_price'],
                        'quantity' => $item['quantity'],
                        'icon' => 'fas fa-box'
                    ];
                }
            }
            
            $order['items'] = $items;
            $orders[] = $order;
        }
        
        // If no orders found in database, use demo data
        if (empty($orders)) {
            $orders = getDemoOrders($user_id);
        }
        
    } catch (Exception $e) {
        error_log("Error fetching orders: " . $e->getMessage());
        // Fallback to demo data if database fails
        $orders = getDemoOrders($user_id);
    }
} else {
    // Use demo data if database is unavailable
    $orders = getDemoOrders($user_id);
}

// Helper function for demo orders
function getDemoOrders($user_id) {
    return [
        [
            'id' => 1,
            'order_id' => 'SR-000001',
            'user_id' => $user_id,
            'total' => 147.97,
            'status' => 'completed',
            'created_at' => date('Y-m-d H:i:s', strtotime('-5 days')),
            'items' => [
                ['name' => 'Wireless Headphones', 'price' => 12.99, 'quantity' => 1, 'icon' => 'fas fa-headphones'],
                ['name' => 'Smart Watch', 'price' => 89.99, 'quantity' => 1, 'icon' => 'fas fa-clock'],
                ['name' => 'Laptop Backpack', 'price' => 34.99, 'quantity' => 1, 'icon' => 'fas fa-briefcase'],
                ['name' => 'USB-C Hub', 'price' => 10.00, 'quantity' => 1, 'icon' => 'fas fa-plug']
            ]
        ],
        [
            'id' => 2,
            'order_id' => 'SR-000002',
            'user_id' => $user_id,
            'total' => 75.98,
            'status' => 'completed',
            'created_at' => date('Y-m-d H:i:s', strtotime('-2 days')),
            'items' => [
                ['name' => 'Bluetooth Speaker', 'price' => 45.99, 'quantity' => 1, 'icon' => 'fas fa-volume-up'],
                ['name' => 'Gaming Mouse', 'price' => 29.99, 'quantity' => 1, 'icon' => 'fas fa-mouse']
            ]
        ],
        [
            'id' => 3,
            'order_id' => 'SR-000003',
            'user_id' => $user_id,
            'total' => 34.99,
            'status' => 'pending',
            'created_at' => date('Y-m-d H:i:s', strtotime('-1 day')),
            'items' => [
                ['name' => 'Laptop Backpack', 'price' => 34.99, 'quantity' => 1, 'icon' => 'fas fa-briefcase']
            ]
        ]
    ];
}

// Function to get status badge class
function getStatusBadge($status) {
    switch ($status) {
        case 'completed':
            return 'status-delivered';
        case 'pending':
            return 'status-processing';
        case 'cancelled':
            return 'status-cancelled';
        default:
            return 'status-processing';
    }
}

// Function to get status text
function getStatusText($status) {
    switch ($status) {
        case 'completed':
            return 'Delivered';
        case 'pending':
            return 'Processing';
        case 'cancelled':
            return 'Cancelled';
        default:
            return 'Processing';
    }
}

// Function to format date
function formatOrderDate($date) {
    return date('F j, Y \a\t g:i A', strtotime($date));
}

// Function to generate order display ID
function getOrderDisplayId($order_id) {
    return 'SR-' . str_pad($order_id, 6, '0', STR_PAD_LEFT);
}
?>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order History - SmartRetail</title>
    <link rel="stylesheet" href="../../assets/css/style.css">
    
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* Orders Page Styles */
        .orders-page {
            padding: 3rem 0;
            background: var(--light-bg);
            min-height: calc(100vh - 200px);
        }

        .page-header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .page-header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 1rem;
        }

        .page-header p {
            color: var(--text-light);
            font-size: 1.125rem;
        }

        /* Orders List */
        .orders-list {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        .order-card {
            background: white;
            border-radius: 0.75rem;
            box-shadow: var(--shadow);
            overflow: hidden;
            transition: all 0.3s;
        }

        .order-card:hover {
            box-shadow: var(--shadow-lg);
        }

        .order-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .order-info {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .order-id {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--text-dark);
        }

        .order-date {
            color: var(--text-light);
            font-size: 0.875rem;
        }

        .order-status {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .status-badge {
            padding: 0.5rem 1rem;
            border-radius: 2rem;
            font-size: 0.875rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-delivered {
            background: #d1fae5;
            color: #065f46;
        }

        .status-processing {
            background: #fef3c7;
            color: #92400e;
        }

        .status-cancelled {
            background: #fee2e2;
            color: #991b1b;
        }

        .order-total {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--primary-color);
        }

        .order-items {
            padding: 1.5rem;
        }

        .order-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem 0;
            border-bottom: 1px solid var(--border-color);
        }

        .order-item:last-child {
            border-bottom: none;
        }

        .item-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.25rem;
            flex-shrink: 0;
        }

        .item-details {
            flex: 1;
        }

        .item-name {
            font-weight: 500;
            color: var(--text-dark);
            margin-bottom: 0.25rem;
        }

        .item-quantity {
            color: var(--text-light);
            font-size: 0.875rem;
        }

        .item-price {
            font-weight: 600;
            color: var(--text-dark);
        }

        .order-actions {
            padding: 1.5rem;
            border-top: 1px solid var(--border-color);
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
        }

        /* Empty State */
        .empty-orders {
            text-align: center;
            padding: 4rem 2rem;
        }

        .empty-orders-icon {
            font-size: 4rem;
            color: var(--text-light);
            margin-bottom: 1.5rem;
            opacity: 0.5;
        }

        .empty-orders h2 {
            font-size: 1.75rem;
            color: var(--text-dark);
            margin-bottom: 1rem;
        }

        .empty-orders p {
            color: var(--text-light);
            margin-bottom: 2rem;
            font-size: 1.125rem;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 1rem;
            }

            .nav-links {
                gap: 1rem;
            }

            .order-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .order-status {
                width: 100%;
                justify-content: space-between;
            }

            .order-actions {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <!-- Mobile Navigation Toggle -->
                <button class="mobile-nav-toggle" id="mobileNavToggle">
                    <i class="fas fa-bars"></i>
                    <span class="logo">
                        <i class="fas fa-store"></i>
                        SmartRetail
                    </span>
                </button>
            
                <!-- Desktop Logo (hidden on mobile) -->
                <a href="/" class="logo desktop-logo">
                    <i class="fas fa-store"></i>
                    SmartRetail
                </a>
                
                <!-- Navigation -->
                <nav>
                    <ul class="nav-links">
                        <li><a href="../products/products.php">Products</a></li>
                        <li><a href="../categories/category.php">Categories</a></li>
                        <li><a href="../../dashboard.php">Dashboard</a></li>
                    </ul>
                </nav>
                
                <!-- Header Actions -->
                <div class="header-actions">    
                    <!-- Shopping Cart -->
                    <a href="../cart/cart.php" class="cart-icon" title="Shopping Cart">
                        <i class="fas fa-shopping-cart"></i>
                        <?php if ($cart_count > 0): ?>
                            <span class="cart-count"><?php echo $cart_count; ?></span>
                        <?php endif; ?>
                    </a>
                    
                    <!-- User Dropdown Menu -->
                    <div class="user-menu">
                        <button class="btn btn-outline" id="userMenuButton" style="display: flex; align-items: center; gap: 0.5rem;">
                            <i class="fas fa-user"></i>
                            <?php echo htmlspecialchars($username); ?>
                            <i class="fas fa-chevron-down" style="font-size: 0.75rem;"></i>
                        </button>
                        
                        <div class="user-dropdown" id="userDropdown">
                            <div class="user-dropdown-header">
                                <div class="username"><?php echo htmlspecialchars($full_name); ?></div>
                                <div class="email"><?php echo htmlspecialchars($email); ?></div>
                                <div class="role"><?php echo ucfirst($_SESSION['role'] ?? 'User'); ?> Account</div>
                            </div>
                            
                            <div class="user-dropdown-links">
                                <a href="../../views/order/orders.php" class="user-dropdown-link">
                                    <i class="fas fa-shopping-bag"></i>
                                    My Orders
                                </a>

                                <?php if (Auth::hasRole('admin') || Auth::hasRole('staff')): ?>
                                    <div class="user-dropdown-divider"></div>
                                    <a href="views/admin/admin-dashboard.php" class="user-dropdown-link">
                                        <i class="fas fa-cog"></i>
                                        Admin Panel
                                    </a>
                                <?php endif; ?>
                                
                                <div class="user-dropdown-divider"></div>
                                <a href="../../logout.php" class="user-dropdown-link logout">
                                    <i class="fas fa-sign-out-alt"></i>
                                    Logout
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Mobile Navigation -->
    <div class="mobile-nav" id="mobileNav">
        <div class="mobile-nav-sidebar">
            <!-- Single Line Header -->
            <div class="mobile-nav-header">
                <div class="mobile-nav-brand">
                    <i class="fas fa-store"></i>
                    <span>SmartRetail</span>
                </div>
                <button class="mobile-nav-close" id="mobileNavClose">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <!-- User Info -->
            <div class="mobile-nav-user">
                <div class="mobile-nav-user-avatar">
                    <?php echo strtoupper(substr($full_name, 0, 1)); ?>
                </div>
                <div class="mobile-nav-user-info">
                    <div class="username"><?php echo htmlspecialchars($full_name); ?></div>
                    <div class="email"><?php echo htmlspecialchars($email); ?></div>
                    <div class="role"><?php echo ucfirst($_SESSION['role'] ?? 'User'); ?></div>
                </div>
            </div>

            <!-- Navigation Links -->
            <div class="mobile-nav-content">
                <ul class="mobile-nav-links">
                    <li><a href="dashboard.php" class="active">
                        <i class="fas fa-home"></i>
                        Dashboard
                    </a></li>
                    <li><a href="../views/products/products.php">
                        <i class="fas fa-shopping-bag"></i>
                        All Products
                    </a></li>
                    <li><a href="../views/categories/category.php">
                        <i class="fas fa-list"></i>
                        Categories
                    </a></li>
                    <li><a href="../views/order/orders.php">
                        <i class="fas fa-receipt"></i>
                        My Orders
                    </a></li>
                
                    <?php if (Auth::hasRole('admin') || Auth::hasRole('staff')): ?>
                        <div class="mobile-nav-divider"></div>
                        <li><a href="../views/admin/admin-dashboard.php">
                            <i class="fas fa-cog"></i>
                            Admin Panel
                        </a></li>
                    <?php endif; ?>
                
                    <div class="mobile-nav-divider"></div>
                    <li><a href="../../logout.php" class="logout-link">
                        <i class="fas fa-sign-out-alt"></i>
                        Logout
                    </a></li>
                </ul>
            </div>

            <!-- Cart Summary -->
            <div class="mobile-nav-footer">
                <a href="../views/cart/cart.php" class="mobile-nav-cart">
                    <div class="mobile-nav-cart-info">
                        <div class="mobile-nav-cart-label">Shopping Cart</div>
                    <div class="mobile-nav-cart-count">
                            <?php echo $cart_count; ?> item<?php echo $cart_count !== 1 ? 's' : ''; ?>
                        </div>
                    </div>
                    <div class="mobile-nav-cart-icon">
                        <i class="fas fa-shopping-cart"></i>
                        <?php if ($cart_count > 0): ?>
                            <span class="mobile-nav-cart-badge"><?php echo $cart_count; ?></span>
                        <?php endif; ?>
                    </div>
                </a>
            </div>
        </div>
    </div>

    <!-- Orders Page -->
    <section class="orders-page">
        <div class="container">
            <div class="page-header">
                <h1>Order History</h1>
                <p>View your past orders and track their status</p>
            </div>

            <?php if (!empty($orders)): ?>
                <div class="orders-list">
                    <?php foreach ($orders as $order): ?>
                    <div class="order-card">
                        <!-- Order Header -->
                        <div class="order-header">
                            <div class="order-info">
                                <div class="order-id">Order #<?php echo getOrderDisplayId($order['id']); ?></div>
                                <div class="order-date">Placed on <?php echo formatOrderDate($order['created_at']); ?></div>
                            </div>
                            <div class="order-status">
                                <div class="status-badge <?php echo getStatusBadge($order['status']); ?>">
                                    <?php echo getStatusText($order['status']); ?>
                                </div>
                                <div class="order-total">R<?php echo number_format($order['total'], 2); ?></div>
                            </div>
                        </div>

                        <!-- Order Items -->
                        <div class="order-items">
                            <?php if (isset($order['items']) && !empty($order['items'])): ?>
                                <?php foreach ($order['items'] as $item): ?>
                                <div class="order-item">
                                    <div class="item-icon">
                                        <i class="<?php echo $item['icon']; ?>"></i>
                                    </div>
                                    <div class="item-details">
                                        <div class="item-name"><?php echo htmlspecialchars($item['name']); ?></div>
                                        <div class="item-quantity">Quantity: <?php echo $item['quantity']; ?></div>
                                    </div>
                                    <div class="item-price">
                                        R<?php echo number_format($item['price'] * $item['quantity'], 2); ?>
                                    </div>
                                </div>
                                <?php endforeach; ?>
                            <?php else: ?>
                                <div class="order-item">
                                    <div class="item-details">
                                        <div class="item-name">No items found for this order</div>
                                    </div>
                                </div>
                            <?php endif; ?>
                        </div>

                        <!-- Order Actions -->
                        <div class="order-actions">
                            <button class="btn btn-outline view-order-btn" data-order-id="<?php echo $order['id']; ?>">
                                <i class="fas fa-eye"></i>
                                View Details
                            </button>
                            <?php if ($order['status'] === 'completed'): ?>
                                <button class="btn btn-outline reorder-btn" data-order-id="<?php echo $order['id']; ?>">
                                    <i class="fas fa-redo"></i>
                                    Reorder
                                </button>
                            <?php endif; ?>
                        </div>
                    </div>
                    <?php endforeach; ?>
                </div>
            <?php else: ?>
                <!-- Empty Orders State -->
                <div class="empty-orders">
                    <div class="empty-orders-icon">
                        <i class="fas fa-shopping-bag"></i>
                    </div>
                    <h2>No orders yet</h2>
                    <p>You haven't placed any orders. Start shopping to see your order history here.</p>
                    <a href="../products/products.php" class="btn btn-primary">
                        <i class="fas fa-shopping-bag"></i>
                        Start Shopping
                    </a>
                </div>
            <?php endif; ?>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <!-- About Section -->
                <div class="footer-section">
                    <h3>About SmartRetail</h3>
                    <p>Your trusted destination for quality products and exceptional service.</p>
                </div>
            </div>

            <div class="footer-bottom">
                <p>&copy; <?php echo date('Y'); ?> SmartRetail System. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- JavaScript Files -->
    <script src="../../assets/js/dashboard.js"></script>
    <script src="../../assets/js/enhanced-features.js"></script>
    <script>
        // Simple JavaScript for button actions
        document.querySelectorAll('.view-order-btn').forEach(button => {
            button.addEventListener('click', function() {
                const orderId = this.getAttribute('data-order-id');
                alert('Viewing details for order: ' + orderId);
                // In a real application, you would redirect to order details page
                // window.location.href = 'order-details.php?id=' + orderId;
            });
        });

        document.querySelectorAll('.reorder-btn').forEach(button => {
            button.addEventListener('click', function() {
                const orderId = this.getAttribute('data-order-id');
                if (confirm('Add all items from this order to your cart?')) {
                    alert('Items added to cart from order: ' + orderId);
                    // In a real application, you would add items to cart via AJAX
                }
            });
        });
    </script>
</body>
</html>

--- File: views\products\products.php ---
<?php
/**
 * SmartRetail - Products Page
 * Updated to work with database schema including categories
 */

session_start();

require_once '../../config/config.php';
require_once '../../config/database.php';
require_once '../../utils/Auth.php';
require_once '../../models/Product.php';
require_once '../../models/Cart.php';
require_once '../../models/Category.php';

// Require authentication
Auth::requireAuth();

// Get user information
$user_id = Auth::getUserId();
$username = $_SESSION['username'];
$full_name = $_SESSION['full_name'];
$email = $_SESSION['email'];

// Initialize database connection and models
try {
    $database = new Database();
    $db = $database->getConnection();
    $productModel = new Product($db);
    $cartModel = new Cart($db);
    $categoryModel = new Category($db);
} catch (Exception $e) {
    error_log("Database connection failed: " . $e->getMessage());
    $productModel = null;
    $categoryModel = null;
}

// Initialize cart and cart count
if (!isset($_SESSION['cart']) || !is_array($_SESSION['cart'])) {
    $_SESSION['cart'] = [];
}

$cart_count = 0;
if (isset($_SESSION['cart']) && is_array($_SESSION['cart'])) {
    foreach ($_SESSION['cart'] as $item) {
        $cart_count += $item['quantity'] ?? 1;
    }
}

// Handle search and filtering
$search_keywords = $_GET['search'] ?? '';
$category_filter = $_GET['category'] ?? '';
$sort_by = $_GET['sort'] ?? 'newest';

// Get categories for filter dropdown
if ($categoryModel) {
    try {
        $categories = $categoryModel->getAllCategories();
        // $categories is now an array, no need to loop through it here
    } catch (Exception $e) {
        error_log("Error fetching categories: " . $e->getMessage());
        $categories = [];
    }
} else {
    $categories = [];
}

// Get products based on filters
if ($productModel) {
    try {
        if (!empty($search_keywords)) {
            $products_data = $productModel->searchProducts($search_keywords, $category_filter);
        } else if (!empty($category_filter)) {
            $products_data = $productModel->getProductsByCategory($category_filter);
        } else {
            $products_data = $productModel->getAllProductsWithCategory();
        }
        
        // Process products for display
        $products = [];
        foreach ($products_data as $row) {
            $row['icon'] = Product::getProductIcon($row['name']);
            $row['rating'] = $row['rating'] ?? 4.5;
            $products[] = $row;
        }
        
    } catch (Exception $e) {
        error_log("Error fetching products: " . $e->getMessage());
        $products = getDemoProducts(); // Fallback to demo data
    }
} else {
    $products = getDemoProducts();
}

// Handle add to cart
if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_POST['add_to_cart'])) {
    $product_id = $_POST['product_id'];
    $product_name = $_POST['product_name'] ?? '';
    $product_price = (float)($_POST['product_price'] ?? 0);
    $product_icon = $_POST['product_icon'] ?? 'fas fa-box';
    $quantity = intval($_POST['quantity'] ?? 1);
    
    // Validate required fields
    if (empty($product_id) || empty($product_name) || $product_price <= 0 || $quantity <= 0) {
        error_log("Add to cart failed - Missing required fields");
        header('Location: products.php?error=1');
        exit;
    }
    
    // Initialize cart in session if not exists
    if (!isset($_SESSION['cart']) || !is_array($_SESSION['cart'])) {
        $_SESSION['cart'] = [];
    }
    
    // SIMPLIFIED AND FIXED: Check if item already exists in cart
    $item_exists = false;
    $item_index = -1;
    
    // Use consistent ID checking - only check 'id' field
    foreach ($_SESSION['cart'] as $index => &$item) {
        if (isset($item['id']) && $item['id'] == $product_id) {
            $item_exists = true;
            $item_index = $index;
            break;
        }
    }
    
    if ($item_exists) {
        // Update existing item quantity
        $_SESSION['cart'][$item_index]['quantity'] += $quantity;
        error_log("Updated existing item: " . $product_name . " - New quantity: " . $_SESSION['cart'][$item_index]['quantity']);
    } else {
        // Add new item with consistent field names - ONLY use 'id'
        $new_item = [
            'id' => $product_id, // Use only 'id' field consistently
            'name' => $product_name,
            'price' => $product_price,
            'quantity' => $quantity,
            'icon' => $product_icon,
            'stock_quantity' => 10
        ];
        $_SESSION['cart'][] = $new_item;
        error_log("Added new item: " . $product_name . " - Quantity: " . $quantity);
    }
    
    // Update cart count for display
    $cart_count = 0;
    foreach ($_SESSION['cart'] as $item) {
        $cart_count += $item['quantity'];
    }
    
    // Debug: Log cart contents
    error_log("Cart contents after update: " . print_r($_SESSION['cart'], true));
    
    // Redirect to prevent form resubmission
    header('Location: products.php?added=' . $product_id);
    exit;
}

// Check if we just added an item and show message
$show_success_message = false;
if (isset($_GET['added']) && is_numeric($_GET['added'])) {
    $show_success_message = true;
    $added_product_id = $_GET['added'];
    
    // Find the added product name for the message
    $added_product_name = '';
    foreach ($products as $product) {
        if ($product['product_id'] == $added_product_id) {
            $added_product_name = $product['name'];
            break;
        }
    }
}

// Clear any session cart message
if (isset($_SESSION['cart_message'])) {
    unset($_SESSION['cart_message']);
}

// Helper function to sort products
function sortProducts($products, $sort_by) {
    switch ($sort_by) {
        case 'price_low':
            usort($products, function($a, $b) {
                return $a['price'] <=> $b['price'];
            });
            break;
        case 'price_high':
            usort($products, function($a, $b) {
                return $b['price'] <=> $a['price'];
            });
            break;
        case 'rating':
            usort($products, function($a, $b) {
                return $b['rating'] <=> $a['rating'];
            });
            break;
        case 'name':
            usort($products, function($a, $b) {
                return strcmp($a['name'], $b['name']);
            });
            break;
        case 'newest':
        default:
            // Keep original order (newest first based on database order)
            break;
    }
    return $products;
}

// Helper function for demo data 
function getDemoProducts() {
    return [
        [
            'product_id' => 1,
            'name' => 'Wireless Headphones',
            'description' => 'High-quality wireless headphones with noise cancellation and premium sound quality.',
            'price' => 129.99,
            'category_name' => 'Electronics',
            'icon' => 'fas fa-headphones',
            'stock_quantity' => 120,
            'rating' => 4.6
        ],
        [
            'product_id' => 2,
            'name' => 'Smart Watch',
            'description' => 'Feature-rich smartwatch with health monitoring, GPS, and long battery life.',
            'price' => 299.99,
            'category_name' => 'Electronics',
            'icon' => 'fas fa-clock',
            'stock_quantity' => 85,
            'rating' => 4.4
        ],
        [
            'product_id' => 3,
            'name' => 'Laptop Backpack',
            'description' => 'Durable laptop backpack with multiple compartments and waterproof material.',
            'price' => 59.99,
            'category_name' => 'Accessories',
            'icon' => 'fas fa-briefcase',
            'stock_quantity' => 200,
            'rating' => 4.8
        ],
        [
            'product_id' => 4,
            'name' => 'Bluetooth Speaker',
            'description' => 'Portable Bluetooth speaker with crystal clear sound and long battery life.',
            'price' => 89.99,
            'category_name' => 'Electronics',
            'icon' => 'fas fa-volume-up',
            'stock_quantity' => 150,
            'rating' => 4.5
        ],
        [
            'product_id' => 5,
            'name' => 'Gaming Mouse',
            'description' => 'High-precision gaming mouse with RGB lighting and programmable buttons.',
            'price' => 49.99,
            'category_name' => 'Electronics',
            'icon' => 'fas fa-mouse',
            'stock_quantity' => 75,
            'rating' => 4.7
        ],
        [
            'product_id' => 6,
            'name' => 'USB-C Hub',
            'description' => 'Multi-port USB-C hub for expanding your connectivity options.',
            'price' => 39.99,
            'category_name' => 'Electronics',
            'icon' => 'fas fa-plug',
            'stock_quantity' => 120,
            'rating' => 4.3
        ],
        [
            'product_id' => 7,
            'name' => 'Cotton T-Shirt',
            'description' => 'Comfortable cotton t-shirt available in multiple colors and sizes.',
            'price' => 19.99,
            'category_name' => 'Clothing',
            'icon' => 'fas fa-tshirt',
            'stock_quantity' => 200,
            'rating' => 4.2
        ],
        [
            'product_id' => 8,
            'name' => 'Garden Tools Set',
            'description' => 'Complete gardening tool set for all your home gardening needs.',
            'price' => 39.99,
            'category_name' => 'Home & Garden',
            'icon' => 'fas fa-leaf',
            'stock_quantity' => 35,
            'rating' => 4.6
        ],
        [
            'product_id' => 9,
            'name' => 'Bestseller Novel',
            'description' => 'Award-winning fiction novel by popular contemporary author.',
            'price' => 14.99,
            'category_name' => 'Books & Media',
            'icon' => 'fas fa-book',
            'stock_quantity' => 80,
            'rating' => 4.8
        ],
        [
            'product_id' => 10,
            'name' => 'Basketball',
            'description' => 'Professional quality basketball for indoor and outdoor use.',
            'price' => 29.99,
            'category_name' => 'Sports & Outdoors',
            'icon' => 'fas fa-basketball-ball',
            'stock_quantity' => 60,
            'rating' => 4.4
        ]
    ];
}
?>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Products - SmartRetail</title>
    <link rel="stylesheet" href="../../assets/css/style.css">
    
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <!-- Mobile Navigation Toggle -->
                <button class="mobile-nav-toggle" id="mobileNavToggle">
                    <i class="fas fa-bars"></i>
                    <span class="logo">
                        <i class="fas fa-store"></i>
                        SmartRetail
                    </span>
                </button>
            
                <!-- Desktop Logo (hidden on mobile) -->
                <a href="/" class="logo desktop-logo">
                    <i class="fas fa-store"></i>
                    SmartRetail
                </a>
                
                <!-- Navigation -->
                <nav>
                    <ul class="nav-links">
                        <li><a href="../products/products.php">Products</a></li>
                        <li><a href="../categories/category.php">Categories</a></li>
                        <li><a href="../../dashboard.php">Dashboard</a></li>
                    </ul>
                </nav>
                
                <!-- Header Actions -->
                <div class="header-actions">    
                    <!-- Shopping Cart -->
                    <a href="../cart/cart.php" class="cart-icon" title="Shopping Cart">
                        <i class="fas fa-shopping-cart"></i>
                        <?php if ($cart_count > 0): ?>
                            <span class="cart-count"><?php echo $cart_count; ?></span>
                        <?php endif; ?>
                    </a>
                    
                    <!-- User Dropdown Menu -->
                    <div class="user-menu">
                        <button class="btn btn-outline" id="userMenuButton" style="display: flex; align-items: center; gap: 0.5rem;">
                            <i class="fas fa-user"></i>
                            <?php echo htmlspecialchars($username); ?>
                            <i class="fas fa-chevron-down" style="font-size: 0.75rem;"></i>
                        </button>
                        
                        <div class="user-dropdown" id="userDropdown">
                            <div class="user-dropdown-header">
                                <div class="username"><?php echo htmlspecialchars($full_name); ?></div>
                                <div class="email"><?php echo htmlspecialchars($email); ?></div>
                                <div class="role"><?php echo ucfirst($_SESSION['role'] ?? 'User'); ?> Account</div>
                            </div>
                            
                            <div class="user-dropdown-links">
                                <a href="../order/orders.php" class="user-dropdown-link">
                                    <i class="fas fa-shopping-bag"></i>
                                    My Orders
                                </a>
                                
                                <?php if (Auth::hasRole('admin') || Auth::hasRole('staff')): ?>
                                    <div class="user-dropdown-divider"></div>
                                    <a href="views/admin/admin-dashboard.php" class="user-dropdown-link">
                                        <i class="fas fa-cog"></i>
                                        Admin Panel
                                    </a>
                                <?php endif; ?>
                                
                                <div class="user-dropdown-divider"></div>
                                <a href="../../logout.php" class="user-dropdown-link logout">
                                    <i class="fas fa-sign-out-alt"></i>
                                    Logout
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Mobile Navigation -->
    <div class="mobile-nav" id="mobileNav">
        <div class="mobile-nav-sidebar">
            <!-- Single Line Header -->
            <div class="mobile-nav-header">
                <div class="mobile-nav-brand">
                    <i class="fas fa-store"></i>
                    <span>SmartRetail</span>
                </div>
                <button class="mobile-nav-close" id="mobileNavClose">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <!-- User Info -->
            <div class="mobile-nav-user">
                <div class="mobile-nav-user-avatar">
                    <?php echo strtoupper(substr($full_name, 0, 1)); ?>
                </div>
                <div class="mobile-nav-user-info">
                    <div class="username"><?php echo htmlspecialchars($full_name); ?></div>
                    <div class="email"><?php echo htmlspecialchars($email); ?></div>
                    <div class="role"><?php echo ucfirst($_SESSION['role'] ?? 'User'); ?></div>
                </div>
            </div>

            <!-- Navigation Links -->
            <div class="mobile-nav-content">
                <ul class="mobile-nav-links">
                    <li><a href="dashboard.php" class="active">
                        <i class="fas fa-home"></i>
                        Dashboard
                    </a></li>
                    <li><a href="../products/products.php">
                        <i class="fas fa-shopping-bag"></i>
                        All Products
                    </a></li>
                    <li><a href="../categories/category.php">
                        <i class="fas fa-list"></i>
                        Categories
                    </a></li>
                    <li><a href="../order/orders.php">
                        <i class="fas fa-receipt"></i>
                        My Orders
                    </a></li>
                
                    <?php if (Auth::hasRole('admin') || Auth::hasRole('staff')): ?>
                        <div class="mobile-nav-divider"></div>
                        <li><a href="views/admin/admin-dashboard.php">
                            <i class="fas fa-cog"></i>
                            Admin Panel
                        </a></li>
                    <?php endif; ?>
                
                    <div class="mobile-nav-divider"></div>
                    <li><a href="../../logout.php" class="logout-link">
                        <i class="fas fa-sign-out-alt"></i>
                        Logout
                    </a></li>
                </ul>
            </div>

            <!-- Cart Summary -->
            <div class="mobile-nav-footer">
                <a href="../cart/cart.php" class="mobile-nav-cart">
                    <div class="mobile-nav-cart-info">
                        <div class="mobile-nav-cart-label">Shopping Cart</div>
                    <div class="mobile-nav-cart-count">
                            <?php echo $cart_count; ?> item<?php echo $cart_count !== 1 ? 's' : ''; ?>
                        </div>
                    </div>
                    <div class="mobile-nav-cart-icon">
                        <i class="fas fa-shopping-cart"></i>
                        <?php if ($cart_count > 0): ?>
                            <span class="mobile-nav-cart-badge"><?php echo $cart_count; ?></span>
                        <?php endif; ?>
                    </div>
                </a>
            </div>
        </div>
    </div>

    <!-- Products Page -->
    <section class="products-page">
        <div class="container">
            <div class="page-header">
                <h1>Our Products</h1>
                <p>Discover amazing products with great deals</p>
            </div>

            <!-- Filters Section -->
            <div class="filters-section">
                <form method="GET" class="filters-grid">
                    <div class="filter-group">
                        <label class="filter-label">Search Products</label>
                        <input type="text" name="search" class="filter-input" placeholder="Enter product name..." value="<?php echo htmlspecialchars($search_keywords); ?>">
                    </div>
                    
                    <div class="filter-group">
                        <label class="filter-label">Category</label>
                        <select name="category" class="filter-select">
                            <option value="">All Categories</option>
                            <?php foreach ($categories as $category): ?>
                                <option value="<?php echo htmlspecialchars($category['id']); ?>" 
                                    <?php echo $category_filter == $category['id'] ? 'selected' : ''; ?>>
                                    <?php echo htmlspecialchars($category['name']); ?>
                                </option>
                            <?php endforeach; ?>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label class="filter-label">Sort By</label>
                        <select name="sort" class="filter-select">
                            <option value="newest" <?php echo $sort_by === 'newest' ? 'selected' : ''; ?>>Newest First</option>
                            <option value="price_low" <?php echo $sort_by === 'price_low' ? 'selected' : ''; ?>>Price: Low to High</option>
                            <option value="price_high" <?php echo $sort_by === 'price_high' ? 'selected' : ''; ?>>Price: High to Low</option>
                            <option value="rating" <?php echo $sort_by === 'rating' ? 'selected' : ''; ?>>Highest Rated</option>
                            <option value="name" <?php echo $sort_by === 'name' ? 'selected' : ''; ?>>Name A-Z</option>
                        </select>
                    </div>
                    
                    <div class="filter-group" style="position: relative;">
                        <label class="filter-label">Search Products</label>
                        <input type="text" name="search" class="filter-input" placeholder="Enter product name..." 
                            value="<?php echo htmlspecialchars($search_keywords); ?>" 
                            autocomplete="off">
                    </div>
                </form>
            </div>

            <!-- Products Grid -->
            <?php if (!empty($products)): ?>
                <div class="products-grid">
                    <?php foreach ($products as $product): 
                        $stock_quantity = $product['stock_quantity'] ?? 10;
                        $stock_class = $stock_quantity > 10 ? '' : ($stock_quantity > 0 ? 'stock-low' : 'stock-out');
                    ?>
                    <div class="product-card">
                        <div class="product-icon">
                            <i class="<?php echo $product['icon']; ?>"></i>
                            <div class="category-badge">
                                <?php echo htmlspecialchars($product['category_name'] ?? 'Uncategorized'); ?>
                            </div>
                        </div>
                        <div class="product-info">
                            <div class="product-header">
                                <h3 class="product-name"><?php echo htmlspecialchars($product['name']); ?></h3>
                                <div class="product-price">R<?php echo number_format($product['price'], 2); ?></div>
                            </div>
                            
                            <p class="product-description"><?php echo htmlspecialchars($product['description']); ?></p>
                            
                            <div class="product-rating">
                                <div class="rating-stars">
                                    <?php
                                    $rating = $product['rating'] ?? 4.5;
                                    $fullStars = floor($rating);
                                    $hasHalfStar = ($rating - $fullStars) >= 0.5;
                                    
                                    for ($i = 1; $i <= 5; $i++) {
                                        if ($i <= $fullStars) {
                                            echo '<i class="fas fa-star"></i>';
                                        } elseif ($i == $fullStars + 1 && $hasHalfStar) {
                                            echo '<i class="fas fa-star-half-alt"></i>';
                                        } else {
                                            echo '<i class="far fa-star"></i>';
                                        }
                                    }
                                    ?>
                                </div>
                                <span class="rating-value"><?php echo number_format($rating, 1); ?></span>
                            </div>
                            
                            <div class="product-stock <?php echo $stock_class; ?>">
                                <i class="fas fa-<?php echo $stock_quantity > 0 ? 'check-circle' : 'times-circle'; ?>"></i>
                                <?php 
                                if ($stock_quantity > 10) {
                                    echo $stock_quantity . ' in stock';
                                } elseif ($stock_quantity > 0) {
                                    echo 'Only ' . $stock_quantity . ' left';
                                } else {
                                    echo 'Out of stock';
                                }
                                ?>
                            </div>

                            <form method="POST" class="add-to-cart-form">
                                <input type="hidden" name="product_id" value="<?php echo $product['product_id']; ?>">
                                <input type="hidden" name="product_name" value="<?php echo htmlspecialchars($product['name']); ?>">
                                <input type="hidden" name="product_price" value="<?php echo $product['price']; ?>">
                                <input type="hidden" name="product_icon" value="<?php echo $product['icon']; ?>">

                                <div class="quantity-container">
                                    <label class="quantity-label">Qty:</label>
                                    <input type="number" name="quantity" class="quantity-input" value="1" min="1" 
                                            max="<?php echo $stock_quantity; ?>" <?php echo $stock_quantity == 0 ? 'disabled' : ''; ?>>
                                </div>

                                <button type="submit" name="add_to_cart" class="btn btn-primary add-to-cart-btn" 
                                    <?php echo $stock_quantity == 0 ? 'disabled' : ''; ?> style="width: 100%;">
                                        <i class="fas fa-shopping-cart"></i>
                                    <?php echo $stock_quantity == 0 ? 'Out of Stock' : 'Add to Cart'; ?>
                                </button>
                            </form>
                        </div>
                    </div>
                    <?php endforeach; ?>
                </div>
            <?php else: ?>
                <!-- No Products Message -->
                <div class="no-products">
                    <div class="no-products-icon">
                        <i class="fas fa-search"></i>
                    </div>
                    <h2>No products found</h2>
                    <p>Try adjusting your search or filter criteria</p>
                    <a href="products.php" class="btn btn-primary">
                        <i class="fas fa-undo"></i>
                        Clear Filters
                    </a>
                </div>
            <?php endif; ?>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <!-- About Section -->
                <div class="footer-section">
                    <h3>About SmartRetail</h3>
                    <p>Your trusted destination for quality products and exceptional service.</p>
                </div>
            </div>

            <div class="footer-bottom">
                <p>&copy; <?php echo date('Y'); ?> SmartRetail System. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- JavaScript -->
    <script src="../../assets/js/dashboard.js"></script>
    <script src="../../assets/js/stock-validator.js"></script>
    <script src="../../assets/js/search-autocomplete.js"></script>
</body>
</html>
